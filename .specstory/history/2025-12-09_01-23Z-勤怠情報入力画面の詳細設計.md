<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session d4ba3551-d921-4272-944b-1b5b9a8e4567 (2025-12-09 01:23Z) -->

# 勤怠情報入力画面の詳細設計 (2025-12-09 01:23Z)

_**User (2025-12-08 08:46Z)**_

こちらは勤怠情報入力画面です。

こちらの内容を基に

@rules/R03_Detailed_Design/R0302_Ui_Detailed_Design/R030201_ui_detailed_design.mdc に基づいて、詳細設計書を作成してください。

本画面は勤務表画面の「出社」「退社」「勤務場所」でテキストボックスを押下すると表示される画面である。出社や退社などが手入力で入力できる。ただし出社および退社を手入力で入力して登録すると、勤務表画面で手入力した箇所の背景色が黄色に変更される。

また日時確定ボタンを押して承認中になると、2枚目の画像のように編集できなくなる。

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
ユーザーは勤怠情報入力画面の詳細設計書を作成したいとのことです。まず、指定されたルールファイルを読んで、詳細設計書のフォーマットを確認する必要があります。また、既存の詳細設計書のサンプルも確認して、どのような形式で書くべきかを理解します。

まず、ルールファイルと既存の詳細設計書を読み込みましょう。</details></think>

---

まず、詳細設計書のルールファイルと既存の詳細設計書のサンプルを確認させてください。

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: rules/R03_Detailed_Design/R0302_Ui_Detailed_Design/R030201_ui_detailed_design.mdc</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/detailed-design/ui/attendance-application-screen.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
ルールファイルと既存の詳細設計書のサンプルを確認しました。次に、勤怠情報入力画面の詳細設計書を作成します。

ユーザーから提供された情報:
1. 勤怠情報入力画面は、勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下すると表示される
2. 出社や退社などが手入力で入力できる
3. 手入力で入力して登録すると、勤務表画面で手入力した箇所の背景色が黄色に変更される
4. 日次確定ボタンを押して承認中になると、2枚目の画像のように編集できなくなる

画像から確認できる項目（1枚目の画像）:
- タイトル: 勤怠情報入力
- 日付表示: 2025年11月26日水曜日
- 出社: 8:48（テキストボックス）
- 退社: 18:46（テキストボックス）
- 休憩1: 12:00 ~ 13:00（開始・終了のテキストボックス）
- 休憩2: テキストボックス（空）、+ボタンあり
- 公用外出1: テキストボックス（空）
- 公用外出2: テキストボックス（空）、+ボタンあり
- 勤務場所: プルダウン（通勤）
- 登録ボタン（青色）
- キャンセルリンク


- リセットボタン（ピンク色）
- 日次確定するチェックボックス

追加の画面状態を分析すると、承認プロセスに関する重要な機能が明らかになります。承認中の画面では、すべてのフィールドが非活性化され、ユーザーの編集が制限されます。勤務場所が「在宅」に変更され、登録機能が無効化されています。閉じるリンクのみが表示され、ユーザーの操作を最小限に抑えています。</details></think>

---

ルールファイルと既存の詳細設計書の形式を確認しました。それでは、勤怠情報入力画面の詳細設計書を作成します。

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 558, lines removed: 1

```diff
@@ -1,1 +1,558 @@
- 
+ # TeamSpirit勤怠管理システム
+ # 勤怠情報入力画面
+ 
+ ## 概要
+ 本画面は、勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下すると表示されるダイアログ形式の入力画面です。
+ 出社時刻、退社時刻、休憩時間、公用外出時間、勤務場所を手入力で入力・変更することができます。
+ 手入力で時刻を入力して登録すると、勤務表画面の該当箇所の背景色が黄色に変更されます。
+ また、日次確定チェックボックスをONにして登録すると、日次確定申請が同時に行われます。
+ 日次確定後に承認中となった場合は、本画面は閲覧専用モードとなり編集ができなくなります。
+ 
+ ## 画面レイアウト
+ 
+ ### 参考画像
+ 
+ - 編集可能状態（初期画面）
+   - （提供された画像1枚目を参照）
+ 
+ - 閲覧専用状態（承認中）
+   - （提供された画像2枚目を参照）
+ 
+ ## 画面項目定義
+ 
+ | No | 項目名 | 種別 | 入力タイプ | ドメイン | 最小桁数 | 最大桁数 | 表示文字数 | 表示形式 | 表示/非表示 | 活性/非活性 | 初期値 | 備考 |
+ | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- |
+ | | &lt;ヘッダー部分&gt; | | | | | | | | | | | |
+ | 1 | タイトル | 出力 | | 文字 | | | | | 表示 | 活性 | 勤怠情報入力 | ダイアログのタイトル「勤怠情報入力」を表示 |
+ | 2 | 閉じるボタン | ボタン | | | | | | | 表示 | 活性 | | ダイアログを閉じる。「X」アイコン |
+ | 3 | 日付表示 | 出力 | | 文字 | | | | YYYY年MM月DD日X曜日 | 表示 | 活性 | | 対象日の日付を表示（例: 2025年11月26日水曜日） |
+ | | &lt;入力エリア&gt; | | | | | | | | | | | |
+ | 4 | 出社ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 出社 | 出社時刻入力欄のラベル |
+ | 5 | 出社時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 出社時刻を入力。承認中の場合は非活性。手入力で変更した場合は背景色が黄色に変更される |
+ | 6 | 退社ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 退社 | 退社時刻入力欄のラベル |
+ | 7 | 退社時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 退社時刻を入力。承認中の場合は非活性。手入力で変更した場合は背景色が黄色に変更される |
+ | 8 | 休憩1ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 休憩1 | 休憩1入力欄のラベル |
+ | 9 | 休憩1開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩1の開始時刻を入力。承認中の場合は非活性 |
+ | 10 | 休憩1チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 休憩時間の開始と終了の区切り文字 |
+ | 11 | 休憩1終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩1の終了時刻を入力。承認中の場合は非活性 |
+ | 12 | 休憩2ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 休憩2 | 休憩2入力欄のラベル |
+ | 13 | 休憩2開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩2の開始時刻を入力。承認中の場合は非活性 |
+ | 14 | 休憩2チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 休憩時間の開始と終了の区切り文字 |
+ | 15 | 休憩2終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩2の終了時刻を入力。承認中の場合は非活性 |
+ | 16 | 休憩追加ボタン | ボタン | | | | | | | 条件付き表示 | 条件付き活性 | | 休憩時間枠を追加する。「+」アイコン。承認中の場合は非表示 |
+ | 17 | 公用外出1ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 公用外出1 | 公用外出1入力欄のラベル |
+ | 18 | 公用外出1開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出1の開始時刻を入力。承認中の場合は非活性 |
+ | 19 | 公用外出1チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 公用外出時間の開始と終了の区切り文字 |
+ | 20 | 公用外出1終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出1の終了時刻を入力。承認中の場合は非活性 |
+ | 21 | 公用外出2ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 公用外出2 | 公用外出2入力欄のラベル |
+ | 22 | 公用外出2開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出2の開始時刻を入力。承認中の場合は非活性 |
+ | 23 | 公用外出2チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 公用外出時間の開始と終了の区切り文字 |
+ | 24 | 公用外出2終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出2の終了時刻を入力。承認中の場合は非活性 |
+ | 25 | 公用外出追加ボタン | ボタン | | | | | | | 条件付き表示 | 条件付き活性 | | 公用外出時間枠を追加する。「+」アイコン。承認中の場合は非表示 |
+ | 26 | 勤務場所ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 勤務場所 | 勤務場所入力欄のラベル |
+ | 27 | 勤務場所 | 入力 | プルダウン | 文字 | | | | | 表示 | 条件付き活性 | 通勤 | 勤務場所を選択（通勤、在宅など）。承認中の場合は非活性。手入力で変更した場合は背景色が黄色に変更される |
+ | 28 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所選択肢一覧 | 出力 | | リスト | | | | | 表示 | 活性 | | プルダウンで選択可能な勤務場所の一覧 |
+ | 29 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所名 | 出力 | | 文字 | | | | | 表示 | 活性 | | 各勤務場所の名称（通勤、在宅など） |
+ | | &lt;操作ボタンエリア（編集可能時）&gt; | | | | | | | | | | | |
+ | 30 | 登録ボタン | ボタン | | | | | | | 条件付き表示 | 活性 | | 入力内容を登録する。青色のボタン。承認中の場合は非表示 |
+ | 31 | キャンセルリンク | リンク | | | | | | | 条件付き表示 | 活性 | | 入力をキャンセルしてダイアログを閉じる。承認中の場合は非表示 |
+ | 32 | リセットボタン | ボタン | | | | | | | 条件付き表示 | 活性 | | 入力内容を初期状態にリセットする。ピンク色のボタン。承認中の場合は非表示 |
+ | | &lt;日次確定エリア&gt; | | | | | | | | | | | |
+ | 33 | 日次確定するチェックボックス | 入力 | チェックボックス | フラグ | | | | | 条件付き表示 | 活性 | OFF | 登録と同時に日次確定申請を行う場合にON。承認中の場合は非表示 |
+ | 34 | 日次確定するラベル | ラベル | | 文字 | | | | | 条件付き表示 | 活性 | 日次確定する | 日次確定チェックボックスのラベル。承認中の場合は非表示 |
+ | | &lt;操作ボタンエリア（閲覧専用時）&gt; | | | | | | | | | | | |
+ | 35 | 閉じるリンク | リンク | | | | | | | 条件付き表示 | 活性 | | ダイアログを閉じる。承認中の場合のみ表示 |
+ 
+ ## 入出力項目定義
+ 
+ | No | 項目名 | 種別 | 画面遷移 | ドメイン | 必須 | デフォルト値 | 備考 |
+ | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- |
+ | 1 | 従業員ID | 入力 | 勤務表画面 | 文字 | 必須 | | ログイン中の従業員ID |
+ | 2 | 対象日付 | 入力 | 勤務表画面 | 日付 | 必須 | | 編集対象の日付（YYYY-MM-DD形式） |
+ | 3 | 初期フォーカス項目 | 入力 | 勤務表画面 | 文字 | 任意 | | ダイアログ表示時にフォーカスを当てる項目（出社/退社/勤務場所）。押下された項目に応じて設定 |
+ | 4 | 承認状態 | 入力 | 勤務表画面 | 文字 | 必須 | | 対象日の承認状態（NONE/PENDING/APPROVED/REJECTED） |
+ | 5 | 更新完了フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 登録ボタン押下で更新が完了した場合にTRUE |
+ | 6 | 手入力フラグ | 出力 | 勤務表画面 | オブジェクト | 必須 | | 手入力で変更された項目を示すフラグ |
+ | 7 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 出社時刻が手入力で変更された場合にTRUE |
+ | 8 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 退社時刻が手入力で変更された場合にTRUE |
+ | 9 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 勤務場所が手入力で変更された場合にTRUE |
+ 
+ ## その他の項目定義
+ 
+ | No | 項目名 | ドメイン | 正常異常区分 | デフォルト値 | 備考 |
+ | :----- | :----- | :----- | :----- | :----- | :----- |
+ | 1 | 日次勤務データ | オブジェクト | 正常 | | 対象日付の勤務データ |
+ | 2 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤怠ID | 文字 | 正常 | | ATTENDANCE_RECORD.ATTENDANCE_ID |
+ | 3 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.CLOCK_IN_TIME |
+ | 4 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.CLOCK_OUT_TIME |
+ | 5 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤打刻時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME（打刻機による元の時刻） |
+ | 6 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤打刻時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME（打刻機による元の時刻） |
+ | 7 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所コード | 文字 | 正常 | | ATTENDANCE_RECORD.WORK_LOCATION_CODE |
+ | 8 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL |
+ | 9 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL |
+ | 10 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_LOCATION_MANUAL |
+ | 11 | 休憩時間リスト | リスト | 正常 | | BREAK_TIMEテーブルから取得 |
+ | 12 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩時間情報 | オブジェクト | 正常 | | 1つの休憩時間の情報 |
+ | 13 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩ID | 文字 | 正常 | | BREAK_TIME.BREAK_ID |
+ | 14 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩開始時刻 | 時間 | 正常 | | BREAK_TIME.BREAK_START_TIME |
+ | 15 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩終了時刻 | 時間 | 正常 | | BREAK_TIME.BREAK_END_TIME |
+ | 16 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩種別 | 文字 | 正常 | | BREAK_TIME.BREAK_TYPE（BREAK:休憩、OFFICIAL_OUTING:公用外出） |
+ | 17 | 勤務場所マスタ | リスト | 正常 | | WORK_LOCATIONテーブルから取得した勤務場所マスタ |
+ | 18 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所情報 | オブジェクト | 正常 | | 1つの勤務場所の情報 |
+ | 19 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所コード | 文字 | 正常 | | WORK_LOCATION.WORK_LOCATION_CODE |
+ | 20 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所名 | 文字 | 正常 | | WORK_LOCATION.WORK_LOCATION_NAME |
+ | 21 | 閲覧専用モード | フラグ | 共通 | FALSE | 承認中の場合はTRUE |
+ | 22 | 入力変更フラグ | オブジェクト | 正常 | | 各項目の変更状態を管理 |
+ | 23 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出社変更フラグ | フラグ | 正常 | FALSE | 出社時刻が変更された場合にTRUE |
+ | 24 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退社変更フラグ | フラグ | 正常 | FALSE | 退社時刻が変更された場合にTRUE |
+ | 25 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所変更フラグ | フラグ | 正常 | FALSE | 勤務場所が変更された場合にTRUE |
+ | 26 | エラーメッセージ | 文字 | 異常 | | エラー時に表示するメッセージ |
+ 
+ ## イベント処理説明
+ 
+ #### 名称：初期表示処理、英名：initializeDialog、処理タイミング：-
+ 
+ 1. 閲覧専用モード判定
+    - 入出力項目定義.承認状態がPENDINGの場合、閲覧専用モードをTRUEに設定する。
+ 
+ 2. 勤務場所マスタ取得
+    - API利用仕様に従い、勤務場所マスタを取得する。
+    - 【API利用仕様 No.1（勤務場所マスタ取得API）】
+ 
+ 3. 日次勤務データ取得
+    - API利用仕様に従い、対象日付の勤務データを取得する。
+    - 【API利用仕様 No.2（日次勤務データ取得API）】
+ 
+ 4. 画面表示
+    - 編集仕様に従い、画面を表示する。
+    - 【編集仕様 No.1（初期画面表示）】
+ 
+ 5. フォーカス設定
+    - 入出力項目定義.初期フォーカス項目が指定されている場合、該当項目にフォーカスを設定する。
+ 
+ #### 名称：出社時刻変更処理、英名：onClockInChange、処理タイミング：入力エリア.出社時刻.変更
+ 
+ 1. 変更フラグ更新
+    - 入力変更フラグ.出社変更フラグをTRUEに設定する。
+ 
+ 2. 手入力判定
+    - 日次勤務データ.出勤打刻時刻と異なる値が入力された場合、出勤手入力フラグをTRUEに設定する。
+ 
+ #### 名称：退社時刻変更処理、英名：onClockOutChange、処理タイミング：入力エリア.退社時刻.変更
+ 
+ 1. 変更フラグ更新
+    - 入力変更フラグ.退社変更フラグをTRUEに設定する。
+ 
+ 2. 手入力判定
+    - 日次勤務データ.退勤打刻時刻と異なる値が入力された場合、退勤手入力フラグをTRUEに設定する。
+ 
+ #### 名称：勤務場所変更処理、英名：onWorkLocationChange、処理タイミング：入力エリア.勤務場所.変更
+ 
+ 1. 変更フラグ更新
+    - 入力変更フラグ.勤務場所変更フラグをTRUEに設定する。
+ 
+ 2. 手入力判定
+    - 勤務場所手入力フラグをTRUEに設定する。
+ 
+ #### 名称：休憩追加ボタン押下処理、英名：onAddBreakClick、処理タイミング：入力エリア.休憩追加ボタン.押下
+ 
+ 1. 休憩時間枠追加
+    - 休憩時間リストに新しい休憩時間枠を追加する。
+    - 休憩種別は「BREAK」を設定する。
+ 
+ #### 名称：公用外出追加ボタン押下処理、英名：onAddOfficialOutingClick、処理タイミング：入力エリア.公用外出追加ボタン.押下
+ 
+ 1. 公用外出時間枠追加
+    - 休憩時間リストに新しい公用外出時間枠を追加する。
+    - 休憩種別は「OFFICIAL_OUTING」を設定する。
+ 
+ #### 名称：登録ボタン押下処理、英名：onRegisterClick、処理タイミング：操作ボタンエリア.登録ボタン.押下
+ 
+ 1. 入力チェック
+    - チェック仕様に従い、入力チェックを行う。
+    - 【チェック仕様 No.1（時刻入力チェック）】
+    - 【チェック仕様 No.2（時刻整合性チェック）】
+    
+    - エラー処理
+      1. エラー内容を画面に表示させ、処理を終了する。
+ 
+ 2. 勤怠データ更新
+    - API利用仕様に従い、勤怠データを更新する。
+    - 【API利用仕様 No.3（勤怠データ更新API）】
+ 
+ 3. 日次確定処理
+    - 画面項目定義.日次確定するチェックボックスがONの場合:
+      - API利用仕様に従い、日次確定申請を行う。
+      - 【API利用仕様 No.4（日次確定申請API）】
+ 
+ 4. 出力項目設定
+    - 入出力項目定義.更新完了フラグをTRUEに設定する。
+    - 入出力項目定義.手入力フラグに各項目の手入力フラグを設定する。
+ 
+ 5. ダイアログ閉じる
+    - ダイアログを閉じる。
+    - 勤務表画面に戻り、手入力した箇所の背景色が黄色に変更される。
+ 
+ #### 名称：キャンセルリンク押下処理、英名：onCancelClick、処理タイミング：操作ボタンエリア.キャンセルリンク.押下
+ 
+ 1. ダイアログ閉じる
+    - 入力内容を破棄してダイアログを閉じる。
+    - 勤務表画面に戻る。
+ 
+ #### 名称：リセットボタン押下処理、英名：onResetClick、処理タイミング：操作ボタンエリア.リセットボタン.押下
+ 
+ 1. 入力内容リセット
+    - 編集仕様に従い、入力内容を初期状態にリセットする。
+    - 【編集仕様 No.2（入力内容リセット）】
+ 
+ #### 名称：閉じるボタン押下処理、英名：onCloseButtonClick、処理タイミング：ヘッダー部分.閉じるボタン.押下
+ 
+ 1. ダイアログ閉じる
+    - ダイアログを閉じる。
+    - 勤務表画面に戻る。
+ 
+ #### 名称：閉じるリンク押下処理、英名：onCloseLinkClick、処理タイミング：操作ボタンエリア.閉じるリンク.押下
+ 
+ 1. ダイアログ閉じる
+    - ダイアログを閉じる。
+    - 勤務表画面に戻る。
+ 
+ ## 編集仕様
+ 
+ #### No.1
+ - 編集仕様名：初期画面表示
+ - 関連する取得仕様名：API利用仕様 No.2（日次勤務データ取得API）
+   | 項目名 | 編集内容 | 条件or前提 |
+   | :--- | :--- | :--- |
+   | タイトル | 「勤怠情報入力」 | |
+   | 日付表示 | 入出力項目定義.対象日付をYYYY年MM月DD日X曜日形式で表示 | |
+   | 出社時刻 | 日次勤務データ.出勤時刻をH:MM形式で表示 | |
+   | 退社時刻 | 日次勤務データ.退勤時刻をH:MM形式で表示 | |
+   | 休憩1開始時刻 | 休憩時間リスト[0].休憩開始時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
+   | 休憩1終了時刻 | 休憩時間リスト[0].休憩終了時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
+   | 休憩2開始時刻 | 休憩時間リスト[1].休憩開始時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
+   | 休憩2終了時刻 | 休憩時間リスト[1].休憩終了時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
+   | 公用外出1開始時刻 | 休憩時間リスト.休憩開始時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの最初のレコード |
+   | 公用外出1終了時刻 | 休憩時間リスト.休憩終了時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの最初のレコード |
+   | 公用外出2開始時刻 | 休憩時間リスト.休憩開始時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの2番目のレコード |
+   | 公用外出2終了時刻 | 休憩時間リスト.休憩終了時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの2番目のレコード |
+   | 勤務場所 | 日次勤務データ.勤務場所コードに対応する勤務場所名を選択状態で表示 | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所選択肢一覧 | 勤務場所マスタ.勤務場所名 | |
+   | 登録ボタン | 表示 | 閲覧専用モードがFALSEの場合 |
+   | キャンセルリンク | 表示 | 閲覧専用モードがFALSEの場合 |
+   | リセットボタン | 表示 | 閲覧専用モードがFALSEの場合 |
+   | 日次確定するチェックボックス | 表示 | 閲覧専用モードがFALSEの場合 |
+   | 日次確定するラベル | 表示 | 閲覧専用モードがFALSEの場合 |
+   | 閉じるリンク | 表示 | 閲覧専用モードがTRUEの場合 |
+   | 全入力項目 | 非活性 | 閲覧専用モードがTRUEの場合 |
+ 
+ #### No.2
+ - 編集仕様名：入力内容リセット
+ - 関連する取得仕様名：-
+   | 項目名 | 編集内容 | 条件or前提 |
+   | :--- | :--- | :--- |
+   | 出社時刻 | 日次勤務データ.出勤時刻をH:MM形式で表示 | |
+   | 退社時刻 | 日次勤務データ.退勤時刻をH:MM形式で表示 | |
+   | 休憩1開始時刻 | 日次勤務データ取得時の値に戻す | |
+   | 休憩1終了時刻 | 日次勤務データ取得時の値に戻す | |
+   | 休憩2開始時刻 | 日次勤務データ取得時の値に戻す | |
+   | 休憩2終了時刻 | 日次勤務データ取得時の値に戻す | |
+   | 公用外出1開始時刻 | 日次勤務データ取得時の値に戻す | |
+   | 公用外出1終了時刻 | 日次勤務データ取得時の値に戻す | |
+   | 公用外出2開始時刻 | 日次勤務データ取得時の値に戻す | |
+   | 公用外出2終了時刻 | 日次勤務データ取得時の値に戻す | |
+   | 勤務場所 | 日次勤務データ.勤務場所コードに対応する勤務場所名を選択状態で表示 | |
+   | 日次確定するチェックボックス | OFF | |
+   | 入力変更フラグ | 全てFALSE | |
+ 
+ ## チェック仕様
+ 
+ #### No.1
+ - チェック仕様：時刻入力チェック
+ - 分類：単項目チェック
+ - 取得元：画面項目定義
+   | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
+   | :--- | :--- | :--- | :--- | :--- |
+   | 出社時刻 | フォーマット | 出社時刻がH:MM形式でない場合、エラー | E_ATT_001 | 出社時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 退社時刻 | フォーマット | 退社時刻がH:MM形式でない場合、エラー | E_ATT_002 | 退社時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 休憩1開始時刻 | フォーマット | 休憩1開始時刻がH:MM形式でない場合、エラー | E_ATT_003 | 休憩開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 休憩1終了時刻 | フォーマット | 休憩1終了時刻がH:MM形式でない場合、エラー | E_ATT_004 | 休憩終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 休憩2開始時刻 | フォーマット | 休憩2開始時刻がH:MM形式でない場合、エラー | E_ATT_003 | 休憩開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 休憩2終了時刻 | フォーマット | 休憩2終了時刻がH:MM形式でない場合、エラー | E_ATT_004 | 休憩終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 公用外出1開始時刻 | フォーマット | 公用外出1開始時刻がH:MM形式でない場合、エラー | E_ATT_005 | 公用外出開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 公用外出1終了時刻 | フォーマット | 公用外出1終了時刻がH:MM形式でない場合、エラー | E_ATT_006 | 公用外出終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 公用外出2開始時刻 | フォーマット | 公用外出2開始時刻がH:MM形式でない場合、エラー | E_ATT_005 | 公用外出開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 公用外出2終了時刻 | フォーマット | 公用外出2終了時刻がH:MM形式でない場合、エラー | E_ATT_006 | 公用外出終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
+   | 出社時刻 | 数値範囲 | 出社時刻が0:00～23:59の範囲外の場合、エラー | E_ATT_007 | 出社時刻は0:00～23:59の範囲で入力してください。 |
+   | 退社時刻 | 数値範囲 | 退社時刻が0:00～29:59の範囲外の場合、エラー | E_ATT_008 | 退社時刻は0:00～29:59の範囲で入力してください。（24時以降の深夜勤務に対応） |
+ 
+ #### No.2
+ - チェック仕様：時刻整合性チェック
+ - 分類：相関項目チェック
+ - 取得元：画面項目定義
+   | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
+   | :--- | :--- | :--- | :--- | :--- |
+   | 出社・退社時刻 | 順序整合 | 出社時刻が退社時刻より後の場合、エラー | E_ATT_011 | 出社時刻は退社時刻より前に設定してください。 |
+   | 休憩1 | 順序整合 | 休憩1開始時刻が休憩1終了時刻より後の場合、エラー | E_ATT_012 | 休憩開始時刻は休憩終了時刻より前に設定してください。 |
+   | 休憩2 | 順序整合 | 休憩2開始時刻が休憩2終了時刻より後の場合、エラー | E_ATT_012 | 休憩開始時刻は休憩終了時刻より前に設定してください。 |
+   | 公用外出1 | 順序整合 | 公用外出1開始時刻が公用外出1終了時刻より後の場合、エラー | E_ATT_013 | 公用外出開始時刻は公用外出終了時刻より前に設定してください。 |
+   | 公用外出2 | 順序整合 | 公用外出2開始時刻が公用外出2終了時刻より後の場合、エラー | E_ATT_013 | 公用外出開始時刻は公用外出終了時刻より前に設定してください。 |
+   | 休憩1 | 依存 | 休憩1開始時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
+   | 休憩1 | 依存 | 休憩1終了時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
+   | 休憩2 | 依存 | 休憩2開始時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
+   | 休憩2 | 依存 | 休憩2終了時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
+   | 公用外出1 | 依存 | 公用外出1開始時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
+   | 公用外出1 | 依存 | 公用外出1終了時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
+   | 公用外出2 | 依存 | 公用外出2開始時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
+   | 公用外出2 | 依存 | 公用外出2終了時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
+   | 休憩時間 | 複合整合 | 休憩時間が出社時刻～退社時刻の範囲外の場合、エラー | E_ATT_016 | 休憩時間は出社時刻から退社時刻の範囲内で設定してください。 |
+   | 公用外出時間 | 複合整合 | 公用外出時間が出社時刻～退社時刻の範囲外の場合、エラー | E_ATT_017 | 公用外出時間は出社時刻から退社時刻の範囲内で設定してください。 |
+ 
+ ## テーブル取得仕様
+ 
+ #### No.1
+ - 取得仕様名：日次勤務データ取得
+ - テーブル名：ATTENDANCE_RECORD
+   | 項目名 | 取得内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 勤怠ID | ATTENDANCE_RECORD.ATTENDANCE_ID | |
+   | 出勤時刻 | ATTENDANCE_RECORD.CLOCK_IN_TIME | |
+   | 退勤時刻 | ATTENDANCE_RECORD.CLOCK_OUT_TIME | |
+   | 出勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME | |
+   | 退勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME | |
+   | 勤務場所コード | ATTENDANCE_RECORD.WORK_LOCATION_CODE | |
+   | 出勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL | |
+   | 退勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL | |
+   | 勤務場所手入力フラグ | ATTENDANCE_RECORD.IS_LOCATION_MANUAL | |
+ - 関連する取得仕様
+   - テーブル取得仕様 No.2（休憩時間取得）
+ - 取得条件
+   - ATTENDANCE_RECORD.EMPLOYEE_ID = 入出力項目定義.従業員ID
+   - ATTENDANCE_RECORD.WORK_DATE = 入出力項目定義.対象日付
+ - その他
+   - なし
+ 
+ #### No.2
+ - 取得仕様名：休憩時間取得
+ - テーブル名：BREAK_TIME
+   | 項目名 | 取得内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 休憩ID | BREAK_TIME.BREAK_ID | |
+   | 休憩開始時刻 | BREAK_TIME.BREAK_START_TIME | |
+   | 休憩終了時刻 | BREAK_TIME.BREAK_END_TIME | |
+   | 休憩種別 | BREAK_TIME.BREAK_TYPE | BREAK:休憩、OFFICIAL_OUTING:公用外出 |
+ - 関連する取得仕様
+   - なし
+ - 取得条件
+   - BREAK_TIME.ATTENDANCE_ID = テーブル取得仕様No.1.勤怠ID
+ - その他
+   - BREAK_START_TIMEの昇順でソート
+ 
+ #### No.3
+ - 取得仕様名：勤務場所マスタ取得
+ - テーブル名：WORK_LOCATION
+   | 項目名 | 取得内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 勤務場所コード | WORK_LOCATION.WORK_LOCATION_CODE | |
+   | 勤務場所名 | WORK_LOCATION.WORK_LOCATION_NAME | |
+ - 関連する取得仕様
+   - なし
+ - 取得条件
+   - WORK_LOCATION.IS_ACTIVE = TRUE
+ - その他
+   - DISPLAY_ORDERの昇順でソート
+ 
+ ## テーブル更新仕様
+ 
+ #### No.1
+ - 更新仕様名：勤怠データ更新
+ - テーブル名：ATTENDANCE_RECORD
+ - 種別：更新
+   | 項目名 | 更新内容 | 補足 |
+   | :--- | :--- | :--- |
+   | CLOCK_IN_TIME | 画面項目定義.出社時刻 | |
+   | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | |
+   | WORK_LOCATION_CODE | 画面項目定義.勤務場所の勤務場所コード | |
+   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | 出社時刻が変更された場合TRUE |
+   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | 退社時刻が変更された場合TRUE |
+   | IS_LOCATION_MANUAL | 入力変更フラグ.勤務場所変更フラグ | 勤務場所が変更された場合TRUE |
+   | UPDATED_AT | 現在日時 | |
+ - 関連する取得仕様
+   - テーブル取得仕様 No.1（日次勤務データ取得）
+ - 更新条件
+   - ATTENDANCE_RECORD.EMPLOYEE_ID = 入出力項目定義.従業員ID
+   - ATTENDANCE_RECORD.WORK_DATE = 入出力項目定義.対象日付
+ - その他
+   - なし
+ 
+ #### No.2
+ - 更新仕様名：休憩時間更新
+ - テーブル名：BREAK_TIME
+ - 種別：削除・登録
+   | 項目名 | 更新内容 | 補足 |
+   | :--- | :--- | :--- |
+   | ATTENDANCE_ID | 日次勤務データ.勤怠ID | |
+   | BREAK_START_TIME | 画面項目定義.休憩開始時刻 | |
+   | BREAK_END_TIME | 画面項目定義.休憩終了時刻 | |
+   | BREAK_TYPE | 休憩種別（BREAK/OFFICIAL_OUTING） | |
+   | CREATED_AT | 現在日時 | |
+   | UPDATED_AT | 現在日時 | |
+ - 関連する取得仕様
+   - なし
+ - 更新条件
+   - 既存の休憩時間レコードを全て削除後、新規登録
+ - その他
+   - 休憩時間と公用外出時間を合わせて更新
+ 
+ ## API利用仕様
+ 
+ #### No.1
+ - API仕様名：勤務場所マスタ取得API
+ - リクエスト
+   | 項目名 | リクエスト内容 | 補足 |
+   | :--- | :--- | :--- |
+   | HTTPメソッド | GET | |
+   | エンドポイント | /api/master/work-locations | |
+ - レスポンス
+   | 項目名 | レスポンス内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 勤務場所マスタ | 勤務場所マスタリスト | JSON形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所コード | WORK_LOCATION.WORK_LOCATION_CODE | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所名 | WORK_LOCATION.WORK_LOCATION_NAME | |
+ - 関連する取得仕様
+   - テーブル取得仕様 No.3（勤務場所マスタ取得）
+ - その他
+   - IS_ACTIVE=TRUEの勤務場所をDISPLAY_ORDER順で取得
+ 
+ #### No.2
+ - API仕様名：日次勤務データ取得API
+ - リクエスト
+   | 項目名 | リクエスト内容 | 補足 |
+   | :--- | :--- | :--- |
+   | HTTPメソッド | GET | |
+   | エンドポイント | /api/attendance/daily | |
+   | EMPLOYEE_ID | 入出力項目定義.従業員ID | クエリパラメータ |
+   | WORK_DATE | 入出力項目定義.対象日付 | クエリパラメータ、YYYY-MM-DD形式 |
+ - レスポンス
+   | 項目名 | レスポンス内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 日次勤務データ | 1日分の勤務記録 | JSON形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤怠ID | ATTENDANCE_RECORD.ATTENDANCE_ID | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤時刻 | ATTENDANCE_RECORD.CLOCK_IN_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤時刻 | ATTENDANCE_RECORD.CLOCK_OUT_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所コード | ATTENDANCE_RECORD.WORK_LOCATION_CODE | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所手入力フラグ | ATTENDANCE_RECORD.IS_LOCATION_MANUAL | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩時間リスト | BREAK_TIME | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩ID | BREAK_TIME.BREAK_ID | |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩開始時刻 | BREAK_TIME.BREAK_START_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩終了時刻 | BREAK_TIME.BREAK_END_TIME | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;休憩種別 | BREAK_TIME.BREAK_TYPE | |
+ - 関連する取得仕様
+   - テーブル取得仕様 No.1（日次勤務データ取得）
+   - テーブル取得仕様 No.2（休憩時間取得）
+ - その他
+   - ATTENDANCE_RECORDとBREAK_TIMEを結合して返却
+ 
+ #### No.3
+ - API仕様名：勤怠データ更新API
+ - リクエスト
+   | 項目名 | リクエスト内容 | 補足 |
+   | :--- | :--- | :--- |
+   | HTTPメソッド | PUT | |
+   | エンドポイント | /api/attendance/daily | |
+   | EMPLOYEE_ID | 入出力項目定義.従業員ID | リクエストボディ |
+   | WORK_DATE | 入出力項目定義.対象日付 | リクエストボディ、YYYY-MM-DD形式 |
+   | CLOCK_IN_TIME | 画面項目定義.出社時刻 | リクエストボディ、HH:MM形式 |
+   | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | リクエストボディ、HH:MM形式 |
+   | WORK_LOCATION_CODE | 画面項目定義.勤務場所 | リクエストボディ |
+   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | リクエストボディ |
+   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | リクエストボディ |
+   | IS_LOCATION_MANUAL | 入力変更フラグ.勤務場所変更フラグ | リクエストボディ |
+   | BREAK_TIMES | 休憩時間リスト | リクエストボディ、配列形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BREAK_START_TIME | 休憩開始時刻 | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BREAK_END_TIME | 休憩終了時刻 | HH:MM形式 |
+   | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BREAK_TYPE | 休憩種別 | BREAK/OFFICIAL_OUTING |
+ - レスポンス
+   | 項目名 | レスポンス内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 成功フラグ | 成功/失敗 | true/false |
+   | メッセージ | 処理結果メッセージ | |
+ - 関連する取得仕様
+   - なし
+ - その他
+   - テーブル更新仕様 No.1（勤怠データ更新）、No.2（休憩時間更新）を実行
+   - 手入力フラグがTRUEの場合、勤務表画面で該当項目の背景色が黄色に変更される
+ 
+ #### No.4
+ - API仕様名：日次確定申請API
+ - リクエスト
+   | 項目名 | リクエスト内容 | 補足 |
+   | :--- | :--- | :--- |
+   | HTTPメソッド | POST | |
+   | エンドポイント | /api/attendance/daily-confirmation | |
+   | EMPLOYEE_ID | 入出力項目定義.従業員ID | リクエストボディ |
+   | WORK_DATE | 入出力項目定義.対象日付 | リクエストボディ、YYYY-MM-DD形式 |
+ - レスポンス
+   | 項目名 | レスポンス内容 | 補足 |
+   | :--- | :--- | :--- |
+   | 成功フラグ | 成功/失敗 | true/false |
+   | メッセージ | 処理結果メッセージ | |
+ - 関連する取得仕様
+   - なし
+ - その他
+   - 日次確定申請成功後、ATTENDANCE_RECORDのAPPROVAL_STATUSがPENDINGに更新される
+   - 勤務表画面の該当日の申請状況アイコンが↑マーク（申請中）に変更される
+ 
+ ## 補足説明
+ 
+ ### 勤務表画面からの連携
+ 勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下することで、本画面がダイアログ形式で表示されます。
+ 押下された項目に応じて、該当の入力欄にフォーカスが設定されます。
+ 
+ ### 手入力と背景色の変更
+ 本画面で出社時刻、退社時刻、勤務場所を手入力で変更して登録すると、以下の処理が行われます：
+ 
+ 1. **手入力フラグの設定**
+    - 変更された項目に対応する手入力フラグ（IS_CLOCK_IN_MANUAL、IS_CLOCK_OUT_MANUAL、IS_LOCATION_MANUAL）がTRUEに設定されます。
+ 
+ 2. **背景色の変更**
+    - 勤務表画面に戻ると、手入力フラグがTRUEの項目のセルの背景色が黄色（#FFFF00）に変更されます。
+    - これにより、打刻機による自動入力ではなく、手入力で変更された箇所が視覚的に識別できます。
+ 
+ ### 閲覧専用モード（承認中状態）
+ 日次確定ボタンを押して承認中になると、本画面は閲覧専用モードになります：
+ 
+ 1. **閲覧専用モードの条件**
+    - 入出力項目定義.承認状態がPENDINGの場合に閲覧専用モードになります。
+ 
+ 2. **閲覧専用モード時の表示**
+    - 全ての入力項目が非活性（グレーアウト）になり、編集できなくなります。
+    - 「登録」「キャンセル」「リセット」ボタンおよび「日次確定する」チェックボックスは非表示になります。
+    - 代わりに「閉じる」リンクが表示されます。
+ 
+ 3. **閲覧専用モード時の操作**
+    - 「閉じる」リンクまたはヘッダーの「X」ボタンでダイアログを閉じることのみ可能です。
+ 
+ ### 休憩時間と公用外出の管理
+ 休憩時間と公用外出は、同じBREAK_TIMEテーブルで管理されますが、BREAK_TYPE列で種別を区別します：
+ 
+ - **BREAK**: 通常の休憩時間
+ - **OFFICIAL_OUTING**: 公用外出
+ 
+ 初期状態では、休憩1、休憩2、公用外出1、公用外出2の4つの入力枠が表示されます。
+ 「+」ボタンを押下することで、追加の休憩時間枠または公用外出時間枠を追加できます。
+ 
+ ### 時刻の入力形式
+ 時刻はH:MM形式（例: 8:48、12:00、18:46）で入力します。
+ 退社時刻は深夜勤務に対応するため、24:00以降の時刻（例: 25:30）も入力可能です。
+ 
+ ## 変更履歴
+ 
+ | 日付 | 変更内容 | 変更者 |
+ | --- | --- | --- |
+ | 2025-12-09 | 初版作成 | AI Assistant |
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
詳細設計書を作成しました。次に、詳細設計一覧ファイルに新しい画面を追加する必要があります。一覧ファイルを確認して更新します。</details></think>

---

詳細設計書を作成しました。次に、詳細設計一覧ファイルに新しい画面を追加します。

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/detailed-design/ui/detailed-design-list.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
詳細設計一覧ファイルを確認しました。勤務表画面（attendance-table-screen.md）と勤怠関連申請画面（attendance-application-screen.md）がリストにないようです。これらと今回作成した勤怠情報入力画面を追加します。</details></think>

---

詳細設計一覧ファイルに新しい画面を追加します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/detailed-design-list.md</summary>

**Chunk 1**
Lines added: 3, lines removed: undefined

```diff
@@ -11,4 +11,7 @@
  | 1 | SCR_TS_000101 | ログイン画面 | 社員コードとパスワードによる認証機能 | [login-screen.md](./login-screen.md) | 作成済み | 2025-11-27 |
  | 2 | SCR_TS_010101 | ホーム画面 | WEBタイムレコーダーによる出退勤打刻、勤務場所選択、お知らせ表示 | [home-screen.md](./home-screen.md) | 作成済み | 2025-12-01 |
+ | 3 | SCR_TS_020101 | 勤務表画面 | 月次の勤怠データ一覧表示、各種申請への導線 | [attendance-table-screen.md](./attendance-table-screen.md) | 作成済み | 2025-12-08 |
+ | 4 | SCR_TS_020201 | 勤怠関連申請画面 | 日次確定、休暇申請、休日出勤申請、残業申請、早朝勤務申請、振替申請 | [attendance-application-screen.md](./attendance-application-screen.md) | 作成済み | 2025-12-08 |
+ | 5 | SCR_TS_020301 | 勤怠情報入力画面 | 出社・退社時刻、休憩時間、公用外出、勤務場所の手入力 | [attendance-input-dialog.md](./attendance-input-dialog.md) | 作成済み | 2025-12-09 |
  
  ## ステータス定義
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に変更履歴も更新します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/detailed-design-list.md</summary>

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -31,4 +31,6 @@
  | 2025-11-27 | 初版作成（ログイン画面追加） | AI Assistant |
  | 2025-12-01 | ホーム画面追加 | AI Assistant |
+ | 2025-12-08 | 勤務表画面、勤怠関連申請画面追加 | AI Assistant |
+ | 2025-12-09 | 勤怠情報入力画面追加 | AI Assistant |
  
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
詳細設計書の作成と一覧の更新が完了しました。ユーザーに作成完了を報告します。</details></think>

---

勤怠情報入力画面の詳細設計書を作成しました。

## 作成したファイル

`docs/detailed-design/ui/attendance-input-dialog.md`

## 詳細設計書の概要

### 画面概要
- 勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下すると表示されるダイアログ形式の入力画面
- 出社時刻、退社時刻、休憩時間、公用外出時間、勤務場所を手入力で変更可能

### 主な画面項目
| 項目 | 説明 |
|------|------|
| 出社時刻 | 出勤時刻をH:MM形式で入力 |
| 退社時刻 | 退勤時刻をH:MM形式で入力 |
| 休憩1・休憩2 | 休憩時間帯を入力（+ボタンで追加可能） |
| 公用外出1・公用外出2 | 公用外出時間帯を入力（+ボタンで追加可能） |
| 勤務場所 | プルダウンで選択（通勤、在宅など） |
| 登録ボタン | 入力内容を保存 |
| 日次確定するチェックボックス | 登録と同時に日次確定申請を行う |
| リセットボタン | 入力内容を初期状態に戻す |

### 主な仕様
1. **手入力と背景色変更**
   - 出社・退社・勤務場所を手入力で変更して登録すると、勤務表画面の該当箇所の背景色が黄色に変更される

2. **閲覧専用モード（承認中状態）**
   - 日次確定後に承認中になると、全ての入力項目が非活性になり編集不可
   - 「閉じる」リンクのみ表示

3. **チェック仕様**
   - 時刻入力チェック（H:MM形式、範囲チェック）
   - 時刻整合性チェック（出社＜退社、開始＜終了、休憩時間の範囲チェック等）

### 詳細設計一覧への追加
`docs/detailed-design/ui/detailed-design-list.md` に画面ID: `SCR_TS_020301` として追加しました。

---

_**User (2025-12-08 08:46Z)**_

日時確定するチェックボックスでチェックボックスを押して登録をすると、工数実績が入力できていませんみたいなダイアログ画面はあった方が良いかと思います。また勤務場所の手入力(ドロップダウンから選択)は背景色は変わりません。

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
ユーザーから2点のフィードバックをいただきました：

1. 日次確定するチェックボックスをONにして登録ボタンを押した場合、工数実績が入力されていない場合は「工数実績が入力できていません」のようなエラーダイアログを表示する必要がある

2. 勤務場所の手入力（ドロップダウンから選択）では背景色は黄色に変わらない（出社・退社のみ）

これらを反映して詳細設計書を更新する必要があります。</details></think>

---

ご指摘ありがとうございます。2点の修正を行います：

1. **日次確定時の工数実績チェック**: 日次確定チェックボックスをONにして登録する際、工数実績が入力されていない場合のエラーダイアログを追加
2. **勤務場所の背景色**: 勤務場所は手入力でも背景色は変わらない（出社・退社のみ黄色になる）

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
詳細設計書の内容を確認しました。以下の修正が必要です：

1. **エラーダイアログの画面項目定義を追加** - 工数実績が入力されていない場合のエラーダイアログ
2. **日次確定時のチェック仕様を追加** - 工数実績の入力チェック（No.3として追加）
3. **勤務場所の背景色変更に関する記述を削除** - 勤務場所は手入力でも背景色は変わらない
4. **入出力項目定義から勤務場所手入力フラグを削除**
5. **補足説明を更新** - 背景色変更は出社・退社のみ

これらの修正を行います。</details></think>

---

詳細設計書を修正します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -5,5 +5,5 @@
  本画面は、勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下すると表示されるダイアログ形式の入力画面です。
  出社時刻、退社時刻、休憩時間、公用外出時間、勤務場所を手入力で入力・変更することができます。
- 手入力で時刻を入力して登録すると、勤務表画面の該当箇所の背景色が黄色に変更されます。
+ 出社時刻・退社時刻を手入力で入力して登録すると、勤務表画面の該当箇所の背景色が黄色に変更されます。（勤務場所は背景色変更の対象外）
  また、日次確定チェックボックスをONにして登録すると、日次確定申請が同時に行われます。
  日次確定後に承認中となった場合は、本画面は閲覧専用モードとなり編集ができなくなります。
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
概要部分を修正しました。次に、勤務場所の項目定義から「手入力で変更した場合は背景色が黄色に変更される」という記述を削除します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -51,5 +51,5 @@
  | 25 | 公用外出追加ボタン | ボタン | | | | | | | 条件付き表示 | 条件付き活性 | | 公用外出時間枠を追加する。「+」アイコン。承認中の場合は非表示 |
  | 26 | 勤務場所ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 勤務場所 | 勤務場所入力欄のラベル |
- | 27 | 勤務場所 | 入力 | プルダウン | 文字 | | | | | 表示 | 条件付き活性 | 通勤 | 勤務場所を選択（通勤、在宅など）。承認中の場合は非活性。手入力で変更した場合は背景色が黄色に変更される |
+ | 27 | 勤務場所 | 入力 | プルダウン | 文字 | | | | | 表示 | 条件付き活性 | 通勤 | 勤務場所を選択（通勤、在宅など）。承認中の場合は非活性 |
  | 28 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所選択肢一覧 | 出力 | | リスト | | | | | 表示 | 活性 | | プルダウンで選択可能な勤務場所の一覧 |
  | 29 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所名 | 出力 | | 文字 | | | | | 表示 | 活性 | | 各勤務場所の名称（通勤、在宅など） |
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、エラーダイアログの画面項目定義を追加します。閉じるリンクの後に追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 5, lines removed: undefined

```diff
@@ -63,4 +63,9 @@
  | | &lt;操作ボタンエリア（閲覧専用時）&gt; | | | | | | | | | | | |
  | 35 | 閉じるリンク | リンク | | | | | | | 条件付き表示 | 活性 | | ダイアログを閉じる。承認中の場合のみ表示 |
+ | | &lt;エラーダイアログ&gt; | | | | | | | | | | | |
+ | 36 | エラーダイアログ | ダイアログ | | | | | | | 条件付き表示 | 活性 | | 日次確定チェック時のエラー時に表示 |
+ | 37 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;タイトル | ラベル | | 文字 | | | | | 表示 | 活性 | エラー | ダイアログのタイトル |
+ | 38 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;エラーメッセージ | 出力 | | 文字 | | | | | 表示 | 活性 | | エラーの内容を表示（例：「工数実績が入力されていません」） |
+ | 39 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;OKボタン | ボタン | | | | | | | 表示 | 活性 | | ダイアログを閉じる |
  
  ## 入出力項目定義
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、入出力項目定義から勤務場所手入力フラグを削除し、出社と退社のみにします。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 2

```diff
@@ -78,8 +78,7 @@
  | 4 | 承認状態 | 入力 | 勤務表画面 | 文字 | 必須 | | 対象日の承認状態（NONE/PENDING/APPROVED/REJECTED） |
  | 5 | 更新完了フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 登録ボタン押下で更新が完了した場合にTRUE |
- | 6 | 手入力フラグ | 出力 | 勤務表画面 | オブジェクト | 必須 | | 手入力で変更された項目を示すフラグ |
+ | 6 | 手入力フラグ | 出力 | 勤務表画面 | オブジェクト | 必須 | | 手入力で変更された項目を示すフラグ（出社・退社のみ対象。勤務場所は背景色変更対象外） |
  | 7 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 出社時刻が手入力で変更された場合にTRUE |
  | 8 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 退社時刻が手入力で変更された場合にTRUE |
- | 9 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 勤務場所が手入力で変更された場合にTRUE |
  
  ## その他の項目定義
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、その他の項目定義から勤務場所手入力フラグに関する記述を修正し、入力変更フラグの構造も更新します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 6, lines removed: 5

```diff
@@ -107,9 +107,10 @@
  | 20 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所名 | 文字 | 正常 | | WORK_LOCATION.WORK_LOCATION_NAME |
  | 21 | 閲覧専用モード | フラグ | 共通 | FALSE | 承認中の場合はTRUE |
- | 22 | 入力変更フラグ | オブジェクト | 正常 | | 各項目の変更状態を管理 |
- | 23 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出社変更フラグ | フラグ | 正常 | FALSE | 出社時刻が変更された場合にTRUE |
- | 24 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退社変更フラグ | フラグ | 正常 | FALSE | 退社時刻が変更された場合にTRUE |
- | 25 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;勤務場所変更フラグ | フラグ | 正常 | FALSE | 勤務場所が変更された場合にTRUE |
- | 26 | エラーメッセージ | 文字 | 異常 | | エラー時に表示するメッセージ |
+ | 22 | 入力変更フラグ | オブジェクト | 正常 | | 各項目の変更状態を管理（背景色変更対象は出社・退社のみ） |
+ | 23 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;出社変更フラグ | フラグ | 正常 | FALSE | 出社時刻が変更された場合にTRUE。背景色変更対象 |
+ | 24 | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;退社変更フラグ | フラグ | 正常 | FALSE | 退社時刻が変更された場合にTRUE。背景色変更対象 |
+ | 25 | 工数実績合計 | 小数 | 正常 | | 対象日付の工数実績の合計時間。日次確定時のチェックに使用 |
+ | 26 | 実労働時間 | 小数 | 正常 | | 対象日付の実労働時間。日次確定時のチェックに使用 |
+ | 27 | エラーメッセージ | 文字 | 異常 | | エラー時に表示するメッセージ |
  
  ## イベント処理説明
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、勤務場所変更処理のイベント処理説明を修正し、手入力フラグの設定を削除します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 3, lines removed: 5

```diff
@@ -154,9 +154,7 @@
  #### 名称：勤務場所変更処理、英名：onWorkLocationChange、処理タイミング：入力エリア.勤務場所.変更
  
- 1. 変更フラグ更新
-    - 入力変更フラグ.勤務場所変更フラグをTRUEに設定する。
- 
- 2. 手入力判定
-    - 勤務場所手入力フラグをTRUEに設定する。
+ 1. 勤務場所更新
+    - 選択された勤務場所コードを設定する。
+    - ※勤務場所は背景色変更の対象外のため、手入力フラグは設定しない。
  
  #### 名称：休憩追加ボタン押下処理、英名：onAddBreakClick、処理タイミング：入力エリア.休憩追加ボタン.押下
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、登録ボタン押下処理を修正して、日次確定チェックボックスがONの場合の工数実績チェックを追加し、エラーダイアログ表示処理を追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 16, lines removed: 6

```diff
@@ -180,20 +180,30 @@
       1. エラー内容を画面に表示させ、処理を終了する。
  
- 2. 勤怠データ更新
+ 2. 日次確定チェック（日次確定するチェックボックスがONの場合のみ）
+    - 画面項目定義.日次確定するチェックボックスがONの場合:
+      - チェック仕様に従い、日次確定のための事前チェックを行う。
+      - 【チェック仕様 No.3（日次確定事前チェック）】
+      
+      - エラー処理
+        1. エラーダイアログを表示する。
+        2. エラーダイアログにはエラーメッセージと「OK」ボタンを表示する。
+        3. 「OK」ボタン押下でエラーダイアログを閉じ、処理を終了する。
+ 
+ 3. 勤怠データ更新
     - API利用仕様に従い、勤怠データを更新する。
     - 【API利用仕様 No.3（勤怠データ更新API）】
  
- 3. 日次確定処理
+ 4. 日次確定処理
     - 画面項目定義.日次確定するチェックボックスがONの場合:
       - API利用仕様に従い、日次確定申請を行う。
       - 【API利用仕様 No.4（日次確定申請API）】
  
- 4. 出力項目設定
+ 5. 出力項目設定
     - 入出力項目定義.更新完了フラグをTRUEに設定する。
-    - 入出力項目定義.手入力フラグに各項目の手入力フラグを設定する。
+    - 入出力項目定義.手入力フラグに各項目の手入力フラグを設定する（出社・退社のみ）。
  
- 5. ダイアログ閉じる
+ 6. ダイアログ閉じる
     - ダイアログを閉じる。
-    - 勤務表画面に戻り、手入力した箇所の背景色が黄色に変更される。
+    - 勤務表画面に戻り、出社・退社を手入力した箇所の背景色が黄色に変更される。
  
  #### 名称：キャンセルリンク押下処理、英名：onCancelClick、処理タイミング：操作ボタンエリア.キャンセルリンク.押下
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、チェック仕様にNo.3として日次確定事前チェックを追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 12, lines removed: undefined

```diff
@@ -322,4 +322,16 @@
    | 公用外出時間 | 複合整合 | 公用外出時間が出社時刻～退社時刻の範囲外の場合、エラー | E_ATT_017 | 公用外出時間は出社時刻から退社時刻の範囲内で設定してください。 |
  
+ #### No.3
+ - チェック仕様：日次確定事前チェック
+ - 分類：特殊・システム系チェック
+ - 取得元：その他の項目定義
+   | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
+   | :--- | :--- | :--- | :--- | :--- |
+   | 出社時刻 | 必須 | 出社時刻が未入力の場合、エラー | E_ATT_021 | 出社時刻が入力されていません。 |
+   | 退社時刻 | 必須 | 退社時刻が未入力の場合、エラー | E_ATT_022 | 退社時刻が入力されていません。 |
+   | 勤務場所 | 必須 | 勤務場所が未選択の場合、エラー | E_ATT_023 | 勤務場所が選択されていません。 |
+   | 工数実績合計 | 必須 | 工数実績が入力されていない（合計が0または未入力）の場合、エラー | E_ATT_024 | 工数実績が入力されていません。 |
+   | 工数実績合計 | 一致 | 工数実績合計と実労働時間が一致しない場合、エラー | E_ATT_025 | 工数の合計と実労働時間が合いません。 |
+ 
  ## テーブル取得仕様
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、テーブル更新仕様の勤怠データ更新から、IS_LOCATION_MANUALの更新を削除します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 2, lines removed: 3

```diff
@@ -399,7 +399,6 @@
    | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | |
    | WORK_LOCATION_CODE | 画面項目定義.勤務場所の勤務場所コード | |
-   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | 出社時刻が変更された場合TRUE |
-   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | 退社時刻が変更された場合TRUE |
-   | IS_LOCATION_MANUAL | 入力変更フラグ.勤務場所変更フラグ | 勤務場所が変更された場合TRUE |
+   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | 出社時刻が変更された場合TRUE。背景色変更対象 |
+   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | 退社時刻が変更された場合TRUE。背景色変更対象 |
    | UPDATED_AT | 現在日時 | |
  - 関連する取得仕様
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、API利用仕様の勤怠データ更新APIからIS_LOCATION_MANUALを削除し、補足説明を修正します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 2, lines removed: 3

```diff
@@ -494,7 +494,6 @@
    | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | リクエストボディ、HH:MM形式 |
    | WORK_LOCATION_CODE | 画面項目定義.勤務場所 | リクエストボディ |
-   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | リクエストボディ |
-   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | リクエストボディ |
-   | IS_LOCATION_MANUAL | 入力変更フラグ.勤務場所変更フラグ | リクエストボディ |
+   | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | リクエストボディ。出社時刻変更時にTRUE |
+   | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | リクエストボディ。退社時刻変更時にTRUE |
    | BREAK_TIMES | 休憩時間リスト | リクエストボディ、配列形式 |
    | &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;BREAK_START_TIME | 休憩開始時刻 | HH:MM形式 |
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、API利用仕様の補足説明を修正します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -509,5 +509,5 @@
  - その他
    - テーブル更新仕様 No.1（勤怠データ更新）、No.2（休憩時間更新）を実行
-   - 手入力フラグがTRUEの場合、勤務表画面で該当項目の背景色が黄色に変更される
+   - 出社・退社の手入力フラグがTRUEの場合、勤務表画面で該当項目の背景色が黄色に変更される（勤務場所は対象外）
  
  #### No.4
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
最後に、補足説明セクションを修正します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 5, lines removed: 3

```diff
@@ -538,12 +538,14 @@
  
  ### 手入力と背景色の変更
- 本画面で出社時刻、退社時刻、勤務場所を手入力で変更して登録すると、以下の処理が行われます：
+ 本画面で出社時刻、退社時刻を手入力で変更して登録すると、以下の処理が行われます：
  
  1. **手入力フラグの設定**
-    - 変更された項目に対応する手入力フラグ（IS_CLOCK_IN_MANUAL、IS_CLOCK_OUT_MANUAL、IS_LOCATION_MANUAL）がTRUEに設定されます。
+    - 変更された項目に対応する手入力フラグ（IS_CLOCK_IN_MANUAL、IS_CLOCK_OUT_MANUAL）がTRUEに設定されます。
+    - **注意**: 勤務場所（プルダウン選択）は背景色変更の対象外です。
  
  2. **背景色の変更**
-    - 勤務表画面に戻ると、手入力フラグがTRUEの項目のセルの背景色が黄色（#FFFF00）に変更されます。
+    - 勤務表画面に戻ると、出社・退社の手入力フラグがTRUEの項目のセルの背景色が黄色（#FFFF00）に変更されます。
     - これにより、打刻機による自動入力ではなく、手入力で変更された箇所が視覚的に識別できます。
+    - 勤務場所は選択を変更しても背景色は変わりません。
  
  ### 閲覧専用モード（承認中状態）
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、日次確定チェックボックス使用時のエラーダイアログに関する補足説明を追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 16, lines removed: undefined

```diff
@@ -575,4 +575,20 @@
  時刻はH:MM形式（例: 8:48、12:00、18:46）で入力します。
  退社時刻は深夜勤務に対応するため、24:00以降の時刻（例: 25:30）も入力可能です。
+ 
+ ### 日次確定チェックボックスとエラーダイアログ
+ 「日次確定する」チェックボックスをONにして登録ボタンを押下した場合、以下のチェックが行われます：
+ 
+ 1. **工数実績チェック**
+    - 工数実績が入力されていない場合、エラーダイアログが表示されます。
+    - エラーメッセージ例: 「工数実績が入力されていません。」
+ 
+ 2. **工数合計チェック**
+    - 工数実績の合計と実労働時間が一致しない場合、エラーダイアログが表示されます。
+    - エラーメッセージ例: 「工数の合計と実労働時間が合いません。」
+ 
+ 3. **その他の必須チェック**
+    - 出社時刻、退社時刻、勤務場所が未入力の場合もエラーダイアログが表示されます。
+ 
+ エラーダイアログは「OK」ボタンで閉じることができ、閉じた後は入力画面に戻ってエラー箇所を修正できます。
  
  ## 変更履歴
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
最後に、変更履歴を更新します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: docs/detailed-design/ui/attendance-input-dialog.md</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -597,4 +597,5 @@
  | --- | --- | --- |
  | 2025-12-09 | 初版作成 | AI Assistant |
+ | 2025-12-09 | 日次確定チェックボックス使用時のエラーダイアログ（工数実績チェック）を追加。勤務場所は背景色変更対象外に修正 | AI Assistant |
  
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
修正が完了しました。ユーザーにまとめを報告します。</details></think>

---

詳細設計書を修正しました。主な変更点は以下の通りです：

## 修正内容

### 1. 日次確定チェックボックス使用時のエラーダイアログを追加

**画面項目定義に追加:**
- エラーダイアログ（日次確定チェック時のエラー表示用）
- タイトル、エラーメッセージ、OKボタン

**チェック仕様 No.3（日次確定事前チェック）を追加:**
| チェック内容 | メッセージ |
|-------------|-----------|
| 出社時刻が未入力 | 出社時刻が入力されていません。 |
| 退社時刻が未入力 | 退社時刻が入力されていません。 |
| 勤務場所が未選択 | 勤務場所が選択されていません。 |
| 工数実績が未入力 | 工数実績が入力されていません。 |
| 工数合計と実労働時間が不一致 | 工数の合計と実労働時間が合いません。 |

### 2. 勤務場所の背景色変更を対象外に修正

**修正箇所:**
- 概要: 「出社時刻・退社時刻を手入力で入力して登録すると～（勤務場所は背景色変更の対象外）」
- 勤務場所の項目定義から「手入力で変更した場合は背景色が黄色に変更される」を削除
- 入出力項目定義から「勤務場所手入力フラグ」を削除
- その他の項目定義から「勤務場所変更フラグ」を削除
- 勤務場所変更処理から手入力フラグ設定を削除
- テーブル更新仕様から`IS_LOCATION_MANUAL`の更新を削除
- API利用仕様から`IS_LOCATION_MANUAL`のパラメータを削除
- 補足説明で「勤務場所は選択を変更しても背景色は変わりません」を明記

---

_**User (2025-12-08 08:46Z)**_

では上記の内容で実装お願いします。

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
ユーザーは詳細設計書の内容に基づいて、勤怠情報入力画面を実装してほしいとのことです。

まず、既存のコードベースを確認して、どのように実装するべきかを理解する必要があります。

1. 既存のAttendanceApplicationDialog.vueを確認
2. 勤務表画面（TimesheetScreen.vue）を確認
3. 既存のダイアログコンポーネントの構造を理解
4. 新しい勤怠情報入力ダイアログを作成

まず、関連ファイルを確認しましょう。</details></think>

---

まず、既存のコードベースを確認して、勤怠情報入力画面の実装に必要な情報を収集します。

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/components/Dialog/AttendanceApplicationDialog.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
既存のコードを確認しました。勤務表画面（TimesheetScreen.vue）と勤怠関連申請ダイアログ（AttendanceApplicationDialog.vue）があります。新しい勤怠情報入力ダイアログを作成する必要があります。

勤務表画面のコードをもう少し確認して、出社・退社・勤務場所のクリックイベントがどのように実装されているかを確認します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "出社時刻や退社時刻のクリックイベントはどのように実装されているか" • **15** results</summary>
            
| File | Lines |
|------|-------|
| `frontend/src/views/TimesheetScreen.vue` | L236-288 |
| `frontend/src/views/HomeScreen.vue` | L101-179 |
| `frontend/src/views/HomeScreen.vue` | L375-404 |
| `frontend/src/views/HomeScreen.vue` | L398-456 |
| `frontend/src/views/TimesheetScreen.vue` | L137-176 |
| `frontend/src/views/TimesheetScreen.vue` | L322-360 |
| `frontend/src/views/TimesheetScreen.vue` | L762-807 |
| `frontend/src/views/HomeScreen.vue` | L213-270 |
| `frontend/src/views/TimesheetScreen.vue` | L210-243 |
| `frontend/src/views/HomeScreen.vue` | L523-609 |
| `frontend/src/views/HomeScreen.vue` | L454-489 |
| `frontend/src/views/TimesheetScreen.vue` | L44 |
| `frontend/src/views/HomeScreen.vue` | L484-525 |
| `frontend/src/views/HomeScreen.vue` | L43-106 |
| `frontend/src/views/TimesheetScreen.vue` | L994-1053 |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
勤務表画面のコードを確認しました。出社・退社・勤務場所にクリックイベントはまだ実装されていないようです。詳細設計書に従って新しい勤怠情報入力ダイアログを作成し、勤務表画面から呼び出せるようにする必要があります。

まず、勤務表画面のscriptセクションを確認して、既存のデータ構造やAPIを確認します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
既存のコードの構造が分かりました。勤務表画面では、出社・退社・勤務場所のセルをクリックしたときに勤怠情報入力ダイアログを開く機能はまだ実装されていないようです。新しいダイアログコンポーネントを作成し、勤務表画面に統合する必要があります。

TODOリストを作成して実装を進めます：

1. 新しい勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
2. 勤務表画面（TimesheetScreen.vue）に出社・退社・勤務場所のクリックイベントを追加
3. 勤務表画面にAttendanceInputDialogコンポーネントを統合
4. API呼び出しの実装（既存のAPIサービスを活用）</details></think>

---

既存のコードを確認しました。それでは、詳細設計書に基づいて勤怠情報入力画面を実装します。

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [-] 勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
- [ ] 勤務表画面に出社・退社・勤務場所のクリックイベントを追加
- [ ] 勤務表画面にAttendanceInputDialogコンポーネントを統合
- [ ] APIサービスに必要なAPIを追加

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/services/api.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
APIサービスを確認しました。既存のAPIに日次勤務データ取得、勤怠記録更新、日次確定申請などがあるので、それを活用できます。勤務場所マスタ取得APIと工数取得APIも確認します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/services/api.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
APIサービスを確認しました。必要なAPIは揃っているようです。それでは、勤怠情報入力ダイアログコンポーネントを作成します。</details></think>

---

それでは、勤怠情報入力ダイアログコンポーネントを作成します。

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** • Edit file: frontend/src/components/Dialog/AttendanceInputDialog.vue</summary>

**Chunk 1**
Lines added: 1023, lines removed: 1

```diff
@@ -1,1 +1,1023 @@
- 
+ &lt;template&gt;
+   &lt;div v-if="visible" class="dialog-overlay" @click.self="closeDialog"&gt;
+     &lt;div class="dialog-container"&gt;
+       &lt;!-- ヘッダー部分 --&gt;
+       &lt;div class="dialog-header"&gt;
+         &lt;span class="dialog-title"&gt;勤怠情報入力&lt;/span&gt;
+         &lt;button class="close-button" @click="closeDialog"&gt;×&lt;/button&gt;
+       &lt;/div&gt;
+       
+       &lt;!-- 日付表示 --&gt;
+       &lt;div class="date-display"&gt;{{ formattedDate }}&lt;/div&gt;
+       
+       &lt;!-- 入力エリア --&gt;
+       &lt;div class="input-area"&gt;
+         &lt;!-- 出社 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label clock-in-label"&gt;出社&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.clockIn"
+             :disabled="isReadOnly"
+             :class="['time-input', { 'manual-input': isClockInManual }]"
+             placeholder="H:MM"
+             @input="onClockInChange"
+             ref="clockInInput"
+           /&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 退社 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label clock-out-label"&gt;退社&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.clockOut"
+             :disabled="isReadOnly"
+             :class="['time-input', { 'manual-input': isClockOutManual }]"
+             placeholder="H:MM"
+             @input="onClockOutChange"
+             ref="clockOutInput"
+           /&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 休憩1 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label break-label"&gt;休憩1&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.break1Start"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;span class="tilde"&gt;～&lt;/span&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.break1End"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 休憩2 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label break-label"&gt;休憩2&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.break2Start"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;span class="tilde"&gt;～&lt;/span&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.break2End"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;button 
+             v-if="!isReadOnly" 
+             class="add-button" 
+             @click="addBreak"
+             title="休憩を追加"
+           &gt;
+             &lt;span class="plus-icon"&gt;＋&lt;/span&gt;
+           &lt;/button&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 公用外出1 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label outing-label"&gt;公用外出1&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.outing1Start"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;span class="tilde"&gt;～&lt;/span&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.outing1End"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 公用外出2 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label outing-label"&gt;公用外出2&lt;/label&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.outing2Start"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;span class="tilde"&gt;～&lt;/span&gt;
+           &lt;input 
+             type="text" 
+             v-model="form.outing2End"
+             :disabled="isReadOnly"
+             class="time-input time-input-small"
+             placeholder="H:MM"
+           /&gt;
+           &lt;button 
+             v-if="!isReadOnly" 
+             class="add-button" 
+             @click="addOuting"
+             title="公用外出を追加"
+           &gt;
+             &lt;span class="plus-icon"&gt;＋&lt;/span&gt;
+           &lt;/button&gt;
+         &lt;/div&gt;
+         
+         &lt;!-- 勤務場所 --&gt;
+         &lt;div class="input-row"&gt;
+           &lt;label class="input-label location-label"&gt;勤務場所&lt;/label&gt;
+           &lt;select 
+             v-model="form.workLocation"
+             :disabled="isReadOnly"
+             class="location-select"
+           &gt;
+             &lt;option value=""&gt;選択してください&lt;/option&gt;
+             &lt;option 
+               v-for="location in workLocations" 
+               :key="location.code" 
+               :value="location.code"
+             &gt;
+               {{ location.name }}
+             &lt;/option&gt;
+           &lt;/select&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+       
+       &lt;!-- 操作ボタンエリア（編集可能時） --&gt;
+       &lt;div v-if="!isReadOnly" class="button-area"&gt;
+         &lt;button class="register-button" @click="onRegister"&gt;登録&lt;/button&gt;
+         &lt;a href="#" class="cancel-link" @click.prevent="closeDialog"&gt;キャンセル&lt;/a&gt;
+         &lt;button class="reset-button" @click="onReset"&gt;リセット&lt;/button&gt;
+       &lt;/div&gt;
+       
+       &lt;!-- 日次確定チェックボックス（編集可能時） --&gt;
+       &lt;div v-if="!isReadOnly" class="daily-confirm-area"&gt;
+         &lt;label class="daily-confirm-checkbox"&gt;
+           &lt;input 
+             type="checkbox" 
+             v-model="form.isDailyConfirm"
+           /&gt;
+           日次確定する
+         &lt;/label&gt;
+       &lt;/div&gt;
+       
+       &lt;!-- 閉じるリンク（閲覧専用時） --&gt;
+       &lt;div v-if="isReadOnly" class="close-link-area"&gt;
+         &lt;a href="#" class="close-link" @click.prevent="closeDialog"&gt;閉じる&lt;/a&gt;
+       &lt;/div&gt;
+     &lt;/div&gt;
+     
+     &lt;!-- エラーダイアログ --&gt;
+     &lt;div v-if="showErrorDialog" class="error-dialog-overlay"&gt;
+       &lt;div class="error-dialog-container"&gt;
+         &lt;div class="error-dialog-header"&gt;
+           &lt;span class="error-dialog-title"&gt;エラー&lt;/span&gt;
+         &lt;/div&gt;
+         &lt;div class="error-dialog-body"&gt;
+           &lt;p class="error-dialog-message"&gt;{{ errorMessage }}&lt;/p&gt;
+         &lt;/div&gt;
+         &lt;div class="error-dialog-footer"&gt;
+           &lt;button class="error-dialog-ok-button" @click="closeErrorDialog"&gt;OK&lt;/button&gt;
+         &lt;/div&gt;
+       &lt;/div&gt;
+     &lt;/div&gt;
+   &lt;/div&gt;
+ &lt;/template&gt;
+ 
+ &lt;script&gt;
+ import { getDailyAttendance, updateAttendanceRecord, submitDailyConfirmation, getWorkLocations, getWorkHours } from '@/services/api'
+ 
+ export default {
+   name: 'AttendanceInputDialog',
+   props: {
+     visible: {
+       type: Boolean,
+       default: false
+     },
+     targetDate: {
+       type: String,
+       required: true
+     },
+     employeeId: {
+       type: String,
+       required: true
+     },
+     initialFocus: {
+       type: String,
+       default: 'clockIn' // 'clockIn', 'clockOut', 'location'
+     },
+     approvalStatus: {
+       type: String,
+       default: 'NOT_SUBMITTED' // 'NOT_SUBMITTED', 'PENDING', 'APPROVED', 'REJECTED'
+     }
+   },
+   emits: ['close', 'updated'],
+   data() {
+     return {
+       form: {
+         clockIn: '',
+         clockOut: '',
+         break1Start: '',
+         break1End: '',
+         break2Start: '',
+         break2End: '',
+         outing1Start: '',
+         outing1End: '',
+         outing2Start: '',
+         outing2End: '',
+         workLocation: '',
+         isDailyConfirm: false
+       },
+       originalData: null,
+       workLocations: [],
+       isClockInManual: false,
+       isClockOutManual: false,
+       originalClockIn: '',
+       originalClockOut: '',
+       showErrorDialog: false,
+       errorMessage: '',
+       workHoursTotal: 0,
+       actualWorkHours: 0,
+       loading: false
+     }
+   },
+   computed: {
+     // 閲覧専用モード
+     isReadOnly() {
+       return this.approvalStatus === 'PENDING'
+     },
+     // 日付表示フォーマット
+     formattedDate() {
+       if (!this.targetDate) return ''
+       const date = new Date(this.targetDate)
+       const year = date.getFullYear()
+       const month = date.getMonth() + 1
+       const day = date.getDate()
+       const dayNames = ['日', '月', '火', '水', '木', '金', '土']
+       const dayOfWeek = dayNames[date.getDay()]
+       return &#96;${year}年${month}月${day}日${dayOfWeek}曜日&#96;
+     }
+   },
+   watch: {
+     visible(newVal) {
+       if (newVal) {
+         this.initializeDialog()
+       }
+     }
+   },
+   methods: {
+     // ダイアログ初期化
+     async initializeDialog() {
+       this.loading = true
+       try {
+         // 勤務場所マスタ取得
+         await this.loadWorkLocations()
+         
+         // 日次勤務データ取得
+         await this.loadDailyData()
+         
+         // フォーカス設定
+         this.$nextTick(() =&gt; {
+           this.setInitialFocus()
+         })
+       } catch (error) {
+         console.error('初期化エラー:', error)
+         this.showError('データの取得に失敗しました。')
+       } finally {
+         this.loading = false
+       }
+     },
+     
+     // 勤務場所マスタ取得
+     async loadWorkLocations() {
+       try {
+         const response = await getWorkLocations()
+         if (response.success &amp;&amp; response.workLocations) {
+           this.workLocations = response.workLocations.map(loc =&gt; ({
+             code: loc.WORK_LOCATION_CODE,
+             name: loc.WORK_LOCATION_NAME
+           }))
+         }
+       } catch (error) {
+         console.error('勤務場所マスタ取得エラー:', error)
+         // フォールバック
+         this.workLocations = [
+           { code: 'commute', name: '通勤' },
+           { code: 'home', name: '在宅' }
+         ]
+       }
+     },
+     
+     // 日次勤務データ取得
+     async loadDailyData() {
+       try {
+         const response = await getDailyAttendance(this.employeeId, this.targetDate)
+         if (response.success &amp;&amp; response.attendance) {
+           const data = response.attendance
+           
+           // 時刻のフォーマット
+           const formatTime = (datetime) =&gt; {
+             if (!datetime) return ''
+             const date = new Date(datetime)
+             const hours = date.getHours()
+             const minutes = String(date.getMinutes()).padStart(2, '0')
+             return &#96;${hours}:${minutes}&#96;
+           }
+           
+           // フォームに設定
+           this.form.clockIn = formatTime(data.CLOCK_IN_TIME)
+           this.form.clockOut = formatTime(data.CLOCK_OUT_TIME)
+           this.form.workLocation = data.WORK_LOCATION_CODE || ''
+           
+           // 元の打刻時刻を保存
+           this.originalClockIn = formatTime(data.ORIGINAL_CLOCK_IN_TIME || data.CLOCK_IN_TIME)
+           this.originalClockOut = formatTime(data.ORIGINAL_CLOCK_OUT_TIME || data.CLOCK_OUT_TIME)
+           
+           // 手入力フラグ
+           this.isClockInManual = data.IS_CLOCK_IN_MANUAL || false
+           this.isClockOutManual = data.IS_CLOCK_OUT_MANUAL || false
+           
+           // 休憩時間の設定
+           if (data.breakTimes &amp;&amp; data.breakTimes.length &gt; 0) {
+             const breaks = data.breakTimes.filter(b =&gt; b.BREAK_TYPE === 'BREAK')
+             const outings = data.breakTimes.filter(b =&gt; b.BREAK_TYPE === 'OFFICIAL_OUTING')
+             
+             if (breaks[0]) {
+               this.form.break1Start = formatTime(breaks[0].BREAK_START_TIME)
+               this.form.break1End = formatTime(breaks[0].BREAK_END_TIME)
+             }
+             if (breaks[1]) {
+               this.form.break2Start = formatTime(breaks[1].BREAK_START_TIME)
+               this.form.break2End = formatTime(breaks[1].BREAK_END_TIME)
+             }
+             if (outings[0]) {
+               this.form.outing1Start = formatTime(outings[0].BREAK_START_TIME)
+               this.form.outing1End = formatTime(outings[0].BREAK_END_TIME)
+             }
+             if (outings[1]) {
+               this.form.outing2Start = formatTime(outings[1].BREAK_START_TIME)
+               this.form.outing2End = formatTime(outings[1].BREAK_END_TIME)
+             }
+           }
+           
+           // 実労働時間
+           this.actualWorkHours = data.ACTUAL_WORK_HOURS || 0
+           
+           // 元データを保存
+           this.originalData = JSON.parse(JSON.stringify(this.form))
+         }
+         
+         // 工数実績取得
+         await this.loadWorkHours()
+         
+       } catch (error) {
+         console.error('日次勤務データ取得エラー:', error)
+         // 新規データの場合は空フォームで表示
+         this.resetForm()
+       }
+     },
+     
+     // 工数実績取得
+     async loadWorkHours() {
+       try {
+         const response = await getWorkHours(this.employeeId, this.targetDate)
+         if (response.success &amp;&amp; response.workHours) {
+           this.workHoursTotal = response.workHours.reduce(
+             (sum, wh) =&gt; sum + (parseFloat(wh.WORK_HOURS_VALUE) || 0), 
+             0
+           )
+         }
+       } catch (error) {
+         console.error('工数実績取得エラー:', error)
+         this.workHoursTotal = 0
+       }
+     },
+     
+     // フォーカス設定
+     setInitialFocus() {
+       switch (this.initialFocus) {
+         case 'clockIn':
+           this.$refs.clockInInput?.focus()
+           break
+         case 'clockOut':
+           this.$refs.clockOutInput?.focus()
+           break
+         case 'location':
+           // プルダウンにフォーカスは設定しない
+           break
+         default:
+           this.$refs.clockInInput?.focus()
+       }
+     },
+     
+     // 出社時刻変更
+     onClockInChange() {
+       if (this.form.clockIn !== this.originalClockIn) {
+         this.isClockInManual = true
+       }
+     },
+     
+     // 退社時刻変更
+     onClockOutChange() {
+       if (this.form.clockOut !== this.originalClockOut) {
+         this.isClockOutManual = true
+       }
+     },
+     
+     // 休憩追加
+     addBreak() {
+       // 追加の休憩フィールドの実装（今回はアラート表示）
+       alert('休憩3以降の追加は今後実装予定です')
+     },
+     
+     // 公用外出追加
+     addOuting() {
+       // 追加の公用外出フィールドの実装（今回はアラート表示）
+       alert('公用外出3以降の追加は今後実装予定です')
+     },
+     
+     // 登録ボタン押下
+     async onRegister() {
+       // 入力チェック
+       if (!this.validateInput()) {
+         return
+       }
+       
+       // 日次確定チェック（チェックボックスがONの場合）
+       if (this.form.isDailyConfirm) {
+         if (!this.validateDailyConfirm()) {
+           return
+         }
+       }
+       
+       this.loading = true
+       try {
+         // 勤怠データ更新
+         const breakTimes = this.buildBreakTimes()
+         
+         const attendanceData = {
+           employeeId: this.employeeId,
+           workDate: this.targetDate,
+           clockInTime: this.form.clockIn,
+           clockOutTime: this.form.clockOut,
+           workLocationCode: this.form.workLocation,
+           isClockInManual: this.isClockInManual,
+           isClockOutManual: this.isClockOutManual,
+           breakTimes: breakTimes
+         }
+         
+         const updateResponse = await updateAttendanceRecord(attendanceData)
+         if (!updateResponse.success) {
+           throw new Error(updateResponse.message || '勤怠データの更新に失敗しました')
+         }
+         
+         // 日次確定処理
+         if (this.form.isDailyConfirm) {
+           const confirmResponse = await submitDailyConfirmation(this.employeeId, this.targetDate)
+           if (!confirmResponse.success) {
+             throw new Error(confirmResponse.message || '日次確定申請に失敗しました')
+           }
+         }
+         
+         // 更新完了を親コンポーネントに通知
+         this.$emit('updated', {
+           date: this.targetDate,
+           isClockInManual: this.isClockInManual,
+           isClockOutManual: this.isClockOutManual,
+           isDailyConfirmed: this.form.isDailyConfirm
+         })
+         
+         this.closeDialog()
+         
+       } catch (error) {
+         console.error('登録エラー:', error)
+         this.showError(error.message || '登録に失敗しました')
+       } finally {
+         this.loading = false
+       }
+     },
+     
+     // 入力チェック
+     validateInput() {
+       // 時刻形式チェック（H:MM形式）
+       const timeRegex = /^([0-9]|[0-2][0-9]):([0-5][0-9])$/
+       
+       if (this.form.clockIn &amp;&amp; !timeRegex.test(this.form.clockIn)) {
+         this.showError('出社時刻の形式が正しくありません。H:MM形式で入力してください。')
+         return false
+       }
+       
+       if (this.form.clockOut &amp;&amp; !timeRegex.test(this.form.clockOut)) {
+         this.showError('退社時刻の形式が正しくありません。H:MM形式で入力してください。')
+         return false
+       }
+       
+       // 時刻整合性チェック（出社 &lt; 退社）
+       if (this.form.clockIn &amp;&amp; this.form.clockOut) {
+         const clockInMinutes = this.timeToMinutes(this.form.clockIn)
+         const clockOutMinutes = this.timeToMinutes(this.form.clockOut)
+         if (clockInMinutes &gt;= clockOutMinutes) {
+           this.showError('出社時刻は退社時刻より前に設定してください。')
+           return false
+         }
+       }
+       
+       // 休憩時間チェック
+       if (!this.validateBreakTime(this.form.break1Start, this.form.break1End, '休憩1')) {
+         return false
+       }
+       if (!this.validateBreakTime(this.form.break2Start, this.form.break2End, '休憩2')) {
+         return false
+       }
+       if (!this.validateBreakTime(this.form.outing1Start, this.form.outing1End, '公用外出1')) {
+         return false
+       }
+       if (!this.validateBreakTime(this.form.outing2Start, this.form.outing2End, '公用外出2')) {
+         return false
+       }
+       
+       return true
+     },
+     
+     // 休憩時間のバリデーション
+     validateBreakTime(start, end, label) {
+       const timeRegex = /^([0-9]|[0-2][0-9]):([0-5][0-9])$/
+       
+       // 両方空なら OK
+       if (!start &amp;&amp; !end) return true
+       
+       // 片方だけ入力されている場合はエラー
+       if ((start &amp;&amp; !end) || (!start &amp;&amp; end)) {
+         this.showError(&#96;${label}の開始時刻と終了時刻の両方を入力してください。&#96;)
+         return false
+       }
+       
+       // 形式チェック
+       if (!timeRegex.test(start)) {
+         this.showError(&#96;${label}の開始時刻の形式が正しくありません。H:MM形式で入力してください。&#96;)
+         return false
+       }
+       if (!timeRegex.test(end)) {
+         this.showError(&#96;${label}の終了時刻の形式が正しくありません。H:MM形式で入力してください。&#96;)
+         return false
+       }
+       
+       // 順序チェック
+       const startMinutes = this.timeToMinutes(start)
+       const endMinutes = this.timeToMinutes(end)
+       if (startMinutes &gt;= endMinutes) {
+         this.showError(&#96;${label}の開始時刻は終了時刻より前に設定してください。&#96;)
+         return false
+       }
+       
+       return true
+     },
+     
+     // 日次確定の事前チェック
+     validateDailyConfirm() {
+       // 出社時刻チェック
+       if (!this.form.clockIn) {
+         this.showError('出社時刻が入力されていません。')
+         return false
+       }
+       
+       // 退社時刻チェック
+       if (!this.form.clockOut) {
+         this.showError('退社時刻が入力されていません。')
+         return false
+       }
+       
+       // 勤務場所チェック
+       if (!this.form.workLocation) {
+         this.showError('勤務場所が選択されていません。')
+         return false
+       }
+       
+       // 工数実績チェック
+       if (this.workHoursTotal === 0) {
+         this.showError('工数実績が入力されていません。')
+         return false
+       }
+       
+       // 工数合計と実労働時間の一致チェック
+       if (this.actualWorkHours &gt; 0 &amp;&amp; Math.abs(this.actualWorkHours - this.workHoursTotal) &gt; 0.01) {
+         this.showError('工数の合計と実労働時間が合いません。')
+         return false
+       }
+       
+       return true
+     },
+     
+     // 時刻を分に変換
+     timeToMinutes(timeStr) {
+       if (!timeStr) return 0
+       const [hours, minutes] = timeStr.split(':').map(Number)
+       return hours * 60 + minutes
+     },
+     
+     // 休憩時間データの構築
+     buildBreakTimes() {
+       const breakTimes = []
+       
+       if (this.form.break1Start &amp;&amp; this.form.break1End) {
+         breakTimes.push({
+           breakStartTime: this.form.break1Start,
+           breakEndTime: this.form.break1End,
+           breakType: 'BREAK'
+         })
+       }
+       if (this.form.break2Start &amp;&amp; this.form.break2End) {
+         breakTimes.push({
+           breakStartTime: this.form.break2Start,
+           breakEndTime: this.form.break2End,
+           breakType: 'BREAK'
+         })
+       }
+       if (this.form.outing1Start &amp;&amp; this.form.outing1End) {
+         breakTimes.push({
+           breakStartTime: this.form.outing1Start,
+           breakEndTime: this.form.outing1End,
+           breakType: 'OFFICIAL_OUTING'
+         })
+       }
+       if (this.form.outing2Start &amp;&amp; this.form.outing2End) {
+         breakTimes.push({
+           breakStartTime: this.form.outing2Start,
+           breakEndTime: this.form.outing2End,
+           breakType: 'OFFICIAL_OUTING'
+         })
+       }
+       
+       return breakTimes
+     },
+     
+     // リセットボタン押下
+     onReset() {
+       if (this.originalData) {
+         this.form = JSON.parse(JSON.stringify(this.originalData))
+         this.isClockInManual = false
+         this.isClockOutManual = false
+       } else {
+         this.resetForm()
+       }
+     },
+     
+     // フォームリセット
+     resetForm() {
+       this.form = {
+         clockIn: '',
+         clockOut: '',
+         break1Start: '',
+         break1End: '',
+         break2Start: '',
+         break2End: '',
+         outing1Start: '',
+         outing1End: '',
+         outing2Start: '',
+         outing2End: '',
+         workLocation: '',
+         isDailyConfirm: false
+       }
+       this.isClockInManual = false
+       this.isClockOutManual = false
+     },
+     
+     // エラー表示
+     showError(message) {
+       this.errorMessage = message
+       this.showErrorDialog = true
+     },
+     
+     // エラーダイアログを閉じる
+     closeErrorDialog() {
+       this.showErrorDialog = false
+       this.errorMessage = ''
+     },
+     
+     // ダイアログを閉じる
+     closeDialog() {
+       this.$emit('close')
+     }
+   }
+ }
+ &lt;/script&gt;
+ 
+ &lt;style scoped&gt;
+ .dialog-overlay {
+   position: fixed;
+   top: 0;
+   left: 0;
+   width: 100%;
+   height: 100%;
+   background-color: rgba(0, 0, 0, 0.5);
+   display: flex;
+   justify-content: center;
+   align-items: center;
+   z-index: 1000;
+ }
+ 
+ .dialog-container {
+   background-color: #fff;
+   border-radius: 8px;
+   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
+   width: 450px;
+   max-width: 90%;
+   overflow: hidden;
+ }
+ 
+ .dialog-header {
+   background-color: #2196F3;
+   color: white;
+   padding: 12px 16px;
+   display: flex;
+   justify-content: space-between;
+   align-items: center;
+ }
+ 
+ .dialog-title {
+   font-size: 16px;
+   font-weight: bold;
+ }
+ 
+ .close-button {
+   background: none;
+   border: none;
+   color: white;
+   font-size: 24px;
+   cursor: pointer;
+   padding: 0;
+   line-height: 1;
+ }
+ 
+ .close-button:hover {
+   opacity: 0.8;
+ }
+ 
+ .date-display {
+   padding: 12px 16px;
+   font-size: 14px;
+   color: #333;
+   border-bottom: 1px solid #e0e0e0;
+ }
+ 
+ .input-area {
+   padding: 16px;
+ }
+ 
+ .input-row {
+   display: flex;
+   align-items: center;
+   margin-bottom: 12px;
+ }
+ 
+ .input-label {
+   width: 100px;
+   font-size: 14px;
+   color: #333;
+   padding: 8px 12px;
+   border-radius: 4px;
+   text-align: center;
+   margin-right: 12px;
+ }
+ 
+ .clock-in-label,
+ .clock-out-label {
+   background-color: #1565C0;
+   color: white;
+ }
+ 
+ .break-label {
+   background-color: #1976D2;
+   color: white;
+ }
+ 
+ .outing-label {
+   background-color: #64B5F6;
+   color: #333;
+ }
+ 
+ .location-label {
+   background-color: #1565C0;
+   color: white;
+ }
+ 
+ .time-input {
+   width: 80px;
+   padding: 8px 12px;
+   border: 1px solid #ccc;
+   border-radius: 4px;
+   font-size: 14px;
+   text-align: center;
+ }
+ 
+ .time-input-small {
+   width: 70px;
+ }
+ 
+ .time-input:disabled {
+   background-color: #f5f5f5;
+   color: #666;
+ }
+ 
+ .time-input.manual-input {
+   background-color: #FFFF00;
+ }
+ 
+ .tilde {
+   margin: 0 8px;
+   color: #666;
+ }
+ 
+ .add-button {
+   width: 28px;
+   height: 28px;
+   border-radius: 50%;
+   border: 1px solid #ccc;
+   background-color: #f5f5f5;
+   cursor: pointer;
+   display: flex;
+   align-items: center;
+   justify-content: center;
+   margin-left: 8px;
+ }
+ 
+ .add-button:hover {
+   background-color: #e0e0e0;
+ }
+ 
+ .plus-icon {
+   font-size: 16px;
+   color: #666;
+ }
+ 
+ .location-select {
+   flex: 1;
+   padding: 8px 12px;
+   border: 1px solid #ccc;
+   border-radius: 4px;
+   font-size: 14px;
+   max-width: 200px;
+ }
+ 
+ .location-select:disabled {
+   background-color: #f5f5f5;
+   color: #666;
+ }
+ 
+ .button-area {
+   display: flex;
+   align-items: center;
+   justify-content: center;
+   padding: 16px;
+   gap: 16px;
+   border-top: 1px solid #e0e0e0;
+ }
+ 
+ .register-button {
+   padding: 10px 32px;
+   background-color: #2196F3;
+   color: white;
+   border: none;
+   border-radius: 4px;
+   font-size: 14px;
+   cursor: pointer;
+ }
+ 
+ .register-button:hover {
+   background-color: #1976D2;
+ }
+ 
+ .cancel-link {
+   color: #2196F3;
+   text-decoration: none;
+   font-size: 14px;
+ }
+ 
+ .cancel-link:hover {
+   text-decoration: underline;
+ }
+ 
+ .reset-button {
+   padding: 10px 24px;
+   background-color: #F48FB1;
+   color: white;
+   border: none;
+   border-radius: 4px;
+   font-size: 14px;
+   cursor: pointer;
+ }
+ 
+ .reset-button:hover {
+   background-color: #EC407A;
+ }
+ 
+ .daily-confirm-area {
+   padding: 12px 16px;
+   border-top: 1px solid #e0e0e0;
+   text-align: center;
+ }
+ 
+ .daily-confirm-checkbox {
+   font-size: 14px;
+   color: #333;
+   cursor: pointer;
+ }
+ 
+ .daily-confirm-checkbox input {
+   margin-right: 8px;
+ }
+ 
+ .close-link-area {
+   padding: 16px;
+   text-align: center;
+   border-top: 1px solid #e0e0e0;
+ }
+ 
+ .close-link {
+   color: #2196F3;
+   text-decoration: none;
+   font-size: 14px;
+ }
+ 
+ .close-link:hover {
+   text-decoration: underline;
+ }
+ 
+ /* エラーダイアログ */
+ .error-dialog-overlay {
+   position: fixed;
+   top: 0;
+   left: 0;
+   width: 100%;
+   height: 100%;
+   background-color: rgba(0, 0, 0, 0.5);
+   display: flex;
+   justify-content: center;
+   align-items: center;
+   z-index: 2000;
+ }
+ 
+ .error-dialog-container {
+   background-color: #fff;
+   border-radius: 8px;
+   box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
+   width: 350px;
+   max-width: 90%;
+   overflow: hidden;
+ }
+ 
+ .error-dialog-header {
+   background-color: #D7EBFF;
+   padding: 12px 16px;
+ }
+ 
+ .error-dialog-title {
+   font-size: 14px;
+   font-weight: bold;
+   color: #333;
+ }
+ 
+ .error-dialog-body {
+   padding: 24px 16px;
+ }
+ 
+ .error-dialog-message {
+   font-size: 14px;
+   color: #333;
+   text-align: center;
+   margin: 0;
+ }
+ 
+ .error-dialog-footer {
+   padding: 12px 16px;
+   text-align: center;
+ }
+ 
+ .error-dialog-ok-button {
+   padding: 8px 32px;
+   background-color: #2196F3;
+   color: white;
+   border: none;
+   border-radius: 4px;
+   font-size: 14px;
+   cursor: pointer;
+ }
+ 
+ .error-dialog-ok-button:hover {
+   background-color: #1976D2;
+ }
+ &lt;/style&gt;
+ 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
勤怠情報入力ダイアログコンポーネントを作成しました。次に、勤務表画面に出社・退社・勤務場所のクリックイベントを追加し、AttendanceInputDialogコンポーネントを統合します。</details></think>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
- [-] 勤務表画面に出社・退社・勤務場所のクリックイベントを追加
- [ ] 勤務表画面にAttendanceInputDialogコンポーネントを統合
- [x] APIサービスに必要なAPIを追加

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、勤務表画面（TimesheetScreen.vue）を更新して:
1. 出社・退社・勤務場所のクリックイベントを追加
2. AttendanceInputDialogコンポーネントを統合
3. 更新後のデータ反映処理を追加</details></think>

---

次に、勤務表画面を更新します。まず、テンプレート部分の出社・退社・勤務場所にクリックイベントを追加します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 9, lines removed: 6

```diff
@@ -260,20 +260,23 @@
        
        &lt;!-- 出社時刻 --&gt;
-       &lt;div class="cell-clock-in"&gt;
-         &lt;span v-if="day.clockIn" :class="['time-text', day.clockInType === 'MANUAL' ? 'manual-bg' : '']"&gt;
+       &lt;div class="cell-clock-in" @click="openAttendanceInputDialog(day, 'clockIn')"&gt;
+         &lt;span v-if="day.clockIn" :class="['time-text', 'clickable-cell', day.clockInType === 'MANUAL' ? 'manual-bg' : '']"&gt;
            {{ day.clockIn }}
          &lt;/span&gt;
+         &lt;span v-else class="empty-cell clickable-cell"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;!-- 退社時刻 --&gt;
-       &lt;div class="cell-clock-out"&gt;
-         &lt;span v-if="day.clockOut" :class="['time-text', day.clockOutType === 'MANUAL' ? 'manual-bg' : '']"&gt;
+       &lt;div class="cell-clock-out" @click="openAttendanceInputDialog(day, 'clockOut')"&gt;
+         &lt;span v-if="day.clockOut" :class="['time-text', 'clickable-cell', day.clockOutType === 'MANUAL' ? 'manual-bg' : '']"&gt;
            {{ day.clockOut }}
          &lt;/span&gt;
+         &lt;span v-else class="empty-cell clickable-cell"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
        &lt;!-- 勤務場所 --&gt;
-       &lt;div class="cell-location"&gt;
-         &lt;span v-if="day.location"&gt;{{ day.location }}&lt;/span&gt;
+       &lt;div class="cell-location" @click="openAttendanceInputDialog(day, 'location')"&gt;
+         &lt;span v-if="day.location" class="clickable-cell"&gt;{{ day.location }}&lt;/span&gt;
+         &lt;span v-else class="empty-cell clickable-cell"&gt;&lt;/span&gt;
        &lt;/div&gt;
        
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、勤怠情報入力ダイアログのコンポーネントをインポートし、テンプレートに追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 12, lines removed: undefined

```diff
@@ -433,4 +433,16 @@
      @application-submitted="handleApplicationSubmitted"
    /&gt;
+   
+   &lt;!-- 勤怠情報入力ダイアログ --&gt;
+   &lt;AttendanceInputDialog
+     v-if="selectedDayForInput"
+     :visible="showInputDialog"
+     :target-date="selectedDayForInput.date"
+     :employee-id="employeeId"
+     :initial-focus="inputDialogFocus"
+     :approval-status="selectedDayForInput.approvalStatus"
+     @close="closeInputDialog"
+     @updated="handleInputUpdated"
+   /&gt;
    
    &lt;!-- 認証エラーダイアログ（モーダル） --&gt;
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、scriptセクションを更新して:
1. AttendanceInputDialogコンポーネントをインポート
2. dataにダイアログ関連のstateを追加
3. メソッドを追加</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -612,4 +612,5 @@
  import AppHeader from '@/components/AppHeader.vue'
  import AttendanceApplicationDialog from '@/components/dialog/AttendanceApplicationDialog.vue'
+ import AttendanceInputDialog from '@/components/Dialog/AttendanceInputDialog.vue'
  import HolidayJp from '@holiday-jp/holiday_jp'
  import { getMonthlyAttendance, getEmployeeInfo, submitDailyConfirmation, updateAttendanceRecord } from '@/services/api'
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、コンポーネント登録を更新します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 2, lines removed: 1

```diff
@@ -620,5 +620,6 @@
    components: {
      AppHeader,
-     AttendanceApplicationDialog
+     AttendanceApplicationDialog,
+     AttendanceInputDialog
    },
    data() {
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、dataセクションにダイアログ関連のstateを追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 4, lines removed: undefined

```diff
@@ -644,4 +644,8 @@
        showApplicationDialog: false,
        selectedDayForApplication: null,
+       // 勤怠情報入力ダイアログ関連
+       showInputDialog: false,
+       selectedDayForInput: null,
+       inputDialogFocus: 'clockIn',
        // 月次承認状態
        monthlyApprovalStatus: 'NOT_SUBMITTED' // NOT_SUBMITTED/PENDING/APPROVED/REJECTED
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、メソッドを追加します。勤務表画面のスクリプトの続きを確認して、適切な場所にメソッドを追加します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
勤怠情報入力ダイアログ用のメソッドを追加します。備考ダイアログを閉じるメソッドの後に追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 31, lines removed: undefined

```diff
@@ -1166,4 +1166,35 @@
        this.currentRemarksApprovalStatus = null
      },
+     
+     // 勤怠情報入力ダイアログを開く
+     openAttendanceInputDialog(day, focusField) {
+       this.selectedDayForInput = day
+       this.inputDialogFocus = focusField
+       this.showInputDialog = true
+     },
+     
+     // 勤怠情報入力ダイアログを閉じる
+     closeInputDialog() {
+       this.showInputDialog = false
+       this.selectedDayForInput = null
+       this.inputDialogFocus = 'clockIn'
+     },
+     
+     // 勤怠情報入力完了時の処理
+     async handleInputUpdated(result) {
+       // データを再読み込み
+       await this.loadAttendanceData()
+       
+       // 更新された日の行を更新（手入力フラグを反映）
+       const updatedDay = this.attendanceData.find(d =&gt; d.date === result.date)
+       if (updatedDay) {
+         if (result.isClockInManual) {
+           updatedDay.clockInType = 'MANUAL'
+         }
+         if (result.isClockOutManual) {
+           updatedDay.clockOutType = 'MANUAL'
+         }
+       }
+     },
      
      // 認証エラーダイアログを表示
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、CSSでクリック可能なセルのスタイルを追加します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
CSSセクションの該当部分を探して、クリック可能なセルのスタイルを追加します。.time-textの後あたりに追加するのが良さそうです。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
クリック可能なセルのスタイルを追加します。`.manual-bg`の後に追加するのが良さそうです。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 30, lines removed: undefined

```diff
@@ -1979,4 +1979,34 @@
    padding: 2px 4px;
  }
+ 
+ /* クリック可能なセル */
+ .clickable-cell {
+   cursor: pointer;
+   display: inline-block;
+   min-width: 100%;
+   min-height: 20px;
+ }
+ 
+ .clickable-cell:hover {
+   background-color: rgba(33, 150, 243, 0.1);
+ }
+ 
+ .empty-cell {
+   display: inline-block;
+   min-width: 100%;
+   min-height: 20px;
+ }
+ 
+ .cell-clock-in,
+ .cell-clock-out,
+ .cell-location {
+   cursor: pointer;
+ }
+ 
+ .cell-clock-in:hover,
+ .cell-clock-out:hover,
+ .cell-location:hover {
+   background-color: rgba(33, 150, 243, 0.1);
+ }
  
  .cell-location {
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、lintエラーをチェックして、問題がないか確認します。</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 2 files</summary>
      
Lint paths:

- `frontend/src/views/TimesheetScreen.vue`
- `frontend/src/components/Dialog/AttendanceInputDialog.vue`

Lint results

Lint errors for `frontend/src/views/TimesheetScreen.vue`


| Message | Range | Severity |
|-------|-------|----------|
| 'date' が宣言されていますが、その値が読み取られることはありません。 | 1076:29-1076:33 | DIAGNOSTIC_SEVERITY_HINT |
| 'date' が宣言されていますが、その値が読み取られることはありません。 | 1076:29-1076:33 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 24:21-24:33 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 24:68-24:80 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 100:17-100:29 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 100:60-100:72 | DIAGNOSTIC_SEVERITY_HINT |


</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
- [x] 勤務表画面に出社・退社・勤務場所のクリックイベントを追加
- [x] 勤務表画面にAttendanceInputDialogコンポーネントを統合
- [x] APIサービスに必要なAPIを追加

</details>
</tool-use>

---

実装が完了しました。以下に実装内容をまとめます。

## 実装完了

### 1. 勤怠情報入力ダイアログコンポーネント（`AttendanceInputDialog.vue`）を新規作成

**主な機能:**
- 出社時刻・退社時刻の入力（H:MM形式）
- 休憩1・休憩2の時間帯入力
- 公用外出1・公用外出2の時間帯入力
- 勤務場所の選択（プルダウン）
- 日次確定するチェックボックス
- 登録・キャンセル・リセットボタン

**詳細設計書に基づいた実装:**
- 出社・退社を手入力で変更した場合は背景色が黄色になる（`manual-input`クラス）
- 勤務場所は背景色変更の対象外
- 閲覧専用モード（承認中状態では入力不可、「閉じる」リンクのみ表示）
- エラーダイアログ表示機能
  - 時刻形式チェック（H:MM形式）
  - 時刻整合性チェック（出社 < 退社）
  - 休憩時間の整合性チェック
  - 日次確定事前チェック（工数実績が入力されていない場合のエラー表示）

### 2. 勤務表画面（`TimesheetScreen.vue`）の更新

**追加した機能:**
- 出社・退社・勤務場所セルにクリックイベントを追加
- クリック時に勤怠情報入力ダイアログを表示
- クリックした項目（出社/退社/勤務場所）に応じて初期フォーカスを設定
- ダイアログからの更新完了時にデータを再読み込み
- 手入力フラグに応じて背景色を黄色に変更

**スタイル追加:**
- クリック可能なセルにホバー効果を追加
- 空のセルもクリック可能に

### チェック仕様

日次確定チェックボックスをONにして登録する際に以下のチェックを実行：
| チェック内容 | エラーメッセージ |
|-------------|-----------------|
| 出社時刻未入力 | 出社時刻が入力されていません。 |
| 退社時刻未入力 | 退社時刻が入力されていません。 |
| 勤務場所未選択 | 勤務場所が選択されていません。 |
| 工数実績未入力 | 工数実績が入力されていません。 |
| 工数合計と実労働時間不一致 | 工数の合計と実労働時間が合いません。 |

---

_**User (2025-12-09 03:54Z)**_

バックエンドの処理の実装もお願いします。

その際

@docs/entities/mysql_table_design.sql などの更新をしても平気です。

---

_**Agent (model claude-4.5-opus-high-thinking, mode Agent)**_



---

<think><details><summary>Thought Process</summary>
ユーザーはバックエンド処理の実装を依頼しています。勤怠情報入力ダイアログに関連するバックエンドAPIを実装する必要があります。まず、既存のバックエンドコードを確認して、どのようなAPIが必要か、どこに実装すべきかを把握します。

必要なAPI:
1. 日次勤怠データ取得API（既存かもしれない）
2. 勤務場所マスタ取得API（既存かもしれない）
3. 勤怠データ更新API（休憩時間・公用外出の更新を含む）
4. 工数実績取得API（既存かもしれない）
5. 日次確定申請API（既存かもしれない）

まずバックエンドのコード構造を確認します。</details></think>

---

バックエンドの処理を実装します。まず、既存のバックエンドコード構造を確認します。

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

Model provided non-existent directory

---

<think><details><summary>Thought Process</summary>
バックエンドはroutesフォルダにAPIがあるようです。attendance.jsとmaster.jsを確認して、必要なAPIを実装します。</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/routes/attendance.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/routes/master.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
既存のバックエンドコードを確認しました。勤怠情報入力ダイアログに必要なAPIは以下の通りです：

1. **日次勤怠データ取得API** (`GET /api/attendance/daily`) - 既存
2. **勤務場所マスタ取得API** (`GET /api/master/work-locations`) - 既存
3. **勤怠データ更新API** (`PUT /api/attendance/record`) - 既存だが、休憩時間・公用外出の更新を含めるため拡張が必要
4. **工数実績取得API** (`GET /api/attendance/work-hours`) - 既存
5. **日次確定申請API** (`POST /api/attendance/daily-confirmation`) - 既存

現在のAPIでは、勤怠情報入力ダイアログの要件を満たすために以下の修正が必要です：

1. **勤怠データ更新API**の拡張：
   - 出勤・退勤時刻の更新に加えて、休憩時間と公用外出の一括更新を対応
   - 手入力フラグ（isClockInManual, isClockOutManual）の対応

現在の`PUT /api/attendance/record`は、休憩時間の更新を含まないため、拡張が必要です。

フロントエンドで使用されているAPIコールを確認すると：
- `getDailyAttendance` - 日次勤怠データ取得
- `updateAttendanceRecord` - 勤怠データ更新（拡張が必要）
- `submitDailyConfirmation` - 日次確定申請


- `getWorkLocations` - 勤務場所マスタ取得
- `getWorkHours` - 工数実績取得

勤怠データ更新APIの機能拡張に向けて、具体的な実装方針を検討します。休憩時間や公用外出の一括更新、手入力フラグの追加により、より柔軟な勤怠管理が可能になります。APIの拡張により、フロントエンドでのデータ入力プロセスを効率化できると考えています。

出社・退社の手入力タイプを明確に識別するため、日次勤怠データ取得APIのレスポンスに'MANUAL'判定を導入します。これにより、システム自動打刻と手動入力の区別が容易になります。</details></think>

---

既存のバックエンドコードを確認しました。勤怠情報入力ダイアログに必要なAPIは既に存在しますが、勤怠データ更新APIを拡張して休憩時間・公用外出の一括更新と手入力フラグの対応が必要です。

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
- [x] 勤務表画面に出社・退社・勤務場所のクリックイベントを追加
- [x] 勤務表画面にAttendanceInputDialogコンポーネントを統合
- [x] APIサービスに必要なAPIを追加
- [-] 勤怠データ更新APIを拡張（休憩時間・公用外出・手入力フラグ対応）
- [ ] 日次勤怠データ取得APIに手入力フラグを追加

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
勤怠データ更新API (`PUT /api/attendance/record`) を拡張して、休憩時間・公用外出の一括更新と手入力フラグの対応を追加します。</details></think>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: backend/routes/attendance.js</summary>

**Chunk 1**
Lines added: 6, lines removed: undefined

```diff
@@ -724,4 +724,10 @@
   * 勤怠記録更新API
   * PUT /api/attendance/record
+  * 
+  * 勤怠情報入力ダイアログからの更新に対応
+  * - 出社・退社時刻の更新
+  * - 休憩時間の一括更新
+  * - 公用外出の一括更新
+  * - 手入力フラグの更新
   */
  router.put('/record', async (req, res) =&gt; {
```

**Chunk 2**
Lines added: 4, lines removed: 1

```diff
@@ -735,5 +741,8 @@
      clockOutType,
      workLocationCode,
-     remarkText
+     remarkText,
+     isClockInManual,
+     isClockOutManual,
+     breakTimes // 休憩時間・公用外出の配列
    } = req.body;
  
```

**Chunk 3**
Lines added: 20, lines removed: 1

```diff
@@ -744,11 +753,30 @@
      });
    }
+ 
+   const connection = await db.getConnection();
  
    try {
+     await connection.beginTransaction();
      const now = new Date();
  
      // 既存レコードの確認
      let currentAttendanceId = attendanceId;
-     
+ 
+     // 時刻文字列をDateTimeに変換する関数
+     const toDateTime = (timeStr) =&gt; {
+       if (!timeStr) return null;
+       // H:MM形式をYYYY-MM-DD HH:MM:SS形式に変換
+       const [hours, minutes] = timeStr.split(':');
+       const dateStr = &#96;${workDate} ${hours.padStart(2, '0')}:${minutes}:00&#96;;
+       return dateStr;
+     };
+ 
+     // 打刻種別を判定
+     const determineClockType = (isManual, existingType) =&gt; {
+       if (isManual) return 'MANUAL';
+       if (existingType) return existingType;
+       return 'MANUAL';
+     };
+ 
      if (attendanceId) {
        // 既存レコードを更新
```

**Chunk 4**
Lines added: 11, lines removed: 5

```diff
@@ -758,21 +786,27 @@
        if (clockInTime !== undefined) {
          updateFields.push('CLOCK_IN_TIME = ?');
-         updateValues.push(clockInTime);
+         updateValues.push(toDateTime(clockInTime));
        }
        if (clockOutTime !== undefined) {
          updateFields.push('CLOCK_OUT_TIME = ?');
-         updateValues.push(clockOutTime);
+         updateValues.push(toDateTime(clockOutTime));
        }
-       if (clockInType !== undefined) {
+       if (isClockInManual !== undefined) {
+         updateFields.push('CLOCK_IN_TYPE = ?');
+         updateValues.push(isClockInManual ? 'MANUAL' : clockInType || 'MANUAL');
+       } else if (clockInType !== undefined) {
          updateFields.push('CLOCK_IN_TYPE = ?');
          updateValues.push(clockInType);
        }
-       if (clockOutType !== undefined) {
+       if (isClockOutManual !== undefined) {
+         updateFields.push('CLOCK_OUT_TYPE = ?');
+         updateValues.push(isClockOutManual ? 'MANUAL' : clockOutType || 'MANUAL');
+       } else if (clockOutType !== undefined) {
          updateFields.push('CLOCK_OUT_TYPE = ?');
          updateValues.push(clockOutType);
        }
        if (workLocationCode !== undefined) {
          updateFields.push('WORK_LOCATION_CODE = ?');
-         updateValues.push(workLocationCode);
+         updateValues.push(workLocationCode || null);
        }
        if (remarkText !== undefined) {
```

**Chunk 5**
Lines added: 149, lines removed: 24

```diff
@@ -781,43 +815,168 @@
        }
  
-       updateFields.push('UPDATED_AT = ?');
-       updateValues.push(now);
-       updateValues.push(attendanceId);
+       if (updateFields.length &gt; 0) {
+         updateFields.push('UPDATED_AT = ?');
+         updateValues.push(now);
+         updateValues.push(attendanceId);
  
-       await db.execute(
-         &#96;UPDATE ATTENDANCE_RECORD SET ${updateFields.join(', ')} WHERE ATTENDANCE_ID = ?&#96;,
-         updateValues
-       );
-     } else {
-       // 新規レコードを作成
-       const [result] = await db.execute(
-         &#96;INSERT INTO ATTENDANCE_RECORD 
-          (EMPLOYEE_ID, WORK_DATE, CLOCK_IN_TIME, CLOCK_OUT_TIME, CLOCK_IN_TYPE, CLOCK_OUT_TYPE, WORK_LOCATION_CODE, REMARK_TEXT, CREATED_AT, UPDATED_AT)
-          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&#96;,
-         [employeeId, workDate, clockInTime, clockOutTime, clockInType || 'MANUAL', clockOutType || 'MANUAL', workLocationCode, remarkText, now, now]
-       );
-       currentAttendanceId = result.insertId;
-     }
+         await connection.execute(
+           &#96;UPDATE ATTENDANCE_RECORD SET ${updateFields.join(', ')} WHERE ATTENDANCE_ID = ?&#96;,
+           updateValues
+         );
+       }
+     } else {
+       // 既存レコードを検索
+       const [existingRows] = await connection.execute(
+         &#96;SELECT ATTENDANCE_ID FROM ATTENDANCE_RECORD WHERE EMPLOYEE_ID = ? AND WORK_DATE = ?&#96;,
+         [employeeId, workDate]
+       );
+ 
+       if (existingRows.length &gt; 0) {
+         // 既存レコードを更新
+         currentAttendanceId = existingRows[0].ATTENDANCE_ID;
+         
+         const updateFields = [];
+         const updateValues = [];
+ 
+         if (clockInTime !== undefined) {
+           updateFields.push('CLOCK_IN_TIME = ?');
+           updateValues.push(toDateTime(clockInTime));
+         }
+         if (clockOutTime !== undefined) {
+           updateFields.push('CLOCK_OUT_TIME = ?');
+           updateValues.push(toDateTime(clockOutTime));
+         }
+         if (isClockInManual !== undefined) {
+           updateFields.push('CLOCK_IN_TYPE = ?');
+           updateValues.push(isClockInManual ? 'MANUAL' : 'MANUAL');
+         }
+         if (isClockOutManual !== undefined) {
+           updateFields.push('CLOCK_OUT_TYPE = ?');
+           updateValues.push(isClockOutManual ? 'MANUAL' : 'MANUAL');
+         }
+         if (workLocationCode !== undefined) {
+           updateFields.push('WORK_LOCATION_CODE = ?');
+           updateValues.push(workLocationCode || null);
+         }
+         if (remarkText !== undefined) {
+           updateFields.push('REMARK_TEXT = ?');
+           updateValues.push(remarkText);
+         }
+ 
+         if (updateFields.length &gt; 0) {
+           updateFields.push('UPDATED_AT = ?');
+           updateValues.push(now);
+           updateValues.push(currentAttendanceId);
+ 
+           await connection.execute(
+             &#96;UPDATE ATTENDANCE_RECORD SET ${updateFields.join(', ')} WHERE ATTENDANCE_ID = ?&#96;,
+             updateValues
+           );
+         }
+       } else {
+         // 新規レコードを作成
+         const [result] = await connection.execute(
+           &#96;INSERT INTO ATTENDANCE_RECORD 
+            (EMPLOYEE_ID, WORK_DATE, CLOCK_IN_TIME, CLOCK_OUT_TIME, CLOCK_IN_TYPE, CLOCK_OUT_TYPE, WORK_LOCATION_CODE, REMARK_TEXT, CREATED_AT, UPDATED_AT)
+            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&#96;,
+           [
+             employeeId, 
+             workDate, 
+             toDateTime(clockInTime), 
+             toDateTime(clockOutTime), 
+             isClockInManual ? 'MANUAL' : (clockInType || 'MANUAL'), 
+             isClockOutManual ? 'MANUAL' : (clockOutType || 'MANUAL'), 
+             workLocationCode || null, 
+             remarkText, 
+             now, 
+             now
+           ]
+         );
+         currentAttendanceId = result.insertId;
+       }
+     }
+ 
+     // 休憩時間・公用外出の更新
+     if (breakTimes &amp;&amp; Array.isArray(breakTimes) &amp;&amp; currentAttendanceId) {
+       // 既存の休憩時間を削除
+       await connection.execute(
+         &#96;DELETE FROM BREAK_TIME WHERE ATTENDANCE_ID = ?&#96;,
+         [currentAttendanceId]
+       );
+ 
+       // 既存の公用外出を削除
+       await connection.execute(
+         &#96;DELETE FROM OFFICIAL_OUTING WHERE ATTENDANCE_ID = ?&#96;,
+         [currentAttendanceId]
+       );
+ 
+       // 休憩時間と公用外出を登録
+       let breakSeq = 1;
+       let outingSeq = 1;
+ 
+       for (const item of breakTimes) {
+         const startTime = toDateTime(item.breakStartTime);
+         const endTime = toDateTime(item.breakEndTime);
+ 
+         if (!startTime || !endTime) continue;
+ 
+         // 休憩時間（分）を計算
+         const startDate = new Date(startTime);
+         const endDate = new Date(endTime);
+         const durationMinutes = Math.floor((endDate - startDate) / 1000 / 60);
+ 
+         if (item.breakType === 'BREAK') {
+           // 休憩時間をBREAK_TIMEテーブルに登録
+           await connection.execute(
+             &#96;INSERT INTO BREAK_TIME 
+              (ATTENDANCE_ID, BREAK_SEQ, BREAK_START_TIME, BREAK_END_TIME, BREAK_DURATION_MINUTES, BREAK_TYPE, CREATED_AT, UPDATED_AT)
+              VALUES (?, ?, ?, ?, ?, 'REGULAR', ?, ?)&#96;,
+             [currentAttendanceId, breakSeq++, startTime, endTime, durationMinutes, now, now]
+           );
+         } else if (item.breakType === 'OFFICIAL_OUTING') {
+           // 公用外出をOFFICIAL_OUTINGテーブルに登録
+           await connection.execute(
+             &#96;INSERT INTO OFFICIAL_OUTING 
+              (ATTENDANCE_ID, OUTING_SEQ, OUTING_START_TIME, OUTING_END_TIME, OUTING_DURATION_MINUTES, CREATED_AT, UPDATED_AT)
+              VALUES (?, ?, ?, ?, ?, ?, ?)&#96;,
+             [currentAttendanceId, outingSeq++, startTime, endTime, durationMinutes, now, now]
+           );
+         }
+       }
+     }
  
      // 実労働時間を計算
-     if (clockInTime &amp;&amp; clockOutTime) {
-       const clockIn = new Date(clockInTime);
-       const clockOut = new Date(clockOutTime);
+     const clockInDateTime = toDateTime(clockInTime);
+     const clockOutDateTime = toDateTime(clockOutTime);
+     
+     if (clockInDateTime &amp;&amp; clockOutDateTime) {
+       const clockIn = new Date(clockInDateTime);
+       const clockOut = new Date(clockOutDateTime);
        const totalMinutes = (clockOut - clockIn) / 1000 / 60;
  
        // 休憩時間の合計を取得
-       const [breakRows] = await db.execute(
-         &#96;SELECT SUM(BREAK_DURATION_MINUTES) as totalBreak FROM BREAK_TIME WHERE ATTENDANCE_ID = ?&#96;,
+       const [breakRows] = await connection.execute(
+         &#96;SELECT COALESCE(SUM(BREAK_DURATION_MINUTES), 0) as totalBreak FROM BREAK_TIME WHERE ATTENDANCE_ID = ?&#96;,
          [currentAttendanceId]
        );
        const breakMinutes = breakRows[0]?.totalBreak || 0;
  
+       // 公用外出時間の合計を取得（公用外出は労働時間に含まれる）
+       // const [outingRows] = await connection.execute(
+       //   &#96;SELECT COALESCE(SUM(OUTING_DURATION_MINUTES), 0) as totalOuting FROM OFFICIAL_OUTING WHERE ATTENDANCE_ID = ?&#96;,
+       //   [currentAttendanceId]
+       // );
+       // const outingMinutes = outingRows[0]?.totalOuting || 0;
+ 
+       // 実労働時間 = 総時間 - 休憩時間
        const actualWorkHours = (totalMinutes - breakMinutes) / 60;
  
-       await db.execute(
+       await connection.execute(
          &#96;UPDATE ATTENDANCE_RECORD SET ACTUAL_WORK_HOURS = ?, UPDATED_AT = ? WHERE ATTENDANCE_ID = ?&#96;,
-         [actualWorkHours, now, currentAttendanceId]
+         [actualWorkHours.toFixed(2), now, currentAttendanceId]
        );
      }
+ 
+     await connection.commit();
  
      // 更新後のデータを取得
```

**Chunk 6**
Lines added: 3, lines removed: undefined

```diff
@@ -833,9 +992,12 @@
      });
    } catch (error) {
+     await connection.rollback();
      console.error('勤怠記録更新エラー:', error);
      res.status(500).json({
        success: false,
        message: '勤怠記録の更新に失敗しました。'
      });
+   } finally {
+     connection.release();
    }
  });
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
勤怠データ更新APIを拡張しました。次に、日次勤怠データ取得APIに手入力フラグを追加します。既存のAPIでは、休憩時間の取得でBREAK_TYPEに応じてフィルタリングしているようですが、フロントエンド側で参照している`BREAK_TYPE`がテーブル設計と一致しているか確認する必要があります。

テーブル設計を見ると:
- BREAK_TIMEテーブル: BREAK_TYPE VARCHAR(20) DEFAULT 'REGULAR' COMMENT '休憩種別(通常/中断)'
- OFFICIAL_OUTINGテーブル: 別テーブルとして存在

フロントエンドのコードでは、`BREAK_TYPE === 'BREAK'`や`BREAK_TYPE === 'OFFICIAL_OUTING'`でフィルタリングしていますが、実際のテーブル設計では:
- BREAK_TIMEテーブルのBREAK_TYPEは'REGULAR'が使われている
- 公用外出はOFFICIAL_OUTINGテーブルに別途格納される

これを考慮して、日次勤怠データ取得APIを更新して、休憩時間と公用外出を統合して返すようにします。</details></think>

---

次に、日次勤怠データ取得APIを更新して、休憩時間と公用外出を統合して返し、フロントエンドで使いやすい形式にします。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: backend/routes/attendance.js</summary>

**Chunk 1**
Lines added: 2, lines removed: undefined

```diff
@@ -645,4 +645,6 @@
   * 日次勤怠記録取得API
   * GET /api/attendance/daily
+  * 
+  * 勤怠情報入力ダイアログ用に休憩時間と公用外出を統合して返す
   */
  router.get('/daily', async (req, res) =&gt; {
```

**Chunk 2**
Lines added: 31, lines removed: 1

```diff
@@ -703,10 +705,40 @@
        [attendance.ATTENDANCE_ID]
      );
+ 
+     // 休憩時間と公用外出を統合（勤怠情報入力ダイアログ用）
+     const combinedBreakTimes = [];
+     
+     // 休憩時間をBREAKタイプとして追加
+     for (const breakTime of breakRows) {
+       combinedBreakTimes.push({
+         ...breakTime,
+         BREAK_TYPE: 'BREAK' // 統一されたタイプ名
+       });
+     }
+     
+     // 公用外出をOFFICIAL_OUTINGタイプとして追加
+     for (const outing of outingRows) {
+       combinedBreakTimes.push({
+         BREAK_ID: outing.OUTING_ID,
+         BREAK_SEQ: outing.OUTING_SEQ,
+         BREAK_START_TIME: outing.OUTING_START_TIME,
+         BREAK_END_TIME: outing.OUTING_END_TIME,
+         BREAK_DURATION_MINUTES: outing.OUTING_DURATION_MINUTES,
+         BREAK_TYPE: 'OFFICIAL_OUTING', // 統一されたタイプ名
+         OUTING_PURPOSE: outing.OUTING_PURPOSE
+       });
+     }
+ 
+     // 手入力フラグを設定
+     const isClockInManual = attendance.CLOCK_IN_TYPE === 'MANUAL';
+     const isClockOutManual = attendance.CLOCK_OUT_TYPE === 'MANUAL';
  
      res.json({
        success: true,
        attendance: {
          ...attendance,
-         breakTimes: breakRows,
+         IS_CLOCK_IN_MANUAL: isClockInManual,
+         IS_CLOCK_OUT_MANUAL: isClockOutManual,
+         breakTimes: combinedBreakTimes,
          officialOutings: outingRows
        }
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
次に、フロントエンドのAPIサービスで勤務場所マスタの取得が正しくマッピングされるように確認します。現在のフロントエンドでは`getWorkLocations`を`@/services/api`からインポートしていますが、APIエンドポイントが正しいか確認する必要があります。

バックエンドでは:
- `/api/master/work-locations` (master.js)
- `/api/attendance/work-locations` (attendance.js)

の2つのエンドポイントがあります。フロントエンドのAPIサービスを確認して、正しいエンドポイントを使用しているか確認します。</details></think>

---

フロントエンドのAPIサービスを確認して、勤務場所マスタ取得APIのエンドポイントが正しいか確認します。

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/services/api.js</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
フロントエンドのAPIサービスを確認しました。勤務場所マスタ取得APIのエンドポイントは`/master/work-locations`を使用しています。バックエンドのmaster.jsでは、このエンドポイントが実装されていますが、レスポンスの形式を確認する必要があります。

バックエンドのmaster.jsのレスポンス:
```javascript
res.json({
  success: true,
  workLocations: rows
});
```

rowsの中身は:
```sql
SELECT LOCATION_CODE, LOCATION_NAME, DISPLAY_ORDER
FROM WORK_LOCATION
```

フロントエンドのAttendanceInputDialog.vueでは:
```javascript
this.workLocations = response.workLocations.map(loc => ({
  code: loc.WORK_LOCATION_CODE,
  name: loc.WORK_LOCATION_NAME
}))
```

しかし、master.jsの結果は`LOCATION_CODE`と`LOCATION_NAME`という列名で返されているので、マッピングに不整合があります。これを修正する必要があります。バックエンドの列名がフロントエンドの期待と一致するように修正します。</details></think>

---

フロントエンドの期待する列名とバックエンドの返す列名に不整合があります。バックエンドのmaster.jsを修正して、列名を統一します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: backend/routes/master.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -12,5 +12,5 @@
    try {
      const [rows] = await db.execute(
-       &#96;SELECT LOCATION_CODE, LOCATION_NAME, DISPLAY_ORDER
+       &#96;SELECT LOCATION_CODE AS WORK_LOCATION_CODE, LOCATION_NAME AS WORK_LOCATION_NAME, DISPLAY_ORDER
         FROM WORK_LOCATION 
         WHERE IS_ACTIVE = TRUE 
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
バックエンドの修正が完了しました。次に、TODOを更新して完了状態にします。また、データベースのテーブル設計で、公用外出を休憩時間と同じテーブルに保存するかどうかを確認する必要があります。現在のテーブル設計では公用外出はOFFICIAL_OUTINGテーブルに保存されていますが、詳細設計書ではBREAK_TIMEテーブルにBREAK_TYPEでOFFICIAL_OUTINGを指定する形式になっています。

既存のテーブル設計を尊重し、バックエンドのAPIでOFFICIAL_OUTINGテーブルを使用するようにしました。これで実装は完了です。最後に、日次確定申請APIの工数チェックを確認します。現在のAPIでは工数が0の場合のエラーメッセージが返されるようになっていますが、詳細設計書では「工数実績が入力されていません。」というエラーメッセージを表示する仕様になっています。

これを確認して、必要に応じて修正します。</details></think>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** • Todo List</summary>

- [x] 勤怠情報入力ダイアログコンポーネント（AttendanceInputDialog.vue）を作成
- [x] 勤務表画面に出社・退社・勤務場所のクリックイベントを追加
- [x] 勤務表画面にAttendanceInputDialogコンポーネントを統合
- [x] APIサービスに必要なAPIを追加
- [x] 勤怠データ更新APIを拡張（休憩時間・公用外出・手入力フラグ対応）
- [x] 日次勤怠データ取得APIに手入力フラグを追加

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
日次確定申請APIの工数チェックを確認して、詳細設計書の仕様に合わせます。</details></think>

---

日次確定申請APIの工数チェックを確認し、詳細設計書に合わせて修正します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: backend/routes/attendance.js</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -1355,5 +1355,5 @@
      }
  
-     // 工数合計と実労働時間の一致チェック
+     // 工数実績チェック
      const [workHoursRows] = await db.execute(
        &#96;SELECT SUM(WORK_HOURS_VALUE) as totalWorkHours FROM WORK_HOURS WHERE ATTENDANCE_ID = ?&#96;,
```

**Chunk 2**
Lines added: 8, lines removed: 2

```diff
@@ -1363,6 +1363,12 @@
      const actualWorkHours = parseFloat(attendance.ACTUAL_WORK_HOURS) || 0;
      
-     if (Math.abs(totalWorkHours - actualWorkHours) &gt; 0.01) {
-       errors.push('工数の合計と実労働時間が合いません');
+     // 工数が入力されていない場合はエラー
+     if (totalWorkHours === 0) {
+       errors.push('工数実績が入力されていません。');
+     }
+     
+     // 工数合計と実労働時間の一致チェック
+     if (totalWorkHours &gt; 0 &amp;&amp; actualWorkHours &gt; 0 &amp;&amp; Math.abs(totalWorkHours - actualWorkHours) &gt; 0.01) {
+       errors.push('工数の合計と実労働時間が合いません。');
      }
  
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
バックエンド実装は完了しました。念のため、フロントエンドのAttendanceInputDialog.vueが正しく現在の状態に反映されているか確認します。ユーザーはファイルを編集しているようなので、現在の状態を確認します。</details></think>

---

フロントエンドのダイアログコンポーネントを確認して、ユーザーの修正を反映した状態を確認します。

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/components/dialog/AttendanceInputDialog.vue</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
ユーザーが修正したAttendanceInputDialog.vueが存在しています（小文字の"dialog"フォルダに）。TimesheetScreen.vueのインポートパスが大文字の"Dialog"フォルダを参照しているので、パスを確認して必要に応じて修正します。</details></think>

---

パスの不整合を確認します。インポートパスが正しいか確認します。

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** • Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
フォルダ名が小文字の"dialog"になっていますが、TimesheetScreen.vueのインポートが大文字"Dialog"を使用しています。Windowsではファイルシステムが大文字小文字を区別しないため動作しますが、一貫性を保つために修正が必要です。ユーザーが作成したファイルが小文字のdialogフォルダにあるので、インポートパスを修正します。</details></think>

---

インポートパスに不整合があります。TimesheetScreen.vueのインポートパスを修正します。

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -638,5 +638,5 @@
  import AppHeader from '@/components/AppHeader.vue'
  import AttendanceApplicationDialog from '@/components/dialog/AttendanceApplicationDialog.vue'
- import AttendanceInputDialog from '@/components/Dialog/AttendanceInputDialog.vue'
+ import AttendanceInputDialog from '@/components/dialog/AttendanceInputDialog.vue'
  import HolidayJp from '@holiday-jp/holiday_jp'
  import { getMonthlyAttendance, getEmployeeInfo, submitDailyConfirmation, updateAttendanceRecord } from '@/services/api'
```

</details>

</tool-use>

---

<think><details><summary>Thought Process</summary>
また、私が作成したAttendanceInputDialog.vueは大文字のDialogフォルダに作成されたようですが、ユーザーが修正したバージョンは小文字のdialogフォルダにあります。重複がないか確認し、必要に応じて削除します。</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** • Searched codebase "**/AttendanceInputDialog.vue" • **1** result in **1** directory</summary>

Directory: **c:\TeamSpirit\CodeCommit\TeamSpirit再現企画\frontend** (1 file)

| File |
|------|
| `src\components\dialog\AttendanceInputDialog.vue` |

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
AttendanceInputDialog.vueは1つだけ存在しています（frontend/src/components/dialog/AttendanceInputDialog.vue）。これは問題ありません。

バックエンドの実装が完了しました。最後にlintエラーがないか確認します。</details></think>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 3 files</summary>
      
Lint paths:

- `backend/routes/attendance.js`
- `backend/routes/master.js`
- `frontend/src/views/TimesheetScreen.vue`

Lint results


**No lint errors found**
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
バックエンドの実装が完了しました。以下に実装内容をまとめます。</details></think>

---

バックエンドの実装が完了しました。以下に実装内容をまとめます。

## バックエンド実装完了

### 1. 勤怠データ更新API（`PUT /api/attendance/record`）の拡張

**追加機能:**
- 休憩時間の一括更新（BREAK_TIMEテーブル）
- 公用外出の一括更新（OFFICIAL_OUTINGテーブル）
- 出社・退社の手入力フラグ（`isClockInManual`, `isClockOutManual`）対応
- トランザクション処理による整合性確保
- 時刻文字列（H:MM形式）からDateTimeへの変換
- 実労働時間の自動計算

**リクエストボディ:**
```javascript
{
  employeeId: "000001",
  workDate: "2025-12-09",
  clockInTime: "9:00",
  clockOutTime: "17:30",
  workLocationCode: "COMMUTE",
  isClockInManual: true,
  isClockOutManual: false,
  breakTimes: [
    { breakStartTime: "12:00", breakEndTime: "13:00", breakType: "BREAK" },
    { breakStartTime: "15:00", breakEndTime: "15:30", breakType: "OFFICIAL_OUTING" }
  ]
}
```

### 2. 日次勤怠データ取得API（`GET /api/attendance/daily`）の更新

**追加機能:**
- 手入力フラグ（`IS_CLOCK_IN_MANUAL`, `IS_CLOCK_OUT_MANUAL`）の追加
- 休憩時間と公用外出を統合した`breakTimes`配列を返却
  - BREAK_TIMEテーブルのデータは`BREAK_TYPE: 'BREAK'`
  - OFFICIAL_OUTINGテーブルのデータは`BREAK_TYPE: 'OFFICIAL_OUTING'`

### 3. 日次確定申請API（`POST /api/attendance/daily-confirmation`）の更新

**追加チェック:**
- 工数実績が入力されていない場合のエラーチェック
- エラーメッセージ: 「工数実績が入力されていません。」

### 4. 勤務場所マスタ取得API（`GET /api/master/work-locations`）の更新

**修正内容:**
- 列名をフロントエンドの期待に合わせて統一
  - `LOCATION_CODE` → `WORK_LOCATION_CODE`
  - `LOCATION_NAME` → `WORK_LOCATION_NAME`

### 5. インポートパスの修正

- `TimesheetScreen.vue`のインポートパスを小文字の`dialog`フォルダに統一

### テーブル設計との整合性

現在のテーブル設計に基づき、以下のテーブルを使用：
- **ATTENDANCE_RECORD**: 出社・退社時刻、勤務場所、手入力フラグ（CLOCK_IN_TYPE/CLOCK_OUT_TYPE）
- **BREAK_TIME**: 休憩時間（通常休憩）
- **OFFICIAL_OUTING**: 公用外出
- **WORK_HOURS**: 工数実績

---

