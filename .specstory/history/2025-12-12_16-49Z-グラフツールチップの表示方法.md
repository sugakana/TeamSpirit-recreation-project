<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 50c99d2a-2759-4409-bfcd-4823edc21ca8 (2025-12-12 16:49Z) -->

# グラフツールチップの表示方法 (2025-12-12 16:49Z)

_**User (2025-12-12 08:08Z)**_

​グラフツールチップの表示方法は現在どうなっていますか

---

_**Agent (model composer-1, mode Agent)**_



---


グラフツールチップの実装を確認中です。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "グラフツールチップの表示方法 tooltip chart graph" • **5** results</summary>
            
| File | Lines |
|------|-------|
| `frontend/src/views/TimesheetScreen.vue` | L1962-2010 |
| `frontend/src/views/TimesheetScreen.vue` | L3974-4084 |
| `frontend/src/views/TimesheetScreen.vue` | L2008-2052 |
| `frontend/src/views/TimesheetScreen.vue` | L448-481 |
| `docs/detailed-design/ui/attendance-table-screen.md` | L1505-1535 |

</details>
</tool-use>

---



---


ツールチップの表示部分と関連メソッドを確認中です。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "tooltipDay|showTooltip|tooltipStyle" in "frontend/src/views/TimesheetScreen.vue" • 11 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/src/views/TimesheetScreen.vue` | `v-if="showTooltip && tooltipDay === day"` | L477 |
| `frontend/src/views/TimesheetScreen.vue` | `:style="tooltipStyle"` | L479 |
| `frontend/src/views/TimesheetScreen.vue` | `showTooltip: false,` | L939 |
| `frontend/src/views/TimesheetScreen.vue` | `tooltipDay: null,` | L940 |
| `frontend/src/views/TimesheetScreen.vue` | `tooltipStyle: \{` | L941 |
| `frontend/src/views/TimesheetScreen.vue` | `this.tooltipDay = day` | L1965 |
| `frontend/src/views/TimesheetScreen.vue` | `this.showTooltip = true` | L1966 |
| `frontend/src/views/TimesheetScreen.vue` | `this.showTooltip = false` | L1972 |
| `frontend/src/views/TimesheetScreen.vue` | `this.tooltipDay = null` | L1973 |
| `frontend/src/views/TimesheetScreen.vue` | `if (!this.showTooltip) return` | L1978 |
| `frontend/src/views/TimesheetScreen.vue` | `this.tooltipStyle = \{` | L2040 |


</details>
</tool-use>

---



---


データプロパティの定義を確認中です。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "@mouseenter.*showGraphTooltip|@mouseleave.*hideGraphTooltip|@mousemove.*updateGraphTooltipPosition" in "frontend/src/views/TimesheetScreen.vue" • 9 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/src/views/TimesheetScreen.vue` | `@mouseenter="showGraphTooltip(day, $event)"` | L435 |
| `frontend/src/views/TimesheetScreen.vue` | `@mouseleave="hideGraphTooltip"` | L436 |
| `frontend/src/views/TimesheetScreen.vue` | `@mousemove="updateGraphTooltipPosition($event)"` | L437 |
| `frontend/src/views/TimesheetScreen.vue` | `@mouseenter="showGraphTooltip(day, $event)"` | L445 |
| `frontend/src/views/TimesheetScreen.vue` | `@mouseleave="hideGraphTooltip"` | L446 |
| `frontend/src/views/TimesheetScreen.vue` | `@mousemove="updateGraphTooltipPosition($event)"` | L447 |
| `frontend/src/views/TimesheetScreen.vue` | `@mouseenter="showGraphTooltip(day, $event)"` | L456 |
| `frontend/src/views/TimesheetScreen.vue` | `@mouseleave="hideGraphTooltip"` | L457 |
| `frontend/src/views/TimesheetScreen.vue` | `@mousemove="updateGraphTooltipPosition($event)"` | L458 |


</details>
</tool-use>

---



---


ツールチップが設定されている要素を確認中です。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---



---


グラフツールチップの表示方法は次のとおりです。

## グラフツールチップの表示方法

### 1. **トリガー要素**
以下の3つの要素にマウスイベントが設定されています：

```430:459:frontend/src/views/TimesheetScreen.vue
        <!-- 標準勤務時間帯のグレー長方形（平日のみ） -->
        <div 
          v-if="!day.isHoliday && day.dayOfWeekNum >= 1 && day.dayOfWeekNum <= 5" 
          class="scheduled-work-time-bar" 
          :style="getScheduledWorkTimeStyle()"
          @mouseenter="showGraphTooltip(day, $event)"
          @mouseleave="hideGraphTooltip"
          @mousemove="updateGraphTooltipPosition($event)"
        ></div>
        <!-- グラフバー（出勤・退勤の両方がある場合のみ） -->
        <div v-if="day.clockIn && day.clockOut" class="work-graph">
          <!-- グラフバー -->
          <div 
            class="graph-bar" 
            :style="getGraphStyle(day)"
            @mouseenter="showGraphTooltip(day, $event)"
            @mouseleave="hideGraphTooltip"
            @mousemove="updateGraphTooltipPosition($event)"
          ></div>
        </div>
        <!-- 休憩時間の四角形（複数対応） -->
        <template v-for="(breakTime, index) in day.breakTimes" :key="index">
          <div 
            v-if="shouldShowBreakTime(breakTime, day)"
            class="break-time-bar" 
            :style="{ ...getBreakTimeStyle(breakTime, day), backgroundColor: getBreakTimeColor(breakTime, day) }"
            @mouseenter="showGraphTooltip(day, $event)"
            @mouseleave="hideGraphTooltip"
            @mousemove="updateGraphTooltipPosition($event)"
          ></div>
        </template>
```

### 2. **表示制御**
データプロパティで表示状態を管理：

```939:944:frontend/src/views/TimesheetScreen.vue
      showTooltip: false,
      tooltipDay: null,
      tooltipStyle: {
        top: '0px',
        left: '0px'
      }
```

### 3. **表示/非表示メソッド**

```1963:1974:frontend/src/views/TimesheetScreen.vue
    // グラフツールチップを表示
    showGraphTooltip(day, event) {
      this.tooltipDay = day
      this.showTooltip = true
      this.updateGraphTooltipPosition(event)
    },
    
    // グラフツールチップを非表示
    hideGraphTooltip() {
      this.showTooltip = false
      this.tooltipDay = null
    },
```

### 4. **位置計算**
`updateGraphTooltipPosition` で位置を計算：

```1976:2044:frontend/src/views/TimesheetScreen.vue
    // グラフツールチップの位置を更新
    updateGraphTooltipPosition(event) {
      if (!this.showTooltip) return
      
      const tooltipOffset = 10
      const tooltipWidth = 280
      const tooltipHeight = 400 // 最大高さを考慮
      
      // グラフ要素の位置を取得
      const graphElement = event.target
      const graphRect = graphElement.getBoundingClientRect()
      
      // X方向の位置決定：デフォルトはグラフ要素の右側に表示
      let left = graphRect.right + tooltipOffset
      
      // 画面右端を超える場合は、グラフ要素の左側に表示
      if (left + tooltipWidth > window.innerWidth - tooltipOffset) {
        left = graphRect.left - tooltipWidth - tooltipOffset
      }
      
      // 画面左端を超える場合は右側に表示（グラフ要素の右側）
      if (left < tooltipOffset) {
        left = graphRect.right + tooltipOffset
        // それでも画面外に出る場合は、画面左端に合わせる
        if (left + tooltipWidth > window.innerWidth - tooltipOffset) {
          left = tooltipOffset
        }
      }
      
      // Y方向の位置決定：グラフ要素の近くに表示
      // グラフの上側に表示できる位置を計算
      const topAbove = graphRect.top - tooltipHeight - tooltipOffset
      // グラフの下側に表示できる位置を計算
      const topBelow = graphRect.bottom + tooltipOffset
      
      // グラフの上側に表示できるか確認（画面上端を超えない、かつ画面内に収まる）
      const canShowAbove = topAbove >= tooltipOffset && topAbove + tooltipHeight <= window.innerHeight - tooltipOffset
      // グラフの下側に表示できるか確認（画面下端を超えない）
      const canShowBelow = topBelow + tooltipHeight <= window.innerHeight - tooltipOffset
      
      // グラフからの距離を計算（ツールチップの上端からグラフの上端までの距離、またはツールチップの上端からグラフの下端までの距離）
      const distanceAbove = canShowAbove ? Math.abs(topAbove - graphRect.top) : Infinity
      const distanceBelow = canShowBelow ? Math.abs(topBelow - graphRect.bottom) : Infinity
      
      let top
      if (canShowAbove && canShowBelow) {
        // 両方表示できる場合は、グラフにより近い方を選択
        top = distanceAbove < distanceBelow ? topAbove : topBelow
      } else if (canShowAbove) {
        // 上側のみ表示できる場合
        top = topAbove
      } else if (canShowBelow) {
        // 下側のみ表示できる場合
        top = topBelow
      } else {
        // どちらも表示できない場合は、画面内に収まるように調整
        // グラフにより近い位置を選択
        const maxTopAbove = Math.max(tooltipOffset, graphRect.top - tooltipHeight - tooltipOffset)
        const maxTopBelow = Math.min(window.innerHeight - tooltipHeight - tooltipOffset, graphRect.bottom + tooltipOffset)
        const distAbove = Math.abs(maxTopAbove + tooltipHeight - graphRect.top)
        const distBelow = Math.abs(maxTopBelow - graphRect.bottom)
        top = distAbove < distBelow ? maxTopAbove : maxTopBelow
      }
      
      this.tooltipStyle = {
        top: `${top}px`,
        left: `${left}px`
      }
    },
```

### 5. **ツールチップの表示内容**
ツールチップの構造：

```475:571:frontend/src/views/TimesheetScreen.vue
      <!-- グラフツールチップ -->
      <div 
        v-if="showTooltip && tooltipDay === day"
        class="graph-tooltip"
        :style="tooltipStyle"
      >
        <div class="tooltip-content">
          <!-- 見出し: 標準の勤務時間 -->
          <div class="tooltip-header">
            <span class="tooltip-icon tooltip-icon-gray">■</span>
            <span class="tooltip-header-text">標準の勤務時間</span>
          </div>
          
          <!-- 標準勤務時間 -->
          <div class="tooltip-row">
            <span class="tooltip-icon tooltip-icon-gray">■</span>
            <span class="tooltip-label">標準勤務時間</span>
            <span class="tooltip-value">{{ getTooltipScheduledWorkTime(day) }}</span>
          </div>
          
          <!-- 所定休憩時間 -->
          <div class="tooltip-row">
            <span class="tooltip-icon tooltip-icon-gray">■</span>
            <span class="tooltip-label">所定休憩時間</span>
            <span class="tooltip-value">{{ getTooltipScheduledBreakTime(day) }}</span>
          </div>
          
          <!-- 休暇の場合の表示 -->
          <template v-if="day.hasVacation">
            <!-- 総労働時間（休暇時のみ） -->
            <div class="tooltip-row">
              <span class="tooltip-icon tooltip-icon-gray">■</span>
              <span class="tooltip-label">総労働時間</span>
              <span class="tooltip-value">{{ getTooltipTotalWorkTimeForVacation(day) }}</span>
            </div>
          </template>
          
          <!-- 通常勤務の場合の表示 -->
          <template v-else-if="day.clockIn && day.clockOut">
            <!-- 区切り線 -->
            <div class="tooltip-divider"></div>
            
            <!-- 出退社時刻 -->
            <div class="tooltip-row">
              <span class="tooltip-label">出退社時刻</span>
              <span class="tooltip-value">{{ day.clockIn }}-{{ day.clockOut }}</span>
            </div>
            
            <!-- 休憩時間 -->
            <div v-if="day.breakTimes && day.breakTimes.length > 0" class="tooltip-row">
              <span class="tooltip-label">休憩時間</span>
              <span class="tooltip-value">{{ getTooltipBreakTimes(day) }}</span>
            </div>
            
            <!-- 総労働時間 -->
            <div class="tooltip-row">
              <span class="tooltip-label">総労働時間</span>
              <span class="tooltip-value">{{ getTooltipTotalWorkTime(day) }}</span>
            </div>
            
            <!-- 実労働時間 -->
            <div v-if="day.actualWorkHours" class="tooltip-row">
              <span class="tooltip-label">実労働時間</span>
              <span class="tooltip-value">{{ formatHoursToHMM(day.actualWorkHours) }}</span>
            </div>
            
            <!-- 休憩時間合計 -->
            <div v-if="day.breakTimes && day.breakTimes.length > 0" class="tooltip-row">
              <span class="tooltip-icon tooltip-icon-blue">■</span>
              <span class="tooltip-label">休憩時間合計</span>
              <span class="tooltip-value">{{ getTooltipTotalBreakTime(day) }}</span>
            </div>
            
            <!-- 所定内労働（実労働時間が7.5時間以下の場合のみ表示） -->
            <div v-if="shouldShowScheduledWorkHours(day)" class="tooltip-row">
              <span class="tooltip-icon tooltip-icon-blue">■</span>
              <span class="tooltip-label">所定内労働</span>
              <span class="tooltip-value">{{ getTooltipScheduledWorkHours(day) }}</span>
            </div>
            
            <!-- 法定時間内残業（月次累積） -->
            <div v-if="shouldShowMonthlyWithinLegalOvertime(day)" class="tooltip-row">
              <span class="tooltip-icon tooltip-icon-yellow">■</span>
              <span class="tooltip-label">法定時間内残業</span>
              <span class="tooltip-value">{{ getMonthlyWithinLegalOvertime(day) }}</span>
            </div>
            
            <!-- 法定時間外残業（月次累積） -->
            <div v-if="shouldShowMonthlyOverLegalOvertime(day)" class="tooltip-row">
              <span class="tooltip-icon tooltip-icon-orange">■</span>
              <span class="tooltip-label">法定時間外残業</span>
              <span class="tooltip-value">{{ getMonthlyOverLegalOvertime(day) }}</span>
            </div>
            
          </template>
        </div>
      </div>
```

## まとめ

- トリガー: 標準勤務時間帯のグレー長方形、グラフバー、休憩時間の四角形にマウスホバー
- 表示制御: `showTooltip` と `tooltipDay` で制御
- 位置計算: 画面端を考慮し、上下左右に自動調整
- 表示内容: 標準勤務時間、実際の勤務詳細、休暇情報などを条件に応じて表示
- スタイル: `position: fixed` で画面に固定表示、`z-index: 10002` で最前面に表示

マウス移動時に位置を更新し、画面外に出ないよう自動調整します。

---

_**User (2025-12-12 08:08Z)**_

グラフにカーソルを当てた時に真横に表示させることはできますか

---

_**Agent (model composer-1, mode Agent)**_



---


グラフツールチップをグラフ要素の真横（同じ高さ）に固定表示するよう修正します。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/TimesheetScreen.vue</summary>

</details>
</tool-use>

---



---


Y位置をグラフ要素の真横（同じ高さ）に固定するよう修正します。


---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** • Edit file: frontend/src/views/TimesheetScreen.vue</summary>

**Chunk 1**
Lines added: 11, lines removed: 32

```diff
@@ -2003,37 +2003,16 @@
        }
        
-       // Y方向の位置決定：グラフ要素の近くに表示
-       // グラフの上側に表示できる位置を計算
-       const topAbove = graphRect.top - tooltipHeight - tooltipOffset
-       // グラフの下側に表示できる位置を計算
-       const topBelow = graphRect.bottom + tooltipOffset
+       // Y方向の位置決定：グラフ要素の真横（同じ高さ）に表示
+       // デフォルトでグラフ要素の上端に合わせる
+       let top = graphRect.top
        
-       // グラフの上側に表示できるか確認（画面上端を超えない、かつ画面内に収まる）
-       const canShowAbove = topAbove &gt;= tooltipOffset &amp;&amp; topAbove + tooltipHeight &lt;= window.innerHeight - tooltipOffset
-       // グラフの下側に表示できるか確認（画面下端を超えない）
-       const canShowBelow = topBelow + tooltipHeight &lt;= window.innerHeight - tooltipOffset
-       
-       // グラフからの距離を計算（ツールチップの上端からグラフの上端までの距離、またはツールチップの上端からグラフの下端までの距離）
-       const distanceAbove = canShowAbove ? Math.abs(topAbove - graphRect.top) : Infinity
-       const distanceBelow = canShowBelow ? Math.abs(topBelow - graphRect.bottom) : Infinity
-       
-       let top
-       if (canShowAbove &amp;&amp; canShowBelow) {
-         // 両方表示できる場合は、グラフにより近い方を選択
-         top = distanceAbove &lt; distanceBelow ? topAbove : topBelow
-       } else if (canShowAbove) {
-         // 上側のみ表示できる場合
-         top = topAbove
-       } else if (canShowBelow) {
-         // 下側のみ表示できる場合
-         top = topBelow
-       } else {
-         // どちらも表示できない場合は、画面内に収まるように調整
-         // グラフにより近い位置を選択
-         const maxTopAbove = Math.max(tooltipOffset, graphRect.top - tooltipHeight - tooltipOffset)
-         const maxTopBelow = Math.min(window.innerHeight - tooltipHeight - tooltipOffset, graphRect.bottom + tooltipOffset)
-         const distAbove = Math.abs(maxTopAbove + tooltipHeight - graphRect.top)
-         const distBelow = Math.abs(maxTopBelow - graphRect.bottom)
-         top = distAbove &lt; distBelow ? maxTopAbove : maxTopBelow
+       // 画面下端を超える場合は、画面内に収まるように上にシフト
+       if (top + tooltipHeight &gt; window.innerHeight - tooltipOffset) {
+         top = window.innerHeight - tooltipHeight - tooltipOffset
+       }
+       
+       // 画面上端を超える場合は、画面上端に合わせる
+       if (top &lt; tooltipOffset) {
+         top = tooltipOffset
        }
        
```

</details>

</tool-use>

---



---


リンターエラーを確認中です。


---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** • Read lints for 1 file</summary>
      
Lint paths:

- `frontend/src/views/TimesheetScreen.vue`

Lint results

Lint errors for `frontend/src/views/TimesheetScreen.vue`


| Message | Range | Severity |
|-------|-------|----------|
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 24:21-24:33 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 24:68-24:80 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 100:17-100:29 | DIAGNOSTIC_SEVERITY_HINT |
| 名前 'employeeInfo' が見つかりませんでした。'getEmployeeInfo' ですか? | 100:60-100:72 | DIAGNOSTIC_SEVERITY_HINT |
| 'from' が宣言されていますが、その値が読み取られることはありません。 | 980:24-980:28 | DIAGNOSTIC_SEVERITY_HINT |
| 'from' が宣言されていますが、その値が読み取られることはありません。 | 998:25-998:29 | DIAGNOSTIC_SEVERITY_HINT |
| 'from' が宣言されていますが、その値が読み取られることはありません。 | 1018:18-1018:22 | DIAGNOSTIC_SEVERITY_HINT |
| 'year' が宣言されていますが、その値が読み取られることはありません。 | 1355:14-1355:18 | DIAGNOSTIC_SEVERITY_HINT |
| 'month' が宣言されていますが、その値が読み取られることはありません。 | 1355:20-1355:25 | DIAGNOSTIC_SEVERITY_HINT |
| 'day' が宣言されていますが、その値が読み取られることはありません。 | 1580:34-1580:37 | DIAGNOSTIC_SEVERITY_HINT |
| 'date' が宣言されていますが、その値が読み取られることはありません。 | 1813:29-1813:33 | DIAGNOSTIC_SEVERITY_HINT |
| 'day' が宣言されていますが、その値が読み取られることはありません。 | 2027:33-2027:36 | DIAGNOSTIC_SEVERITY_HINT |
| 'day' が宣言されていますが、その値が読み取られることはありません。 | 2033:34-2033:37 | DIAGNOSTIC_SEVERITY_HINT |
| 'day' が宣言されていますが、その値が読み取られることはありません。 | 2111:40-2111:43 | DIAGNOSTIC_SEVERITY_HINT |
| 'daysInMonth' が宣言されていますが、その値が読み取られることはありません。 | 2283:13-2283:24 | DIAGNOSTIC_SEVERITY_HINT |


</details>
</tool-use>

---



---


修正を反映しました。グラフツールチップをグラフ要素の真横（同じ高さ）に表示するように変更しました。

## 変更内容

Y方向の位置計算を簡素化し、グラフ要素の上端に合わせるようにしました：

```1976:2003:frontend/src/views/TimesheetScreen.vue
    // グラフツールチップの位置を更新
    updateGraphTooltipPosition(event) {
      if (!this.showTooltip) return
      
      const tooltipOffset = 10
      const tooltipWidth = 280
      const tooltipHeight = 400 // 最大高さを考慮
      
      // グラフ要素の位置を取得
      const graphElement = event.target
      const graphRect = graphElement.getBoundingClientRect()
      
      // X方向の位置決定：デフォルトはグラフ要素の右側に表示
      let left = graphRect.right + tooltipOffset
      
      // 画面右端を超える場合は、グラフ要素の左側に表示
      if (left + tooltipWidth > window.innerWidth - tooltipOffset) {
        left = graphRect.left - tooltipWidth - tooltipOffset
      }
      
      // 画面左端を超える場合は右側に表示（グラフ要素の右側）
      if (left < tooltipOffset) {
        left = graphRect.right + tooltipOffset
        // それでも画面外に出る場合は、画面左端に合わせる
        if (left + tooltipWidth > window.innerWidth - tooltipOffset) {
          left = tooltipOffset
        }
      }
      
      // Y方向の位置決定：グラフ要素の真横（同じ高さ）に表示
      // デフォルトでグラフ要素の上端に合わせる
      let top = graphRect.top
      
      // 画面下端を超える場合は、画面内に収まるように上にシフト
      if (top + tooltipHeight > window.innerHeight - tooltipOffset) {
        top = window.innerHeight - tooltipHeight - tooltipOffset
      }
      
      // 画面上端を超える場合は、画面上端に合わせる
      if (top < tooltipOffset) {
        top = tooltipOffset
      }
      
      this.tooltipStyle = {
        top: `${top}px`,
        left: `${left}px`
      }
    },
```

## 変更点

- 以前: Y方向を上下に自動調整
- 現在: グラフ要素の上端に合わせて真横に表示
- 画面外に出る場合は、画面内に収まるように調整

これで、グラフにカーソルを当てた際にツールチップがグラフ要素の真横（同じ高さ）に表示されます。

---

