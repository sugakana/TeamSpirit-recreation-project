<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 87d5c284-5ce1-4f4f-96f6-1f883d34feaa (2025-12-11 05:59Z) -->

# 法定時間内・外残業フローの現状 (2025-12-11 05:59Z)

_**User (2025-12-11 01:02Z)**_

法定時間内残業と法廷時間外残業のフローについて現状どうなっていますか。

---

_**Agent (model composer-1, mode Agent)**_



---


法定時間内残業と法定時間外残業のフローを確認中。関連コードを検索します。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: frontend/src/views/ReportScreen.vue</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "法定時間内残業と法定時間外残業の処理フロー" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `backend/services/attendanceService.js` | L246-347 |
| `docs/entities/mysql_table_design.sql` | L462-491 |
| `docs/detailed-design/ui/attendance-table-screen.md` | L1132-1172 |
| `docs/detailed-design/ui/attendance-table-screen.md` | L1079-1115 |
| `docs/entities/mysql_table_design.sql` | L115-131 |
| `docs/detailed-design/ui/attendance-table-screen.md` | L1113-1134 |
| `backend/services/attendanceService.js` | L72 |
| `backend/services/clockService.js` | L59-151 |
| `backend/services/attendanceService.js` | L78-238 |
| `docs/entities/mysql_table_design.sql` | L439-465 |
| `docs/detailed-design/ui/home-screen.md` | L395-431 |
| `backend/docs/API_SPECIFICATION.md` | L392-455 |
| `backend/services/attendanceService.js` | L78-246 |
| `docs/entities/mysql_table_design.sql` | L129-144 |

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "法定時間|法廷時間|残業" • 145 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\frontend\src\views\TimesheetScreen.vue` | `<!-- 法廷時間内残業 -->` | L700 |
| `.\frontend\src\views\TimesheetScreen.vue` | `<span class="summary-label-right" style="top: 44px;">法廷時間内残業</span>` | L701 |
| `.\frontend\src\views\TimesheetScreen.vue` | `<!-- 法廷時間外残業 -->` | L703 |
| `.\frontend\src\views\TimesheetScreen.vue` | `<span class="summary-label-right" style="top: 65px;">法廷時間外残業</span>` | L704 |
| `.\frontend\src\views\TimesheetScreen.vue` | `<!-- 法定時間内残業 -->` | L715 |
| `.\frontend\src\views\TimesheetScreen.vue` | `<!-- 法定時間外残業 -->` | L718 |
| `.\backend\services\attendanceService.js` | `// 法定時間内残業・法定時間外残業` | L313 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 40 \| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;法定時間内労働時間 \| 出力 \| \| 文字 \| \| \| \| H:MM \| 表示 \| 活性 \| \| 法定時間内の労働時間（例: 2:41） \|` | L81 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 41 \| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 出力 \| \| 文字 \| \| \| \| H:MM \| 表示 \| 活性 \| \| 法定時間外の残業時間（例: 5:02） \|` | L82 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 47 \| &nbsp;&nbsp;&nbsp;&nbsp;平日の所定内の労働時間、残業時間 \| ラベル \| \| \| \| \| \| \| 表示 \| 活性 \| \| 青色の塗りつぶし \|` | L89 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 53 \| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内残業 \| ラベル \| \| \| \| \| \| \| 表示 \| 活性 \| \| #B0B000（黄緑色）の塗りつぶし \|` | L95 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 54 \| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| ラベル \| \| \| \| \| \| \| 表示 \| 活性 \| \| #E28E1C（オレンジ色）の塗りつぶし \|` | L96 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 63 \| 法定時間内残業 \| 出力 \| \| 文字 \| \| \| \| H:MM \| 表示 \| 活性 \| \| 法定時間内の残業時間（例: 0:00） \|` | L106 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 64 \| 法定時間外残業 \| 出力 \| \| 文字 \| \| \| \| H:MM \| 表示 \| 活性 \| \| 法定時間外の残業時間（例: 0:00） \|` | L107 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 13 \| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;残業時間 \| 小数 \| 正常 \| 0 \| OVERTIME_HOURS \|` | L176 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 30 \| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内残業 \| 文字 \| 正常 \| \| WITHIN_LEGAL_OVERTIME_HOURS \|` | L193 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 31 \| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 文字 \| 正常 \| \| OVER_LEGAL_OVERTIME_HOURS \|` | L194 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内残業 \| 月次サマリーデータ.法定時間内残業をH:MM形式で表示 \| 例: 0:00 \|` | L731 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 月次サマリーデータ.法定時間外残業をH:MM形式で表示 \| 例: 0:00 \|` | L732 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内労働時間 \| 所定労働時間内の労働時間をH:MM形式で表示 \| 例: 2:41 \|` | L762 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 日次勤務データ.残業時間をH:MM形式で表示 \| 例: 5:02 \|` | L763 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;残業時間 \| ATTENDANCE_RECORD.OVERTIME_HOURS \| \|` | L838 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内残業 \| 法定時間内の残業時間 \| H:MM形式（例: 0:00） \|` | L854 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 法定時間外の残業時間 \| H:MM形式（例: 0:00） \|` | L855 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間内残業 \| 法定時間内の残業時間 \| H:MM形式（例: 0:00） \|` | L1005 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;法定時間外残業 \| 法定時間外の残業時間 \| H:MM形式（例: 0:00） \|` | L1006 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `#### 残業時間の計算方法` | L1108 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `フレックスタイム制では、日次と月次の両方で残業を判定します：` | L1109 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- 1日の実労働時間が8時間を超えた場合、その超過分は即座に法定時間外残業として扱う` | L1112 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- 例: 1日10時間勤務 → 法定時間内残業0.5h + 法定時間外残業2h` | L1113 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- ただし、既に日次判定で法定時間外残業としてカウントされた時間は除く` | L1117 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `7. **法定時間内残業**: 所定労働時間（7.5h/日）を超えて法定労働時間（8h/日）以内の残業時間（例: 0:00）` | L1132 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `8. **法定時間外残業**: 1日8時間を超える残業時間 + 清算期間の法定労働時間超過分（例: 0:00）` | L1134 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- 平日の所定内の労働時間、残業時間（青色の塗りつぶし）` | L1459 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- 法定時間内残業（#B0B000 黄緑色の塗りつぶし）` | L1465 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `- 法定時間外残業（#E28E1C オレンジ色の塗りつぶし）` | L1466 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `8. **法定時間内労働時間**: 所定労働時間内の労働時間（例: 2:41）` | L1492 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `9. **法定時間外残業**: 所定労働時間を超えた残業時間（例: 5:02）` | L1493 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 2025-12-05 \| 勤務グラフの時間軸を1-24時から0-48時に修正。グラフ凡例に法定時間内残業（#B0B000 黄緑色）と法定時間外残業（#E28E1C オレンジ色）を明記 \| AI Assistant \|` | L1622 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 2025-12-05 \| 月次サマリー項目の詳細を更新。所定出勤日数、実出勤日数、所定労働時間、過不足時間、法定休日労働、法定時間内残業、法定時間外残業を追加。実出勤日数の定義を「出勤時刻と退勤時刻が両方記録されている日数」に変更。標準勤務時間を9:00-17:30（所定労働7.5時間）に設定。勤務グラフに標準勤務時間帯のグレー表示を追加 \| AI Assistant \|` | L1624 |
| `.\docs\detailed-design\ui\attendance-table-screen.md` | `\| 2025-12-05 \| フレックスタイム制に基づく労働時間管理の詳細を追加。標準勤務時間（9:00-17:30）、最小勤務時間（3時間45分）、清算期間（1ヶ月）、遅刻・早退の扱い（適用しない）を明記。残業時間の計算方法（日次判定と月次判定）を詳細化。欠勤・休暇の扱い、時間外労働の事前申請と承認、割増賃金、深夜勤務時間の課税に関する規定を追加 \| AI Assistant \|` | L1625 |
| `.\backend\controllers\applicationController.js` | `* 残業申請` | L71 |
| `.\backend\controllers\applicationController.js` | `message: '残業申請が完了しました。'` | L88 |
| `.\backend\services\applicationService.js` | `* 残業申請` | L71 |
| `.\backend\routes\attendance.js` | `* 残業申請API` | L194 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `残業申請` | L55 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `<p class="menu-description">残業出勤を申請します。</p>` | L75 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `<!-- 残業申請フォーム -->` | L265 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `<p class="form-description">残業を申請します。</p>` | L279 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `<label>残業時間 <span class="required">*</span></label>` | L299 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `placeholder="残業時間（時間）"` | L304 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `placeholder="残業の理由や備考を入力してください"` | L316 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `// 残業申請フォーム` | L521 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `// 残業申請ボタンが非活性かどうか` | L588 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `overtime: '残業申請',` | L793 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `this.showError('残業時間を入力してください。')` | L988 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `alert('残業申請が完了しました')` | L1011 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `this.showError(data.message \|\| '残業申請に失敗しました')` | L1015 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `console.error('残業申請エラー:', error)` | L1018 |
| `.\frontend\src\components\dialog\AttendanceApplicationDialog.vue` | `this.showError('残業申請中にエラーが発生しました')` | L1019 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `日次確定、休暇申請、休日出勤申請、残業申請、早朝勤務申請、振替申請などの各種申請を行うことができます。` | L6 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 8 \| &nbsp;&nbsp;&nbsp;&nbsp;残業申請 \| ボタン \| \| \| \| \| \| \| 表示 \| 条件付き活性 \| \| 残業申請を行うメニュー項目。対象日が休日（土曜日、日曜日、祝日）かつ休日出勤申請が未申請の場合、非活性（押せない状態）。非活性時はボタンラベルの色が白（rgb(255, 255, 255)）になる \|` | L44 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| \| <残業申請フォーム> \| \| \| \| \| \| \| \| \| \| \| \| \|` | L86 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 41 \| 残業申請フォーム \| フォーム \| \| \| \| \| \| \| 条件付き表示 \| 活性 \| \| 残業申請タブが選択されている場合に表示 \|` | L87 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 42 \| &nbsp;&nbsp;&nbsp;&nbsp;残業説明 \| 出力 \| \| 文字 \| \| \| \| \| 表示 \| 活性 \| \| 残業を申請します。 \|` | L88 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 43 \| &nbsp;&nbsp;&nbsp;&nbsp;期間 \| 入力 \| \| 日付 \| \| \| \| \| 表示 \| 活性 \| \| 残業期間を指定 \|` | L89 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 44 \| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;開始日 \| 入力 \| 日付ピッカー \| 日付 \| \| \| \| YYYY/MM/DD \| 表示 \| 活性 \| \| 残業開始日 \|` | L90 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 45 \| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;終了日 \| 入力 \| 日付ピッカー \| 日付 \| \| \| \| YYYY/MM/DD \| 表示 \| 活性 \| \| 残業終了日 \|` | L91 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 46 \| &nbsp;&nbsp;&nbsp;&nbsp;残業時間 \| 入力 \| \| 時間 \| \| \| \| \| 表示 \| 活性 \| \| 残業時間を指定 \|` | L92 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 47 \| &nbsp;&nbsp;&nbsp;&nbsp;備考 \| 入力 \| テキストエリア \| 文字 \| \| \| \| \| 表示 \| 活性 \| \| 残業申請の備考・理由を入力 \|` | L93 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 48 \| &nbsp;&nbsp;&nbsp;&nbsp;承認申請ボタン \| ボタン \| \| \| \| \| \| \| 表示 \| 活性 \| \| 残業申請を送信する。青色のボタン \|` | L94 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `#### 名称：残業申請承認申請ボタン押下処理、英名：submitOvertimeApplication、処理タイミング：残業申請フォーム.承認申請ボタン.押下` | L292 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- チェック仕様に従い、残業申請の入力チェックを行う。` | L295 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- 【チェック仕様 No.4（残業申請チェック）】` | L296 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `3. 残業申請` | L306 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- API利用仕様に従い、残業申請を行う。` | L307 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- 【API利用仕様 No.6（残業申請API）】` | L308 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;残業申請 \| 「残業申請」ボタンを表示。対象日が休日（土曜日、日曜日、祝日）かつ休日出勤申請が未申請の場合、非活性（押せない状態）にし、ボタンラベルの色を白（rgb(255, 255, 255)）にする \| \|` | L403 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 残業申請フォーム \| 残業申請タブが選択されている場合に表示 \| \|` | L430 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| &nbsp;&nbsp;&nbsp;&nbsp;残業説明 \| 「残業を申請します。」を表示 \| \|` | L431 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- チェック仕様：残業申請チェック` | L480 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 残業時間 \| 必須 \| 残業時間が未入力の場合、エラー \| E_APP_034 \| 残業時間を入力してください。 \|` | L488 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- API仕様名：残業申請API` | L678 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| OVERTIME_HOURS \| 画面項目定義.残業時間 \| リクエストボディ \|` | L687 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- 残業申請時にチェック仕様No.4のチェックを実行` | L697 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- 残業申請` | L856 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `### 残業申請` | L861 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `残業申請は、残業を行う場合の事前申請です。` | L862 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- **残業時間**: 残業時間を指定` | L866 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- **備考**: 残業の理由や備考を入力（任意）` | L867 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `- **残業申請**` | L928 |
| `.\docs\detailed-design\ui\attendance-application-screen.md` | `\| 2025-12-13 \| 休日の場合のボタン制御仕様を追加。対象日が休日（土曜日、日曜日、祝日）かつ休日出勤申請が未申請の場合、日次確定、休暇申請、残業申請、早朝勤務申請のボタンを非活性化し、ボタンラベルの色を白にする仕様を追加 \| AI Assistant \|` | L950 |
| `.\docs\detailed-design\ui\detailed-design-list.md` | `\| 4 \| SCR_TS_020201 \| 勤怠関連申請画面 \| 日次確定、休暇申請、休日出勤申請、残業申請、早朝勤務申請、振替申請 \| [attendance-application-screen.md](./attendance-application-screen.md) \| 作成済み \| 2025-12-08 \|` | L14 |
| `.\docs\entities\README_MySQL.md` | `\| **OVERTIME_HOURS** \| DECIMAL(5,2) \| NULL \| `0` \| 残業時間（時間単位）。実労働時間が所定労働時間を超えた分。例: `0.50`=30分残業 \|` | L213 |
| `.\docs\entities\mysql_table_design.sql` | `-- 【残業時間の区分】` | L116 |
| `.\docs\entities\mysql_table_design.sql` | `-- - WITHIN_LEGAL_OVERTIME_HOURS: 7.5h超〜8h以内の残業` | L117 |
| `.\docs\entities\mysql_table_design.sql` | `-- - OVER_LEGAL_OVERTIME_HOURS: 8h超の残業（即座に法定時間外残業として扱う）` | L118 |
| `.\docs\entities\mysql_table_design.sql` | `OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '残業時間: 実労働時間が所定労働時間を超えた分（時間単位）。例: 0.50=30分残業',` | L131 |
| `.\docs\entities\mysql_table_design.sql` | `WITHIN_LEGAL_OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '法定時間内残業: 1日8時間以内の残業時間（時間単位）。例: 0.50=30分',` | L132 |
| `.\docs\entities\mysql_table_design.sql` | `OVER_LEGAL_OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '法定時間外残業: 1日8時間を超える残業時間（時間単位）。例: 2.00=2時間',` | L133 |
| `.\docs\entities\mysql_table_design.sql` | `-- 000001: 2025-11-25 - 残業1時間（実働8.5時間、所定7.5時間、法定時間内0.5h + 法定時間外0.5h）` | L360 |
| `.\docs\entities\mysql_table_design.sql` | `-- 000001: 2025-11-26 - 残業0.5時間（実働8時間、所定7.5時間、法定時間内0.5h）` | L362 |
| `.\docs\entities\mysql_table_design.sql` | `-- 000002: 2025-11-25 - 残業1.25時間（実働8.75時間、所定7.5時間、法定時間内0.5h + 法定時間外0.75h）` | L366 |
| `.\docs\entities\mysql_table_design.sql` | `-- 【残業時間の計算】` | L455 |
| `.\docs\entities\mysql_table_design.sql` | `-- 1. 日次判定: 1日の実労働時間が8時間を超えた場合、その超過分は即座に法定時間外残業` | L456 |
| `.\docs\entities\mysql_table_design.sql` | `-- 法定時間内残業: 所定労働時間（7.5h）を超えて法定労働時間（8h）以内の残業時間の合計` | L481 |
| `.\docs\entities\mysql_table_design.sql` | `-- 法定時間外残業: 1日8時間を超える残業時間 + 清算期間の法定労働時間超過分の合計` | L484 |
| `.\figma-plugin\figma-json-split\forms\forms.html` | `<!-- 残業申請 -->` | L94 |
| `.\figma-plugin\figma-json-split\forms\forms.html` | `<span style="position: absolute; left: 33px; top: 227px; width: 60px; height: 19px; font-size: 14.159px; font-family: Arial, sans-serif; color: rgb(0, 0, 0); text-align: left;">残業申請</span>` | L95 |
| `.\figma-plugin\figma-json-split\forms\forms.html` | `<!-- 残業出勤を申請します。 -->` | L112 |
| `.\figma-plugin\figma-json-split\forms\forms.html` | `<span style="position: absolute; left: 247px; top: 227px; width: 292px; height: 19px; font-size: 14.159px; font-family: Arial, sans-serif; color: rgb(0, 0, 0); text-align: left;">残業出勤を申請します。</span>` | L113 |
| `.\figma-plugin\figma-json-split\forms.json` | `"name": "残業申請",` | L583 |
| `.\figma-plugin\figma-json-split\forms.json` | `"text": "残業申請",` | L605 |
| `.\figma-plugin\figma-json-split\forms.json` | `"name": "残業出勤を申請します。",` | L795 |
| `.\figma-plugin\figma-json-split\forms.json` | `"text": "残業出勤を申請します。",` | L817 |
| `.\figma-plugin\figma-json-split\bottom\bottom.html` | `<!-- 法廷時間内残業 -->` | L69 |
| `.\figma-plugin\figma-json-split\bottom\bottom.html` | `<span style="position: absolute; left: 14px; top: 44px; width: 87px; font-size: 11.87px; font-family: Arial; color: rgb(128, 145, 183); white-space: nowrap;">法廷時間内残業</span>` | L70 |
| `.\figma-plugin\figma-json-split\bottom\bottom.html` | `<!-- 法廷時間外残業 -->` | L72 |
| `.\figma-plugin\figma-json-split\bottom\bottom.html` | `<span style="position: absolute; left: 14px; top: 65px; width: 91px; font-size: 11.87px; font-family: Arial; color: rgb(128, 145, 183); white-space: nowrap;">法廷時間外残業</span>` | L73 |
| `.\figma-plugin\figma-json-split\bottom\bottom-split\bottom-root.json` | `"name": "法廷時間内残業",` | L128 |
| `.\figma-plugin\figma-json-split\bottom\bottom-split\bottom-root.json` | `"text": "法廷時間内残業",` | L150 |
| `.\figma-plugin\figma-json-split\bottom\bottom-split\bottom-root.json` | `"name": "法廷時間外残業",` | L168 |
| `.\figma-plugin\figma-json-split\bottom\bottom-split\bottom-root.json` | `"text": "法廷時間外残業",` | L190 |
| `.\figma-plugin\figma-json-split\bottom.json` | `"name": "法廷時間内残業",` | L127 |
| `.\figma-plugin\figma-json-split\bottom.json` | `"text": "法廷時間内残業",` | L149 |
| `.\figma-plugin\figma-json-split\bottom.json` | `"name": "法廷時間外残業",` | L167 |
| `.\figma-plugin\figma-json-split\bottom.json` | `"text": "法廷時間外残業",` | L189 |
| `.\figma-plugin\figma-json-split\teamspirit-calendar-1.json` | `"name": "法廷時間内残業",` | L18954 |
| `.\figma-plugin\figma-json-split\teamspirit-calendar-1.json` | `"text": "法廷時間内残業",` | L18976 |
| `.\figma-plugin\figma-json-split\teamspirit-calendar-1.json` | `"name": "法廷時間外残業",` | L18994 |
| `.\figma-plugin\figma-json-split\teamspirit-calendar-1.json` | `"text": "法廷時間外残業",` | L19016 |
| `.\frontend\ATTENDANCE_SHEET_GUIDE.md` | `- 残業時間` | L65 |
| `.\feture_list\TeamSpirit機能一覧.md` | `\| 43 \| 勤務表 \| 画面 \| SCR_TS_0208 \| UI表示サマリー \| DisplaySummary \| N/A \| N/A \| SCR_TS_020601 \| サマリー（下部） \| Summary \| 従業員 \| 勤務表下部に表示される集計情報 \| 初期表示 \| 月間の勤務時間集計、残業時間、休暇日数などを表示 \|` | L47 |
| `.\feture_list\TeamSpirit機能一覧.md` | `\| 44 \| 勤務表 \| 画面 \| SCR_TS_0209 \| 勤務関連申請 \| AttendanceApplication \| N/A \| N/A \| SCR_TS_020701 \| 申請 \| Application \| 従業員 \| 各種勤務に関する申請機能 \| 申請_押下 \| 残業申請、振替休日申請などの申請処理を行う \|` | L48 |
| `.\feture_list\TeamSpirit機能一覧.md` | `\| 76 \| 勤務表 \| 画面 \| SCR_TS_0214 \| 月次サマリー表示 \| MonthlySummaryDisplay \| N/A \| N/A \| SCR_TS_021101 \| 月次サマリー画面 \| MonthlySummaryDialog \| 従業員 \| 月間の勤務情報の集計表示 \| 初期表示 \| 月間勤務時間、残業時間、深夜時間などの詳細集計を表示 \|` | L80 |
| `.\feture_list\TeamSpirit機能一覧.md` | `\| 79 \| 勤務表 \| 画面 \| SCR_TS_0214 \| 月次サマリー表示 \| MonthlySummaryDisplay \| N/A \| N/A \| SCR_TS_021101 \| 月次サマリー画面 \| MonthlySummaryDialog \| 従業員 \| 月間の勤務情報の集計表示 \| 残業時間集計_表示 \| 残業時間、深夜残業時間、休日勤務時間などを表示 \|` | L83 |
| `.\feture_list\TeamSpirit機能一覧.md` | `\| 128 \| 勤務表 \| API \| API_TS_0212 \| 月次サマリー取得 \| GetMonthlySummary \| N/A \| N/A \| N/A \| N/A \| N/A \| 従業員 \| 指定年月の月次サマリーを取得する \| GET /api/attendance/monthly-summary \| リクエストにEMPLOYEE_ID、YEAR、MONTHを受け取り、V_MONTHLY_ATTENDANCEビューから月間の勤務時間集計、残業時間、深夜時間、休日勤務時間などを取得 \|` | L132 |
| `.\SVGファイル\teamspirit-monthly-report.svg` | `<text x="620" y="113" font-family="Arial, sans-serif" font-size="11" fill="#fff" font-weight="bold" text-anchor="middle">残業</text>` | L65 |
| `.\SVGファイル\teamspirit-monthly-report.svg` | `<text x="20" y="1180" font-family="Arial, sans-serif" font-size="11" fill="#666">※定額残業時間：●□△▽時間3日　●～□▽▽時間4日　△～時間□時間時日□日</text>` | L448 |
| `.\SVGファイル\teamspirit-monthly-summary.svg` | `<text x="20" y="495" font-family="Arial, sans-serif" font-size="12" fill="#666">※定額残業時間：●□△▽時間3日　●～□▽▽時間4日　△～時間□時間時日□日</text>` | L195 |
| `.\SVGファイル\teamspirit-calendar-full-fixed.svg` | `<text x="270" y="865" font-family="Arial, sans-serif" font-size="11" fill="#0070d2" text-decoration="underline">法定外時間外残業</text>` | L454 |
| `.\SVGファイル\teamspirit-calendar-full.svg` | `<text x="270" y="805" font-family="Arial, sans-serif" font-size="11" fill="#0070d2" text-decoration="underline">法定外時間外残業</text>` | L392 |
| `.\SVGファイル\teamspirit-work-report-dialog.svg` | `<text x="110" y="267" font-family="Arial, sans-serif" font-size="12" fill="#333">残業申請</text>` | L36 |
| `.\SVGファイル\teamspirit-work-report-dialog.svg` | `<text x="220" y="267" font-family="Arial, sans-serif" font-size="12" fill="#666">残業を申請します。</text>` | L37 |
| `.\SVGファイル\teamspirit-calendar.svg` | `<text x="1250" y="518" font-family="Arial, sans-serif" font-size="11" fill="#6ba5d2">法定内残業</text>` | L176 |


</details>
</tool-use>

---



---


関連コードとドキュメントを確認中。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/services/attendanceService.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/entities/mysql_table_design.sql</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: docs/detailed-design/ui/attendance-table-screen.md</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "WITHIN_LEGAL_OVERTIME_HOURSとOVER_LEGAL_OVERTIME_HOURSの計算処理" • **12** results</summary>
            
| File | Lines |
|------|-------|
| `docs/entities/mysql_table_design.sql` | L462-491 |
| `backend/services/attendanceService.js` | L246-347 |
| `docs/entities/mysql_table_design.sql` | L129-144 |
| `docs/entities/mysql_table_design.sql` | L115-131 |
| `backend/services/masterService.js` | L27-69 |
| `backend/services/attendanceService.js` | L72 |
| `backend/services/applicationService.js` | L53-95 |
| `docs/entities/mysql_table_design.sql` | L80-118 |
| `docs/entities/mysql_table_design.sql` | L439-465 |
| `backend/services/attendanceService.js` | L78-246 |
| `docs/entities/mysql_table_design.sql` | L489-551 |
| `backend/services/attendanceService.js` | L79-347 |

</details>
</tool-use>

---



---


データベースへの保存処理を確認中。


---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "WITHIN_LEGAL_OVERTIME_HOURS|OVER_LEGAL_OVERTIME_HOURS" in "backend" • 2 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `backend\services\masterService.js` | `withinLegalOvertime: formatHours(summary.WITHIN_LEGAL_OVERTIME_HOURS),` | L62 |
| `backend\services\masterService.js` | `overLegalOvertime: formatHours(summary.OVER_LEGAL_OVERTIME_HOURS)` | L63 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">
<details>
                <summary>Tool use: **codebase_search** • Searched codebase "ATTENDANCE_RECORDテーブルにWITHIN_LEGAL_OVERTIME_HOURSとOVER_LEGAL_OVERTIME_HOURSを保存する処理" • **14** results</summary>
            
| File | Lines |
|------|-------|
| `docs/entities/mysql_table_design.sql` | L115-131 |
| `docs/entities/mysql_table_design.sql` | L129-144 |
| `docs/entities/mysql_table_design.sql` | L462-491 |
| `backend/models/attendanceModel.js` | L59-136 |
| `backend/services/attendanceService.js` | L78-238 |
| `docs/entities/mysql_table_design.sql` | L80-118 |
| `backend/models/attendanceModel.js` | L95-198 |
| `docs/entities/er-diagram.md` | L59-140 |
| `backend/services/attendanceService.js` | L246-347 |
| `backend/services/attendanceService.js` | L26-238 |
| `backend/models/workHoursModel.js` | L39-96 |
| `backend/services/attendanceService.js` | L78-246 |
| `docs/entities/README_MySQL.md` | L191-212 |
| `backend/services/workHoursService.js` | L12-67 |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/services/clockService.js</summary>

</details>
</tool-use>

---



---


実労働時間の計算処理を確認中。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/services/workHoursService.js</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** • Grep for "ACTUAL_WORK_HOURS|calculateWorkHours" in "backend" • 6 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `backend\services\attendanceService.js` | `.reduce((sum, row) => sum + (parseFloat(row.ACTUAL_WORK_HOURS) \|\| 0), 0);` | L303 |
| `backend\services\attendanceService.js` | `const actualHours = parseFloat(row.ACTUAL_WORK_HOURS) \|\| 0;` | L318 |
| `backend\services\attendanceService.js` | `const actualWorkHours = parseFloat(attendance.ACTUAL_WORK_HOURS) \|\| 0;` | L379 |
| `backend\models\attendanceModel.js` | `ACTUAL_WORK_HOURS,` | L41 |
| `backend\models\attendanceModel.js` | `ar.ACTUAL_WORK_HOURS,` | L72 |
| `backend\models\attendanceModel.js` | `updateFields.push('ACTUAL_WORK_HOURS = ?');` | L167 |


</details>
</tool-use>

---



---


実労働時間の計算処理を確認中。


---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** • Read file: backend/services/attendanceService.js</summary>

</details>
</tool-use>

---



---


## 現状のフロー

### 1. **データベース設計**
`ATTENDANCE_RECORD`テーブルに以下のカラムが定義されています：
- `WITHIN_LEGAL_OVERTIME_HOURS`: 法定時間内残業（7.5h超〜8h以内）
- `OVER_LEGAL_OVERTIME_HOURS`: 法定時間外残業（8h超）

```116:133:docs/entities/mysql_table_design.sql
-- 【残業時間の区分】
-- - WITHIN_LEGAL_OVERTIME_HOURS: 7.5h超〜8h以内の残業
-- - OVER_LEGAL_OVERTIME_HOURS: 8h超の残業（即座に法定時間外残業として扱う）
-- - 割増賃金: 所定の割増率に基づき算定
CREATE TABLE ATTENDANCE_RECORD (
    ATTENDANCE_ID BIGINT AUTO_INCREMENT NOT NULL COMMENT '勤怠ID: 主キー。勤怠記録を一意に識別するID（自動採番）',
    EMPLOYEE_ID VARCHAR(50) NOT NULL COMMENT '従業員ID: 外部キー。どの従業員の勤怠記録か。EMPLOYEEテーブルを参照',
    WORK_DATE DATE NOT NULL COMMENT '勤務日: どの日の勤怠記録か。形式YYYY-MM-DD。従業員IDと勤務日の組み合わせでユニーク',
    CLOCK_IN_TIME DATETIME COMMENT '出勤時刻: WEBタイムレコーダーで打刻した時刻、または手入力した時刻。形式YYYY-MM-DD HH:MM:SS',
    CLOCK_OUT_TIME DATETIME COMMENT '退勤時刻: WEBタイムレコーダーで打刻した時刻、または手入力した時刻。形式YYYY-MM-DD HH:MM:SS',
    CLOCK_IN_TYPE VARCHAR(20) COMMENT '出勤打刻種別: STAMP=打刻、MANUAL=手入力、SCHEDULED=定時出勤。画面で背景色を変えるために使用',
    CLOCK_OUT_TYPE VARCHAR(20) COMMENT '退勤打刻種別: STAMP=打刻、MANUAL=手入力、SCHEDULED=定時退勤。画面で背景色を変えるために使用',
    WORK_LOCATION_CODE VARCHAR(20) COMMENT '勤務場所コード: 外部キー。COMMUTE=通勤、REMOTE=在宅など。WORK_LOCATIONテーブルを参照。日次確定申請には必須',
    ACTUAL_WORK_HOURS DECIMAL(5,2) COMMENT '実労働時間: 出退勤時刻と休憩時間から自動計算される実際の労働時間（時間単位）。例: 8.50=8時間30分',
    SCHEDULED_WORK_HOURS DECIMAL(5,2) DEFAULT 7.50 COMMENT '所定労働時間: 標準勤務時間（9:00-17:30）から休憩1時間を除いた7.5時間。例: 7.50=7時間30分',
    OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '残業時間: 実労働時間が所定労働時間を超えた分（時間単位）。例: 0.50=30分残業',
    WITHIN_LEGAL_OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '法定時間内残業: 1日8時間以内の残業時間（時間単位）。例: 0.50=30分',
    OVER_LEGAL_OVERTIME_HOURS DECIMAL(5,2) DEFAULT 0 COMMENT '法定時間外残業: 1日8時間を超える残業時間（時間単位）。例: 2.00=2時間',
```

### 2. **計算ロジック（月次サマリー表示用）**
`backend/services/attendanceService.js`の`getMonthlyAttendance`で、月次サマリー表示用に計算しています：

```313:326:backend/services/attendanceService.js
  // 法定時間内残業・法定時間外残業
  let withinLegalOvertime = 0;
  let overLegalOvertime = 0;
  for (const row of attendanceRows) {
    if (normalizeDate(row.WORK_DATE) <= cutoffDate) {
      const actualHours = parseFloat(row.ACTUAL_WORK_HOURS) || 0;
      if (actualHours > 7.5 && actualHours <= 8) {
        withinLegalOvertime += actualHours - 7.5;
      } else if (actualHours > 8) {
        withinLegalOvertime += 0.5;
        overLegalOvertime += actualHours - 8;
      }
    }
  }
```

計算ルール：
- 実労働時間が7.5h超8h以内 → 法定時間内残業 = 実労働時間 - 7.5h
- 実労働時間が8h超 → 法定時間内残業 = 0.5h、法定時間外残業 = 実労働時間 - 8h

### 3. **問題点：日次レコードへの保存処理が未実装**
`updateAttendanceRecord`では実労働時間（`ACTUAL_WORK_HOURS`）は計算・保存していますが、`WITHIN_LEGAL_OVERTIME_HOURS`と`OVER_LEGAL_OVERTIME_HOURS`の計算・保存は行われていません：

```216:226:backend/services/attendanceService.js
    // 実労働時間を計算
    if (clockInDateTime && clockOutDateTime) {
      const totalMinutes = calculateMinutes(clockInDateTime, clockOutDateTime);
      const breakMinutes = await breakTimeModel.getTotalBreakMinutes(currentAttendanceId);
      const actualWorkHours = (totalMinutes - breakMinutes) / 60;
      
      await attendanceModel.updateAttendance(currentAttendanceId, {
        actualWorkHours: actualWorkHours.toFixed(2),
        updatedAt: now
      });
    }
```

### 4. **VIEWでの集計**
`V_MONTHLY_ATTENDANCE`ビューは`WITHIN_LEGAL_OVERTIME_HOURS`と`OVER_LEGAL_OVERTIME_HOURS`を集計していますが、日次レコードに値が保存されていないため、常に0になります。

## まとめ

- データベース設計: カラムは定義済み
- 計算ロジック: 月次サマリー表示用に実装済み
- 日次レコードへの保存: 未実装（実労働時間の計算・保存時に、法定時間内/時間外残業も計算・保存する処理が必要）

現状は月次サマリー表示時に都度計算しており、日次レコードには保存されていません。

---

