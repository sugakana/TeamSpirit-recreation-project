# TeamSpirit勤怠管理システム
# 勤怠情報入力画面

## 概要
本画面は、勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下すると表示されるダイアログ形式の入力画面です。
出社時刻、退社時刻、休憩時間、公用外出時間、勤務場所を手入力で入力・変更することができます。
出社時刻・退社時刻を手入力で入力して登録すると、勤務表画面の該当箇所の背景色が黄色に変更されます。（勤務場所は背景色変更の対象外）
また、日次確定チェックボックスをONにして登録すると、日次確定申請が同時に行われます。
日次確定後に承認中となった場合は、本画面は閲覧専用モードとなり編集ができなくなります。

## 画面レイアウト

### 参考画像

- 編集可能状態（初期画面）
  - （提供された画像1枚目を参照）

- 閲覧専用状態（承認中）
  - （提供された画像2枚目を参照）

## 画面項目定義

| No | 項目名 | 種別 | 入力タイプ | ドメイン | 最小桁数 | 最大桁数 | 表示文字数 | 表示形式 | 表示/非表示 | 活性/非活性 | 初期値 | 備考 |
| :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- |
| | <ヘッダー部分> | | | | | | | | | | | |
| 1 | タイトル | 出力 | | 文字 | | | | | 表示 | 活性 | 勤怠情報入力 | ダイアログのタイトル「勤怠情報入力」を表示 |
| 2 | 閉じるボタン | ボタン | | | | | | | 表示 | 活性 | | ダイアログを閉じる。「X」アイコン |
| 3 | 日付表示 | 出力 | | 文字 | | | | YYYY年MM月DD日X曜日 | 表示 | 活性 | | 対象日の日付を表示（例: 2025年11月26日水曜日） |
| | <入力エリア> | | | | | | | | | | | |
| 4 | 出社ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 出社 | 出社時刻入力欄のラベル |
| 5 | 出社時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 出社時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 5-1 | 出社打刻時刻表示 | 出力 | | 文字 | | | | 打刻 (H:MM) | 条件付き表示 | 活性 | | 出社時刻が手入力で変更された場合、テキストボックスの横に「打刻 (打刻時間)」を表示。元の打刻時刻（ORIGINAL_CLOCK_IN_TIME）を表示 |
| 6 | 退社ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 退社 | 退社時刻入力欄のラベル |
| 7 | 退社時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 退社時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 7-1 | 退社打刻時刻表示 | 出力 | | 文字 | | | | 打刻 (H:MM) | 条件付き表示 | 活性 | | 退社時刻が手入力で変更された場合、テキストボックスの横に「打刻 (打刻時間)」を表示。元の打刻時刻（ORIGINAL_CLOCK_OUT_TIME）を表示 |
| 8 | 休憩1ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 休憩1 | 休憩1入力欄のラベル |
| 9 | 休憩1開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩1の開始時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 10 | 休憩1チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 休憩時間の開始と終了の区切り文字 |
| 11 | 休憩1終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩1の終了時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 12 | 休憩2ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 休憩2 | 休憩2入力欄のラベル |
| 13 | 休憩2開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩2の開始時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 14 | 休憩2チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 休憩時間の開始と終了の区切り文字 |
| 15 | 休憩2終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 休憩2の終了時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 16 | 休憩追加ボタン | ボタン | | | | | | | 条件付き表示 | 条件付き活性 | | 休憩時間枠を追加する。「+」アイコン。承認中の場合は非表示。休憩が10個に達している場合は非活性 |
| 17 | 公用外出1ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 公用外出1 | 公用外出1入力欄のラベル |
| 18 | 公用外出1開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出1の開始時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 19 | 公用外出1チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 公用外出時間の開始と終了の区切り文字 |
| 20 | 公用外出1終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出1の終了時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 21 | 公用外出2ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 公用外出2 | 公用外出2入力欄のラベル |
| 22 | 公用外出2開始時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出2の開始時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 23 | 公用外出2チルダ | ラベル | | 文字 | | | | | 表示 | 活性 | ～ | 公用外出時間の開始と終了の区切り文字 |
| 24 | 公用外出2終了時刻 | 入力 | テキストボックス | 時間 | | 5 | 5 | H:MM | 表示 | 条件付き活性 | | 公用外出2の終了時刻を入力。承認中・申請中の場合はグレー表示。プレースホルダーは表示しない |
| 25 | 公用外出追加ボタン | ボタン | | | | | | | 条件付き表示 | 条件付き活性 | | 公用外出時間枠を追加する。「+」アイコン。承認中の場合は非表示。公用外出が5個に達している場合は非活性 |
| 26 | 勤務場所ラベル | ラベル | | 文字 | | | | | 表示 | 活性 | 勤務場所 | 勤務場所入力欄のラベル |
| 27 | 勤務場所 | 入力 | プルダウン | 文字 | | | | | 表示 | 条件付き活性 | 通勤 | 勤務場所を選択（通勤、在宅など）。承認中・申請中の場合はグレー表示。デフォルト選択肢（「選択してください」）は表示しない |
| 28 | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所選択肢一覧 | 出力 | | リスト | | | | | 表示 | 活性 | | プルダウンで選択可能な勤務場所の一覧 |
| 29 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;勤務場所名 | 出力 | | 文字 | | | | | 表示 | 活性 | | 各勤務場所の名称（通勤、在宅など） |
| | <操作ボタンエリア（編集可能時）> | | | | | | | | | | | |
| 30 | 登録ボタン | ボタン | | | | | | | 条件付き表示 | 活性 | | 入力内容を登録する。青色のボタン。承認中の場合は非表示 |
| 31 | キャンセルリンク | リンク | | | | | | | 条件付き表示 | 活性 | | 入力をキャンセルしてダイアログを閉じる。承認中の場合は非表示 |
| 32 | リセットボタン | ボタン | | | | | | | 条件付き表示 | 活性 | | 入力内容を初期状態にリセットする。ピンク色のボタン。承認中の場合は非表示 |
| | <日次確定エリア> | | | | | | | | | | | |
| 33 | 日次確定するチェックボックス | 入力 | チェックボックス | フラグ | | | | | 条件付き表示 | 条件付き活性 | OFF | 登録と同時に日次確定申請を行う場合にON。承認中の場合は非表示。対象日が休日（土曜日、日曜日、祝日）かつ休日出勤申請が未申請の場合、または出社と退社の両方の打刻時刻が未入力の場合、または出社の打刻時刻は入力されているが退社の打刻時刻が未入力の場合、非活性（チェックできない状態） |
| 34 | 日次確定するラベル | ラベル | | 文字 | | | | | 条件付き表示 | 活性 | 日次確定する | 日次確定チェックボックスのラベル。承認中の場合は非表示 |
| | <操作ボタンエリア（閲覧専用時）> | | | | | | | | | | | |
| 35 | 閉じるリンク | リンク | | | | | | | 条件付き表示 | 活性 | | ダイアログを閉じる。承認中の場合のみ表示 |
| | <エラーメッセージ表示エリア> | | | | | | | | | | | |
| 36 | エラーメッセージ表示エリア | 出力 | | 文字 | | | | | 条件付き表示 | 活性 | | グレーの四角形の左下にエラーメッセージを表示。エラーがある場合のみ表示 |
| | <エラーダイアログ> | | | | | | | | | | | |
| 37 | エラーダイアログ | ダイアログ | | | | | | | 条件付き表示 | 活性 | | 日次確定チェック時のエラー時に表示 |
| 38 | &nbsp;&nbsp;&nbsp;&nbsp;タイトル | ラベル | | 文字 | | | | | 表示 | 活性 | エラー | ダイアログのタイトル |
| 39 | &nbsp;&nbsp;&nbsp;&nbsp;エラーメッセージ | 出力 | | 文字 | | | | | 表示 | 活性 | | エラーの内容を表示（例：「工数実績が入力されていません」） |
| 40 | &nbsp;&nbsp;&nbsp;&nbsp;OKボタン | ボタン | | | | | | | 表示 | 活性 | | ダイアログを閉じる |

## 入出力項目定義

| No | 項目名 | 種別 | 画面遷移 | ドメイン | 必須 | デフォルト値 | 備考 |
| :----- | :----- | :----- | :----- | :----- | :----- | :----- | :----- |
| 1 | 従業員ID | 入力 | 勤務表画面 | 文字 | 必須 | | ログイン中の従業員ID |
| 2 | 対象日付 | 入力 | 勤務表画面 | 日付 | 必須 | | 編集対象の日付（YYYY-MM-DD形式） |
| 3 | 初期フォーカス項目 | 入力 | 勤務表画面 | 文字 | 任意 | | ダイアログ表示時にフォーカスを当てる項目（出社/退社/勤務場所）。押下された項目に応じて設定 |
| 4 | 承認状態 | 入力 | 勤務表画面 | 文字 | 必須 | | 対象日の承認状態（NONE/PENDING/APPROVED/REJECTED） |
| 9 | 初期データ | 入力 | 勤務表画面 | オブジェクト | 任意 | | 勤務表画面から渡される既存データ（出社時刻、退社時刻、勤務場所など）。ダイアログ表示時に初期値として設定される |
| 5 | 更新完了フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 登録ボタン押下で更新が完了した場合にTRUE |
| 6 | 手入力フラグ | 出力 | 勤務表画面 | オブジェクト | 必須 | | 手入力で変更された項目を示すフラグ（出社・退社のみ対象。勤務場所は背景色変更対象外） |
| 7 | &nbsp;&nbsp;&nbsp;&nbsp;出社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 出社時刻が手入力で変更された場合にTRUE |
| 8 | &nbsp;&nbsp;&nbsp;&nbsp;退社手入力フラグ | 出力 | 勤務表画面 | フラグ | 必須 | FALSE | 退社時刻が手入力で変更された場合にTRUE |

## その他の項目定義

| No | 項目名 | ドメイン | 正常異常区分 | デフォルト値 | 備考 |
| :----- | :----- | :----- | :----- | :----- | :----- |
| 1 | 日次勤務データ | オブジェクト | 正常 | | 対象日付の勤務データ |
| 2 | &nbsp;&nbsp;&nbsp;&nbsp;勤怠ID | 文字 | 正常 | | ATTENDANCE_RECORD.ATTENDANCE_ID |
| 3 | &nbsp;&nbsp;&nbsp;&nbsp;出勤時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.CLOCK_IN_TIME |
| 4 | &nbsp;&nbsp;&nbsp;&nbsp;退勤時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.CLOCK_OUT_TIME |
| 5 | &nbsp;&nbsp;&nbsp;&nbsp;出勤打刻時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME（打刻機による元の時刻） |
| 6 | &nbsp;&nbsp;&nbsp;&nbsp;退勤打刻時刻 | 時間 | 正常 | | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME（打刻機による元の時刻） |
| 7 | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所コード | 文字 | 正常 | | ATTENDANCE_RECORD.WORK_LOCATION_CODE |
| 8 | &nbsp;&nbsp;&nbsp;&nbsp;出勤手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL |
| 9 | &nbsp;&nbsp;&nbsp;&nbsp;退勤手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL |
| 10 | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所手入力フラグ | フラグ | 正常 | FALSE | ATTENDANCE_RECORD.IS_LOCATION_MANUAL |
| 11 | 休憩時間リスト | リスト | 正常 | | BREAK_TIMEテーブルから取得 |
| 12 | &nbsp;&nbsp;&nbsp;&nbsp;休憩時間情報 | オブジェクト | 正常 | | 1つの休憩時間の情報 |
| 13 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩ID | 文字 | 正常 | | BREAK_TIME.BREAK_ID |
| 14 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩開始時刻 | 時間 | 正常 | | BREAK_TIME.BREAK_START_TIME |
| 15 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩終了時刻 | 時間 | 正常 | | BREAK_TIME.BREAK_END_TIME |
| 16 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩種別 | 文字 | 正常 | | BREAK_TIME.BREAK_TYPE（BREAK:休憩、OFFICIAL_OUTING:公用外出） |
| 17 | 勤務場所マスタ | リスト | 正常 | | WORK_LOCATIONテーブルから取得した勤務場所マスタ |
| 18 | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所情報 | オブジェクト | 正常 | | 1つの勤務場所の情報 |
| 19 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;勤務場所コード | 文字 | 正常 | | WORK_LOCATION.WORK_LOCATION_CODE |
| 20 | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;勤務場所名 | 文字 | 正常 | | WORK_LOCATION.WORK_LOCATION_NAME |
| 21 | 閲覧専用モード | フラグ | 共通 | FALSE | 承認中の場合はTRUE |
| 22 | 入力変更フラグ | オブジェクト | 正常 | | 各項目の変更状態を管理（背景色変更対象は出社・退社のみ） |
| 23 | &nbsp;&nbsp;&nbsp;&nbsp;出社変更フラグ | フラグ | 正常 | FALSE | 出社時刻が変更された場合にTRUE。背景色変更対象 |
| 24 | &nbsp;&nbsp;&nbsp;&nbsp;退社変更フラグ | フラグ | 正常 | FALSE | 退社時刻が変更された場合にTRUE。背景色変更対象 |
| 25 | 工数実績合計 | 小数 | 正常 | | 対象日付の工数実績の合計時間。日次確定時のチェックに使用 |
| 26 | 実労働時間 | 小数 | 正常 | | 対象日付の実労働時間。日次確定時のチェックに使用 |
| 27 | エラーメッセージ | 文字 | 異常 | | エラー時に表示するメッセージ |
| 28 | 休憩最大数 | 整数 | 正常 | 10 | 休憩時間枠の最大数。上限に達すると休憩追加ボタンが非活性になる |
| 29 | 公用外出最大数 | 整数 | 正常 | 5 | 公用外出時間枠の最大数。上限に達すると公用外出追加ボタンが非活性になる |
| 30 | 休憩1デフォルト開始時刻 | 時間 | 正常 | 12:00 | 休憩1のデフォルト開始時刻。既に入力されているものとして扱う |
| 31 | 休憩1デフォルト終了時刻 | 時間 | 正常 | 13:00 | 休憩1のデフォルト終了時刻。既に入力されているものとして扱う |

## イベント処理説明

#### 名称：初期表示処理、英名：initializeDialog、処理タイミング：-

1. 閲覧専用モード判定
   - 入出力項目定義.承認状態がPENDINGの場合、閲覧専用モードをTRUEに設定する。

2. 勤務場所マスタ取得
   - API利用仕様に従い、勤務場所マスタを取得する。
   - 【API利用仕様 No.1（勤務場所マスタ取得API）】

3. 初期データ設定
   - 入出力項目定義.初期データが指定されている場合、フォームに初期値を設定する。
   - 出社時刻、退社時刻、勤務場所を初期データから設定する。
   - これにより、勤務表画面で既に入力されているデータが初期表示として表示される。

4. 日次勤務データ取得
   - API利用仕様に従い、対象日付の勤務データを取得する。
   - 【API利用仕様 No.2（日次勤務データ取得API）】
   - APIから取得したデータで初期データを上書きする。

5. 休憩1デフォルト値設定
   - 日次勤務データに休憩時間が存在しない場合、または休憩時間リストに休憩種別がBREAKのレコードが存在しない場合、休憩1にデフォルト値を設定する。
   - 休憩1開始時刻: その他の項目定義.休憩1デフォルト開始時刻（12:00）
   - 休憩1終了時刻: その他の項目定義.休憩1デフォルト終了時刻（13:00）
   - 休憩種別: BREAK
   - これにより、休憩1は12:00~13:00が既に入力されているものとして表示される。

6. 画面表示
   - 編集仕様に従い、画面を表示する。
   - 【編集仕様 No.1（初期画面表示）】

7. フォーカス設定
   - 入出力項目定義.初期フォーカス項目が指定されている場合、該当項目にフォーカスを設定する。

#### 名称：出社時刻変更処理、英名：onClockInChange、処理タイミング：入力エリア.出社時刻.変更

1. 変更フラグ更新
   - 入力変更フラグ.出社変更フラグをTRUEに設定する。

2. 手入力判定
   - 日次勤務データ.出勤打刻時刻と異なる値が入力された場合、出勤手入力フラグをTRUEに設定する。

#### 名称：退社時刻変更処理、英名：onClockOutChange、処理タイミング：入力エリア.退社時刻.変更

1. 変更フラグ更新
   - 入力変更フラグ.退社変更フラグをTRUEに設定する。

2. 手入力判定
   - 日次勤務データ.退勤打刻時刻と異なる値が入力された場合、退勤手入力フラグをTRUEに設定する。

#### 名称：勤務場所変更処理、英名：onWorkLocationChange、処理タイミング：入力エリア.勤務場所.変更

1. 勤務場所更新
   - 選択された勤務場所コードを設定する。
   - ※勤務場所は背景色変更の対象外のため、手入力フラグは設定しない。

#### 名称：休憩追加ボタン押下処理、英名：onAddBreakClick、処理タイミング：入力エリア.休憩追加ボタン.押下

1. 上限チェック
   - 休憩時間リストのうち、休憩種別が「BREAK」のレコード数をカウントする。
   - その他の項目定義.休憩最大数（10個）に達している場合、処理を終了する。

2. 休憩時間枠追加
   - 休憩時間リストに新しい休憩時間枠を追加する。
   - 休憩種別は「BREAK」を設定する。

3. 追加ボタン活性状態更新
   - 休憩時間リストのうち、休憩種別が「BREAK」のレコード数がその他の項目定義.休憩最大数（10個）に達した場合、休憩追加ボタンを非活性にする。

#### 名称：公用外出追加ボタン押下処理、英名：onAddOfficialOutingClick、処理タイミング：入力エリア.公用外出追加ボタン.押下

1. 上限チェック
   - 休憩時間リストのうち、休憩種別が「OFFICIAL_OUTING」のレコード数をカウントする。
   - その他の項目定義.公用外出最大数（5個）に達している場合、処理を終了する。

2. 公用外出時間枠追加
   - 休憩時間リストに新しい公用外出時間枠を追加する。
   - 休憩種別は「OFFICIAL_OUTING」を設定する。

3. 追加ボタン活性状態更新
   - 休憩時間リストのうち、休憩種別が「OFFICIAL_OUTING」のレコード数がその他の項目定義.公用外出最大数（5個）に達した場合、公用外出追加ボタンを非活性にする。

#### 名称：登録ボタン押下処理、英名：onRegisterClick、処理タイミング：操作ボタンエリア.登録ボタン.押下

1. 未来日付・勤務当日チェック
   - チェック仕様に従い、未来日付・勤務当日チェックを行う。
   - 【チェック仕様 No.4（未来日付・勤務当日チェック）】
   
   - エラー処理
     1. エラー内容をエラーメッセージ表示エリア（グレーの四角形の左下）に表示させ、処理を終了する。
     - 注意: 勤務場所のみの変更の場合は、未来日付・勤務当日でもエラーを表示しない。

2. 入力チェック
   - チェック仕様に従い、入力チェックを行う。
   - 【チェック仕様 No.1（時刻入力チェック）】
   - 【チェック仕様 No.2（時刻整合性チェック）】
   - 【チェック仕様 No.5（休憩・公用外出入力時の出社・退社時刻チェック）】
   
   - エラー処理
     1. エラー内容をエラーメッセージ表示エリア（グレーの四角形の左下）に表示させ、処理を終了する。

3. 日次確定チェック（日次確定するチェックボックスがONの場合のみ）
   - 画面項目定義.日次確定するチェックボックスがONの場合:
     - チェック仕様に従い、日次確定のための事前チェックを行う。
     - 【チェック仕様 No.3（日次確定事前チェック）】
     
     - エラー処理
       1. エラーダイアログを表示する。
       2. エラーダイアログにはエラーメッセージと「OK」ボタンを表示する。
       3. 「OK」ボタン押下でエラーダイアログを閉じ、処理を終了する。

4. 勤怠データ更新
   - API利用仕様に従い、勤怠データを更新する。
   - 【API利用仕様 No.3（勤怠データ更新API）】

5. 日次確定処理
   - 画面項目定義.日次確定するチェックボックスがONの場合:
     - API利用仕様に従い、日次確定申請を行う。
     - 【API利用仕様 No.4（日次確定申請API）】

6. 出力項目設定
   - 入出力項目定義.更新完了フラグをTRUEに設定する。
   - 入出力項目定義.手入力フラグに各項目の手入力フラグを設定する（出社・退社のみ）。

7. ダイアログ閉じる
   - ダイアログを閉じる。
   - 勤務表画面に戻り、出社・退社を手入力した箇所の背景色が黄色に変更される。

#### 名称：キャンセルリンク押下処理、英名：onCancelClick、処理タイミング：操作ボタンエリア.キャンセルリンク.押下

1. ダイアログ閉じる
   - 入力内容を破棄してダイアログを閉じる。
   - 勤務表画面に戻る。

#### 名称：リセットボタン押下処理、英名：onResetClick、処理タイミング：操作ボタンエリア.リセットボタン.押下

1. 入力内容リセット
   - 編集仕様に従い、入力内容を初期状態にリセットする。
   - 【編集仕様 No.2（入力内容リセット）】

#### 名称：閉じるボタン押下処理、英名：onCloseButtonClick、処理タイミング：ヘッダー部分.閉じるボタン.押下

1. ダイアログ閉じる
   - ダイアログを閉じる。
   - 勤務表画面に戻る。

#### 名称：閉じるリンク押下処理、英名：onCloseLinkClick、処理タイミング：操作ボタンエリア.閉じるリンク.押下

1. ダイアログ閉じる
   - ダイアログを閉じる。
   - 勤務表画面に戻る。

## 編集仕様

#### No.1
- 編集仕様名：初期画面表示
- 関連する取得仕様名：API利用仕様 No.2（日次勤務データ取得API）
  | 項目名 | 編集内容 | 条件or前提 |
  | :--- | :--- | :--- |
  | タイトル | 「勤怠情報入力」 | |
  | 日付表示 | 入出力項目定義.対象日付をYYYY年MM月DD日X曜日形式で表示 | |
  | 出社時刻 | 日次勤務データ.出勤時刻をH:MM形式で表示。初期データが指定されている場合は初期データ.出社時刻を優先表示 | 初期データが指定されている場合は初期データを優先 |
  | 出社打刻時刻表示 | 「打刻 (日次勤務データ.出勤打刻時刻)」を表示 | 出社時刻が手入力で変更された場合（IS_CLOCK_IN_MANUAL=TRUE）かつ出勤打刻時刻（ORIGINAL_CLOCK_IN_TIME）が存在する場合のみ表示 |
  | 退社時刻 | 日次勤務データ.退勤時刻をH:MM形式で表示。初期データが指定されている場合は初期データ.退社時刻を優先表示 | 初期データが指定されている場合は初期データを優先 |
  | 退社打刻時刻表示 | 「打刻 (日次勤務データ.退勤打刻時刻)」を表示 | 退社時刻が手入力で変更された場合（IS_CLOCK_OUT_MANUAL=TRUE）かつ退勤打刻時刻（ORIGINAL_CLOCK_OUT_TIME）が存在する場合のみ表示 |
| 休憩1開始時刻 | 休憩時間リスト[0].休憩開始時刻をH:MM形式で表示。休憩時間リストに休憩種別がBREAKのレコードが存在しない場合は、その他の項目定義.休憩1デフォルト開始時刻（12:00）を表示 | 休憩種別がBREAKの場合。データが存在しない場合はデフォルト値を使用 |
| 休憩1終了時刻 | 休憩時間リスト[0].休憩終了時刻をH:MM形式で表示。休憩時間リストに休憩種別がBREAKのレコードが存在しない場合は、その他の項目定義.休憩1デフォルト終了時刻（13:00）を表示 | 休憩種別がBREAKの場合。データが存在しない場合はデフォルト値を使用 |
  | 休憩2開始時刻 | 休憩時間リスト[1].休憩開始時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
  | 休憩2終了時刻 | 休憩時間リスト[1].休憩終了時刻をH:MM形式で表示 | 休憩種別がBREAKの場合 |
  | 公用外出1開始時刻 | 休憩時間リスト.休憩開始時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの最初のレコード |
  | 公用外出1終了時刻 | 休憩時間リスト.休憩終了時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの最初のレコード |
  | 公用外出2開始時刻 | 休憩時間リスト.休憩開始時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの2番目のレコード |
  | 公用外出2終了時刻 | 休憩時間リスト.休憩終了時刻をH:MM形式で表示 | 休憩種別がOFFICIAL_OUTINGの2番目のレコード |
  | 勤務場所 | 日次勤務データ.勤務場所コードに対応する勤務場所名を選択状態で表示。初期データが指定されている場合は初期データ.勤務場所を優先表示 | 初期データが指定されている場合は初期データを優先 |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所選択肢一覧 | 勤務場所マスタ.勤務場所名 | |
  | プレースホルダー | 時刻入力欄および勤務場所プルダウンにはプレースホルダーを表示しない | 全ての入力欄 |
  | 登録ボタン | 表示 | 閲覧専用モードがFALSEの場合 |
  | キャンセルリンク | 表示 | 閲覧専用モードがFALSEの場合 |
  | リセットボタン | 表示 | 閲覧専用モードがFALSEの場合 |
  | 日次確定するチェックボックス | 表示 | 閲覧専用モードがFALSEの場合 |
  | 日次確定するラベル | 表示 | 閲覧専用モードがFALSEの場合 |
| 閉じるリンク | 表示 | 閲覧専用モードがTRUEの場合 |
| 全入力項目 | グレー表示 | 閲覧専用モードがTRUEの場合 |
| 休憩追加ボタン | 非活性 | 閲覧専用モードがFALSEかつ休憩時間リストのうち休憩種別がBREAKのレコード数が10個以上の場合 |
| 公用外出追加ボタン | 非活性 | 閲覧専用モードがFALSEかつ休憩時間リストのうち休憩種別がOFFICIAL_OUTINGのレコード数が5個以上の場合 |

#### No.2
- 編集仕様名：入力内容リセット
- 関連する取得仕様名：-
  | 項目名 | 編集内容 | 条件or前提 |
  | :--- | :--- | :--- |
  | 出社時刻 | 日次勤務データ.出勤時刻をH:MM形式で表示 | |
  | 退社時刻 | 日次勤務データ.退勤時刻をH:MM形式で表示 | |
| 休憩1開始時刻 | 日次勤務データ取得時の値に戻す。データが存在しない場合は、その他の項目定義.休憩1デフォルト開始時刻（12:00）に戻す | |
| 休憩1終了時刻 | 日次勤務データ取得時の値に戻す。データが存在しない場合は、その他の項目定義.休憩1デフォルト終了時刻（13:00）に戻す | |
  | 休憩2開始時刻 | 日次勤務データ取得時の値に戻す | |
  | 休憩2終了時刻 | 日次勤務データ取得時の値に戻す | |
  | 公用外出1開始時刻 | 日次勤務データ取得時の値に戻す | |
  | 公用外出1終了時刻 | 日次勤務データ取得時の値に戻す | |
  | 公用外出2開始時刻 | 日次勤務データ取得時の値に戻す | |
  | 公用外出2終了時刻 | 日次勤務データ取得時の値に戻す | |
  | 勤務場所 | 日次勤務データ.勤務場所コードに対応する勤務場所名を選択状態で表示 | |
  | 日次確定するチェックボックス | OFF | |
  | 入力変更フラグ | 全てFALSE | |
| 休憩追加ボタン | 活性状態を更新 | 休憩時間リストのうち休憩種別がBREAKのレコード数に応じて活性/非活性を設定 |
| 公用外出追加ボタン | 活性状態を更新 | 休憩時間リストのうち休憩種別がOFFICIAL_OUTINGのレコード数に応じて活性/非活性を設定 |

## チェック仕様

#### No.1
- チェック仕様：時刻入力チェック
- 分類：単項目チェック
- 取得元：画面項目定義
  | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
  | :--- | :--- | :--- | :--- | :--- |
  | 出社時刻 | フォーマット | 出社時刻がH:MM形式でない場合、エラー | E_ATT_001 | 出社時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 退社時刻 | フォーマット | 退社時刻がH:MM形式でない場合、エラー | E_ATT_002 | 退社時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 休憩1開始時刻 | フォーマット | 休憩1開始時刻がH:MM形式でない場合、エラー | E_ATT_003 | 休憩開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 休憩1終了時刻 | フォーマット | 休憩1終了時刻がH:MM形式でない場合、エラー | E_ATT_004 | 休憩終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 休憩2開始時刻 | フォーマット | 休憩2開始時刻がH:MM形式でない場合、エラー | E_ATT_003 | 休憩開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 休憩2終了時刻 | フォーマット | 休憩2終了時刻がH:MM形式でない場合、エラー | E_ATT_004 | 休憩終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 公用外出1開始時刻 | フォーマット | 公用外出1開始時刻がH:MM形式でない場合、エラー | E_ATT_005 | 公用外出開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 公用外出1終了時刻 | フォーマット | 公用外出1終了時刻がH:MM形式でない場合、エラー | E_ATT_006 | 公用外出終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 公用外出2開始時刻 | フォーマット | 公用外出2開始時刻がH:MM形式でない場合、エラー | E_ATT_005 | 公用外出開始時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 公用外出2終了時刻 | フォーマット | 公用外出2終了時刻がH:MM形式でない場合、エラー | E_ATT_006 | 公用外出終了時刻の形式が正しくありません。H:MM形式で入力してください。 |
  | 出社時刻 | 数値範囲 | 出社時刻が0:00～23:59の範囲外の場合、エラー | E_ATT_007 | 出社時刻は0:00～23:59の範囲で入力してください。 |
  | 退社時刻 | 数値範囲 | 退社時刻が0:00～29:59の範囲外の場合、エラー | E_ATT_008 | 退社時刻は0:00～29:59の範囲で入力してください。（24時以降の深夜勤務に対応） |

#### No.2
- チェック仕様：時刻整合性チェック
- 分類：相関項目チェック
- 取得元：画面項目定義
  | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
  | :--- | :--- | :--- | :--- | :--- |
  | 出社・退社時刻 | 順序整合 | 出社時刻が退社時刻より後の場合、エラー | E_ATT_011 | 出社時刻は退社時刻より前に設定してください。 |
  | 休憩1 | 順序整合 | 休憩1開始時刻が休憩1終了時刻より後の場合、エラー | E_ATT_012 | 休憩開始時刻は休憩終了時刻より前に設定してください。 |
  | 休憩2 | 順序整合 | 休憩2開始時刻が休憩2終了時刻より後の場合、エラー | E_ATT_012 | 休憩開始時刻は休憩終了時刻より前に設定してください。 |
  | 公用外出1 | 順序整合 | 公用外出1開始時刻が公用外出1終了時刻より後の場合、エラー | E_ATT_013 | 公用外出開始時刻は公用外出終了時刻より前に設定してください。 |
  | 公用外出2 | 順序整合 | 公用外出2開始時刻が公用外出2終了時刻より後の場合、エラー | E_ATT_013 | 公用外出開始時刻は公用外出終了時刻より前に設定してください。 |
  | 休憩1 | 依存 | 休憩1開始時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
  | 休憩1 | 依存 | 休憩1終了時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
  | 休憩2 | 依存 | 休憩2開始時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
  | 休憩2 | 依存 | 休憩2終了時刻のみ入力されている場合、エラー | E_ATT_014 | 休憩開始時刻と終了時刻の両方を入力してください。 |
  | 公用外出1 | 依存 | 公用外出1開始時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
  | 公用外出1 | 依存 | 公用外出1終了時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
  | 公用外出2 | 依存 | 公用外出2開始時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
  | 公用外出2 | 依存 | 公用外出2終了時刻のみ入力されている場合、エラー | E_ATT_015 | 公用外出開始時刻と終了時刻の両方を入力してください。 |
  | 休憩時間 | 複合整合 | 休憩時間が出社時刻～退社時刻の範囲外の場合、エラー | E_ATT_016 | 休憩時間は出社時刻から退社時刻の範囲内で設定してください。 |
  | 公用外出時間 | 複合整合 | 公用外出時間が出社時刻～退社時刻の範囲外の場合、エラー | E_ATT_017 | 公用外出時間は出社時刻から退社時刻の範囲内で設定してください。 |

#### No.3
- チェック仕様：日次確定事前チェック
- 分類：特殊・システム系チェック
- 取得元：その他の項目定義
  | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
  | :--- | :--- | :--- | :--- | :--- |
  | 出社時刻 | 必須 | 出社時刻が未入力の場合、エラー | E_ATT_021 | 出社時刻が入力されていません。 |
  | 退社時刻 | 必須 | 退社時刻が未入力の場合、エラー | E_ATT_022 | 退社時刻が入力されていません。 |
  | 勤務場所 | 必須 | 勤務場所が未選択の場合、エラー | E_ATT_023 | 勤務場所が選択されていません。 |
  | 工数実績合計 | 必須 | 工数実績が入力されていない（合計が0または未入力）の場合、エラー | E_ATT_024 | 工数実績が入力されていません。 |
  | 工数実績合計 | 一致 | 工数実績合計と実労働時間が一致しない場合、エラー | E_ATT_025 | 工数の合計と実労働時間が合いません。 |

#### No.4
- チェック仕様：未来日付・勤務当日チェック
- 分類：特殊・システム系チェック
- 取得元：入出力項目定義
  | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
  | :--- | :--- | :--- | :--- | :--- |
  | 対象日付 | 日付範囲 | 対象日付が未来の日付（今日より後）または勤務当日（今日）の場合、出社・退社・休憩・公用外出の入力があるとエラー | E_ATT_026 | 未来の日付は入力できません。 |
  | 勤務場所 | 例外 | 勤務場所のみの変更の場合は、未来日付・勤務当日でもエラーを表示しない | - | - |

#### No.5
- チェック仕様：休憩・公用外出入力時の出社・退社時刻チェック
- 分類：相関項目チェック
- 取得元：画面項目定義
  | 項目名 | 区分 | チェック内容 | メッセージコード | メッセージ |
  | :--- | :--- | :--- | :--- | :--- |
  | 休憩・公用外出 | 依存 | 休憩または公用外出を新規に入力している場合、出社時刻または退社時刻のどちらかが入力されていないとエラー | E_ATT_027 | 出社・退社時刻どちらかを入力してください。 |

## テーブル取得仕様

#### No.1
- 取得仕様名：日次勤務データ取得
- テーブル名：ATTENDANCE_RECORD
  | 項目名 | 取得内容 | 補足 |
  | :--- | :--- | :--- |
  | 勤怠ID | ATTENDANCE_RECORD.ATTENDANCE_ID | |
  | 出勤時刻 | ATTENDANCE_RECORD.CLOCK_IN_TIME | |
  | 退勤時刻 | ATTENDANCE_RECORD.CLOCK_OUT_TIME | |
  | 出勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME | |
  | 退勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME | |
  | 勤務場所コード | ATTENDANCE_RECORD.WORK_LOCATION_CODE | |
  | 出勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL | |
  | 退勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL | |
  | 勤務場所手入力フラグ | ATTENDANCE_RECORD.IS_LOCATION_MANUAL | |
- 関連する取得仕様
  - テーブル取得仕様 No.2（休憩時間取得）
- 取得条件
  - ATTENDANCE_RECORD.EMPLOYEE_ID = 入出力項目定義.従業員ID
  - ATTENDANCE_RECORD.WORK_DATE = 入出力項目定義.対象日付
- その他
  - なし

#### No.2
- 取得仕様名：休憩時間取得
- テーブル名：BREAK_TIME
  | 項目名 | 取得内容 | 補足 |
  | :--- | :--- | :--- |
  | 休憩ID | BREAK_TIME.BREAK_ID | |
  | 休憩開始時刻 | BREAK_TIME.BREAK_START_TIME | |
  | 休憩終了時刻 | BREAK_TIME.BREAK_END_TIME | |
  | 休憩種別 | BREAK_TIME.BREAK_TYPE | BREAK:休憩、OFFICIAL_OUTING:公用外出 |
- 関連する取得仕様
  - なし
- 取得条件
  - BREAK_TIME.ATTENDANCE_ID = テーブル取得仕様No.1.勤怠ID
- その他
  - BREAK_START_TIMEの昇順でソート

#### No.3
- 取得仕様名：勤務場所マスタ取得
- テーブル名：WORK_LOCATION
  | 項目名 | 取得内容 | 補足 |
  | :--- | :--- | :--- |
  | 勤務場所コード | WORK_LOCATION.WORK_LOCATION_CODE | |
  | 勤務場所名 | WORK_LOCATION.WORK_LOCATION_NAME | |
- 関連する取得仕様
  - なし
- 取得条件
  - WORK_LOCATION.IS_ACTIVE = TRUE
- その他
  - DISPLAY_ORDERの昇順でソート

## テーブル更新仕様

#### No.1
- 更新仕様名：勤怠データ更新
- テーブル名：ATTENDANCE_RECORD
- 種別：更新
  | 項目名 | 更新内容 | 補足 |
  | :--- | :--- | :--- |
  | CLOCK_IN_TIME | 画面項目定義.出社時刻 | |
  | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | |
  | WORK_LOCATION_CODE | 画面項目定義.勤務場所の勤務場所コード | |
  | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | 出社時刻が変更された場合TRUE。背景色変更対象 |
  | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | 退社時刻が変更された場合TRUE。背景色変更対象 |
  | UPDATED_AT | 現在日時 | |
- 関連する取得仕様
  - テーブル取得仕様 No.1（日次勤務データ取得）
- 更新条件
  - ATTENDANCE_RECORD.EMPLOYEE_ID = 入出力項目定義.従業員ID
  - ATTENDANCE_RECORD.WORK_DATE = 入出力項目定義.対象日付
- その他
  - なし

#### No.2
- 更新仕様名：休憩時間更新
- テーブル名：BREAK_TIME
- 種別：削除・登録
  | 項目名 | 更新内容 | 補足 |
  | :--- | :--- | :--- |
  | ATTENDANCE_ID | 日次勤務データ.勤怠ID | |
  | BREAK_START_TIME | 画面項目定義.休憩開始時刻 | |
  | BREAK_END_TIME | 画面項目定義.休憩終了時刻 | |
  | BREAK_TYPE | 休憩種別（BREAK/OFFICIAL_OUTING） | |
  | CREATED_AT | 現在日時 | |
  | UPDATED_AT | 現在日時 | |
- 関連する取得仕様
  - なし
- 更新条件
  - 既存の休憩時間レコードを全て削除後、新規登録
- その他
  - 休憩時間と公用外出時間を合わせて更新

## API利用仕様

#### No.1
- API仕様名：勤務場所マスタ取得API
- リクエスト
  | 項目名 | リクエスト内容 | 補足 |
  | :--- | :--- | :--- |
  | HTTPメソッド | GET | |
  | エンドポイント | /api/master/work-locations | |
- レスポンス
  | 項目名 | レスポンス内容 | 補足 |
  | :--- | :--- | :--- |
  | 勤務場所マスタ | 勤務場所マスタリスト | JSON形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所コード | WORK_LOCATION.WORK_LOCATION_CODE | |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所名 | WORK_LOCATION.WORK_LOCATION_NAME | |
- 関連する取得仕様
  - テーブル取得仕様 No.3（勤務場所マスタ取得）
- その他
  - IS_ACTIVE=TRUEの勤務場所をDISPLAY_ORDER順で取得

#### No.2
- API仕様名：日次勤務データ取得API
- リクエスト
  | 項目名 | リクエスト内容 | 補足 |
  | :--- | :--- | :--- |
  | HTTPメソッド | GET | |
  | エンドポイント | /api/attendance/daily | |
  | EMPLOYEE_ID | 入出力項目定義.従業員ID | クエリパラメータ |
  | WORK_DATE | 入出力項目定義.対象日付 | クエリパラメータ、YYYY-MM-DD形式 |
- レスポンス
  | 項目名 | レスポンス内容 | 補足 |
  | :--- | :--- | :--- |
  | 日次勤務データ | 1日分の勤務記録 | JSON形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤怠ID | ATTENDANCE_RECORD.ATTENDANCE_ID | |
  | &nbsp;&nbsp;&nbsp;&nbsp;出勤時刻 | ATTENDANCE_RECORD.CLOCK_IN_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;退勤時刻 | ATTENDANCE_RECORD.CLOCK_OUT_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;出勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_IN_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;退勤打刻時刻 | ATTENDANCE_RECORD.ORIGINAL_CLOCK_OUT_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所コード | ATTENDANCE_RECORD.WORK_LOCATION_CODE | |
  | &nbsp;&nbsp;&nbsp;&nbsp;出勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_IN_MANUAL | |
  | &nbsp;&nbsp;&nbsp;&nbsp;退勤手入力フラグ | ATTENDANCE_RECORD.IS_CLOCK_OUT_MANUAL | |
  | &nbsp;&nbsp;&nbsp;&nbsp;勤務場所手入力フラグ | ATTENDANCE_RECORD.IS_LOCATION_MANUAL | |
  | &nbsp;&nbsp;&nbsp;&nbsp;休憩時間リスト | BREAK_TIME | |
  | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩ID | BREAK_TIME.BREAK_ID | |
  | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩開始時刻 | BREAK_TIME.BREAK_START_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩終了時刻 | BREAK_TIME.BREAK_END_TIME | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;休憩種別 | BREAK_TIME.BREAK_TYPE | |
- 関連する取得仕様
  - テーブル取得仕様 No.1（日次勤務データ取得）
  - テーブル取得仕様 No.2（休憩時間取得）
- その他
  - ATTENDANCE_RECORDとBREAK_TIMEを結合して返却

#### No.3
- API仕様名：勤怠データ更新API
- リクエスト
  | 項目名 | リクエスト内容 | 補足 |
  | :--- | :--- | :--- |
  | HTTPメソッド | PUT | |
  | エンドポイント | /api/attendance/daily | |
  | EMPLOYEE_ID | 入出力項目定義.従業員ID | リクエストボディ |
  | WORK_DATE | 入出力項目定義.対象日付 | リクエストボディ、YYYY-MM-DD形式 |
  | CLOCK_IN_TIME | 画面項目定義.出社時刻 | リクエストボディ、HH:MM形式 |
  | CLOCK_OUT_TIME | 画面項目定義.退社時刻 | リクエストボディ、HH:MM形式 |
  | WORK_LOCATION_CODE | 画面項目定義.勤務場所 | リクエストボディ |
  | IS_CLOCK_IN_MANUAL | 入力変更フラグ.出社変更フラグ | リクエストボディ。出社時刻変更時にTRUE |
  | IS_CLOCK_OUT_MANUAL | 入力変更フラグ.退社変更フラグ | リクエストボディ。退社時刻変更時にTRUE |
  | BREAK_TIMES | 休憩時間リスト | リクエストボディ、配列形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;BREAK_START_TIME | 休憩開始時刻 | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;BREAK_END_TIME | 休憩終了時刻 | HH:MM形式 |
  | &nbsp;&nbsp;&nbsp;&nbsp;BREAK_TYPE | 休憩種別 | BREAK/OFFICIAL_OUTING |
- レスポンス
  | 項目名 | レスポンス内容 | 補足 |
  | :--- | :--- | :--- |
  | 成功フラグ | 成功/失敗 | true/false |
  | メッセージ | 処理結果メッセージ | |
- 関連する取得仕様
  - なし
- その他
  - テーブル更新仕様 No.1（勤怠データ更新）、No.2（休憩時間更新）を実行
  - 出社・退社の手入力フラグがTRUEの場合、勤務表画面で該当項目の背景色が黄色に変更される（勤務場所は対象外）

#### No.4
- API仕様名：日次確定申請API
- リクエスト
  | 項目名 | リクエスト内容 | 補足 |
  | :--- | :--- | :--- |
  | HTTPメソッド | POST | |
  | エンドポイント | /api/attendance/daily-confirmation | |
  | EMPLOYEE_ID | 入出力項目定義.従業員ID | リクエストボディ |
  | WORK_DATE | 入出力項目定義.対象日付 | リクエストボディ、YYYY-MM-DD形式 |
- レスポンス
  | 項目名 | レスポンス内容 | 補足 |
  | :--- | :--- | :--- |
  | 成功フラグ | 成功/失敗 | true/false |
  | メッセージ | 処理結果メッセージ | |
- 関連する取得仕様
  - なし
- その他
  - 日次確定申請成功後、ATTENDANCE_RECORDのAPPROVAL_STATUSがPENDINGに更新される
  - 勤務表画面の該当日の申請状況アイコンが↑マーク（申請中）に変更される

## 補足説明

### 勤務表画面からの連携
勤務表画面の「出社」「退社」「勤務場所」のテキストボックスを押下することで、本画面がダイアログ形式で表示されます。
押下された項目に応じて、該当の入力欄にフォーカスが設定されます。

### 手入力と背景色の変更
本画面で出社時刻、退社時刻を手入力で変更して登録すると、以下の処理が行われます：

1. **手入力フラグの設定**
   - 変更された項目に対応する手入力フラグ（IS_CLOCK_IN_MANUAL、IS_CLOCK_OUT_MANUAL）がTRUEに設定されます。
   - **注意**: 勤務場所（プルダウン選択）は背景色変更の対象外です。

2. **背景色の変更**
   - 勤務表画面に戻ると、出社・退社の手入力フラグがTRUEの項目のセルの背景色が黄色（#FFFF00）に変更されます。
   - これにより、打刻機による自動入力ではなく、手入力で変更された箇所が視覚的に識別できます。
   - 勤務場所は選択を変更しても背景色は変わりません。

### 閲覧専用モード（承認中状態）
日次確定ボタンを押して承認中になると、本画面は閲覧専用モードになります：

1. **閲覧専用モードの条件**
   - 入出力項目定義.承認状態がPENDINGの場合に閲覧専用モードになります。

2. **閲覧専用モード時の表示**
   - 全ての入力項目がグレー表示（編集不可）になり、編集できなくなります。
   - 「登録」「キャンセル」「リセット」ボタンおよび「日次確定する」チェックボックスは非表示になります。
   - 代わりに「閉じる」リンクが表示されます。

3. **閲覧専用モード時の操作**
   - 「閉じる」リンクまたはヘッダーの「X」ボタンでダイアログを閉じることのみ可能です。

### 休憩時間と公用外出の管理
休憩時間と公用外出は、同じBREAK_TIMEテーブルで管理されますが、BREAK_TYPE列で種別を区別します：

- **BREAK**: 通常の休憩時間
- **OFFICIAL_OUTING**: 公用外出

初期状態では、休憩1、休憩2、公用外出1、公用外出2の4つの入力枠が表示されます。
「+」ボタンを押下することで、追加の休憩時間枠または公用外出時間枠を追加できます。

**休憩1のデフォルト値**
- 休憩1は、日次勤務データに休憩時間が存在しない場合、または休憩時間リストに休憩種別がBREAKのレコードが存在しない場合、デフォルト値として12:00~13:00が既に入力されているものとして表示されます。
- これは、一般的な昼休憩時間を想定したデフォルト値です。
- ユーザーは必要に応じて、この値を編集・削除することができます。

**追加可能な上限**
- 休憩時間枠は最大10個まで追加可能です。10個に達すると、休憩追加ボタン（「+」アイコン）が非活性になり、押下できなくなります。
- 公用外出時間枠は最大5個まで追加可能です。5個に達すると、公用外出追加ボタン（「+」アイコン）が非活性になり、押下できなくなります。

### 時刻の入力形式
時刻はH:MM形式（例: 8:48、12:00、18:46）で入力します。
退社時刻は深夜勤務に対応するため、24:00以降の時刻（例: 25:30）も入力可能です。

### 未来日付・勤務当日での入力制限
勤務予定日（未来の日付）または勤務当日（今日）で本画面を開いた場合、以下の制限が適用されます：

1. **出社・退社時刻の入力制限**
   - 未来の日付または勤務当日で出社時刻または退社時刻を入力して登録ボタンを押下すると、「未来の日付は入力できません」というエラーメッセージがグレーの四角形の左下に表示されます。
   - エラーメッセージコード: E_ATT_026

2. **休憩・公用外出の入力制限**
   - 未来の日付または勤務当日で休憩または公用外出を入力して登録ボタンを押下すると、同様に「未来の日付は入力できません」というエラーメッセージが表示されます。

3. **勤務場所の例外**
   - 勤務場所のみの変更の場合は、未来の日付または勤務当日でもエラーを表示せず、正常に登録できます。
   - これは、勤務予定の勤務場所を事前に設定する用途を想定しています。

4. **休憩・公用外出入力時の出社・退社時刻チェック**
   - 休憩または公用外出を新規に入力する場合、出社時刻または退社時刻のどちらかが入力されていないと、「出社・退社時刻どちらかを入力してください」というエラーメッセージが表示されます。
   - エラーメッセージコード: E_ATT_027
   - このチェックは、未来日付・勤務当日チェックとは独立して実行されます。

### 日次確定チェックボックスとエラーダイアログ
「日次確定する」チェックボックスをONにして登録ボタンを押下した場合、以下のチェックが行われます：

1. **工数実績チェック**
   - 工数実績が入力されていない場合、エラーダイアログが表示されます。
   - エラーメッセージ例: 「工数実績が入力されていません。」

2. **工数合計チェック**
   - 工数実績の合計と実労働時間が一致しない場合、エラーダイアログが表示されます。
   - エラーメッセージ例: 「工数の合計と実労働時間が合いません。」

3. **その他の必須チェック**
   - 出社時刻、退社時刻、勤務場所が未入力の場合もエラーダイアログが表示されます。

エラーダイアログは「OK」ボタンで閉じることができ、閉じた後は入力画面に戻ってエラー箇所を修正できます。

### 日次確定チェックボックスの活性/非活性制御
「日次確定する」チェックボックスは、以下の条件で非活性（チェックできない状態）になります：

1. **休日かつ休日出勤申請が未申請の場合**
   - 対象日が休日（土曜日、日曜日、祝日）かつ休日出勤申請が未申請の場合、チェックボックスは非活性になります。
   - 休日出勤申請を申請済みの場合は、チェックボックスが活性化され、通常通り操作可能になります。

2. **打刻時刻が未入力または退社時刻が未入力の場合**
   - 出社と退社の両方の打刻時刻が未入力の場合、チェックボックスは非活性になります。
   - 出社の打刻時刻は入力されているが、退社の打刻時刻が未入力の場合（勤務中）、チェックボックスは非活性になります。
   - 両方の打刻時刻が入力されている場合のみ、チェックボックスが活性化されます。

**制御ロジック**:
1. 対象日が休日（土曜日、日曜日、祝日）かどうかを判定（HolidayJpライブラリを使用）
2. 対象日に休日出勤申請が存在するかどうかを確認（APPROVAL_STATUSがPENDINGまたはAPPROVED）
3. 対象日の勤怠記録で出社時刻（CLOCK_IN_TIME）と退社時刻（CLOCK_OUT_TIME）の状態を確認
4. 以下のいずれかの場合、チェックボックスを非活性化：
   - 休日かつ休日出勤申請が未申請の場合
   - 出社時刻と退社時刻の両方が未入力の場合
   - 出社時刻は入力されているが、退社時刻が未入力の場合
5. 非活性時は、チェックボックスを無効化し、クリックイベントを無効化

**注意事項**:
- チェックボックスが非活性の場合でも、チェックボックス自体は表示されます（グレーアウト表示）
- 非活性の理由は、ユーザーに明示的に表示されません（UIの簡素化のため）

## 変更履歴

| 日付 | 変更内容 | 変更者 |
| --- | --- | --- |
| 2025-12-09 | 初版作成 | AI Assistant |
| 2025-12-09 | 日次確定チェックボックス使用時のエラーダイアログ（工数実績チェック）を追加。勤務場所は背景色変更対象外に修正 | AI Assistant |
| 2025-12-09 | プレースホルダー（H:MM、選択してください）を削除。勤務表画面から既存データを初期表示として使用する仕様を追加 | AI Assistant |
| 2025-12-09 | 勤務情報入力画面（ダイアログ）内での背景色変更に関する記述を削除。背景色変更は勤務表画面に戻った時のみに限定 | AI Assistant |
| 2025-12-09 | 承認中・申請中の場合の表示を「非活性」から「グレー表示」に変更 | AI Assistant |
| 2025-12-09 | 休憩の上限を10個、公用外出の上限を5個に設定。上限到達時に追加ボタンを非活性にする仕様を追加 | AI Assistant |
| 2025-12-09 | 未来日付・勤務当日での入力制限を追加。出社・退社・休憩・公用外出の入力時に「未来の日付は入力できません」エラーを表示。勤務場所のみの変更は例外として許可。休憩・公用外出入力時の出社・退社時刻チェックを追加 | AI Assistant |
| 2025-12-09 | 休憩1のデフォルト値（12:00~13:00）を追加。日次勤務データに休憩時間が存在しない場合、休憩1にデフォルト値が設定される | AI Assistant |
| 2025-12-09 | 日次確定チェックボックスの活性/非活性制御を追加。休日かつ休日出勤申請が未申請の場合、または打刻時刻が未入力または退社時刻が未入力の場合、チェックボックスを非活性化 | AI Assistant |

