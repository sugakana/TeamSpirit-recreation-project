---
description: 
globs: 
alwaysApply: false
---
# APIテスト仕様書のルール

## 概要
このルールは、APIテスト仕様書を作成・管理するためのガイドラインを提供します。

## テスト仕様書の基本構造

### 1. ファイル配置
- テスト仕様書は `docs/tests/api` ディレクトリに配置する
- 各APIのテスト仕様は個別のMarkdownファイルとして管理
- ファイル名は `{api-name}-test-spec.md` の形式で作成

### 2. テスト仕様書の構成

#### 2.1 ドキュメント作成ルール
- 以下の内容を記載すること
  - タイトル
    - システム名とAPI名を明記すること。
  - テスト環境情報
    - アクセスポイント（URL）を記載すること。
    - アクセスメソッド（GET/POST/PUT/DELETE等）を記載すること。
    - APIキーやアクセストークンが必要な場合は記載すること。
  - テスト仕様書
    - 以下のテーブルヘッダー及びルールで記載する
      | No | 確認内容 | バリエーション | ケース数 | 確認対象 | 実施回数 | 結果 | 実施者 | 実施日 | 再鑑者 | 備考 |
      | :--- | :--- | :--- | ---: | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
      | 自動採番（1から昇順） | テストの目的を簡潔に記述 | バリエーションNo.と名称 | テストケース数 | 確認対象（レスポンス/DB/メール等） | 実施回数 | テスト結果 | テスト実施者 | 実施日 | レビュー実施者 | 補足事項 |
    - 「バリエーション」は参考にするバリエーションのNoと名称を記載する
  - バリエーション
    - 各テスト項目の詳細なテストケースを記載
    - 以下のテーブルヘッダー及びルールで記載する
      | # | 観点 | 入力項目1 | 入力項目2 | ... | 想定結果 | テスト結果 | 備考 |
      | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
      | 自動採番（1から昇順） | テストの観点を簡潔に記述 | 入力値 | 入力値 | ... | 期待される結果 | 実際の結果 | 補足事項 |
    - 「観点」はテストの目的を明確に記述。
    - 「想定結果」は具体的なエラーメッセージやレスポンス内容を記載。
    - 境界値（最小/最大/空/NULL）を意識すること。
  - 事前データ
    - テストに必要なマスタデータを記載
    - 各マスタのテーブル形式で記載
  - 変更履歴
    - 以下のテーブルヘッダー及びルールで記載する
      | 日付 | 変更内容 | 変更者 |
      | :--- | :--- | :--- |
      | yyyy-mm-dd | 修正・追加内容を具体的に記載 | 開発者名 |
    - 変更があったら都度追記。上書き禁止。
    - 新規作成時は「初版作成」と記載。
    - 更新時は「〇〇テストケースを追加」「△△の説明を修正」など具体的に変更内容を記載。
    - 日付は`yyyy-mm-dd`形式で統一し、更新日を記載すること
    - 開発者名はCursorのアカウント名を記載すること。

#### 2.2 テスト結果記入ルール
- テスト結果は以下のいずれかで記載
  - OK：テスト成功
  - NG：テスト失敗
  - 保留：テスト実施不可
  - 未実施：テスト未実施

- テスト結果にNGが発生した場合
  - バグチケット番号を備考欄に記載
  - 再テスト実施後に結果を更新

#### 2.3 サンプル
```markdown
# 顧客管理システム
# ユーザー情報登録 APIテスト仕様書

## 1. テスト環境情報
- アクセスポイント：https://api.example.com/v1/users
- アクセスメソッド：POST
- 認証情報：
  - APIキー：x-api-keyヘッダーに設定
  - アクセストークン：Authorizationヘッダーに設定（Bearer形式）

## 2. テスト仕様書
| No | 確認内容 | バリエーション | ケース数 | 確認対象 | 実施回数 | 結果 | 実施者 | 実施日 | 再鑑者 | 備考 |
| :--- | :--- | :--- | ---: | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 単項目チェックが正常か確認する。 | バリエーション No.1（単項目チェック） | 29 | レスポンス |  |  |  |  |  |  |
| 2 | 相関項目チェックが正常か確認する。 | バリエーション No.2（相関項目チェック） | 1 | レスポンス |  |  |  |  |  |  |
| 3 | ユーザー重複チェックが正常か確認する。 | バリエーション No.3（ユーザー重複チェック） | 1 | レスポンス |  |  |  |  |  |  |
| 4 | グループ存在チェックが正常か確認する。 | バリエーション No.4（グループ重複チェック） | 1 | レスポンス |  |  |  |  |  |  |
| 5 | 権限存在チェックが正常か確認する。 | バリエーション No.5（権限存在チェック） | 1 | レスポンス |  |  |  |  |  |  |
| 6 | 正常処理が正常か確認する。 | バリエーション No.6（正常処理） | 1 | レスポンス |  |  |  |  |  |  |

## 3. バリエーション

#### No.1
- バリエーション名：単項目チェック
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | ユーザーIDがNullの場合、エラーとなること。 | Null | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：ユーザーIDは必須です。 |  |  |
  | 2 | ユーザーIDのフォーマットがメールアドレスになっていない場合、エラーとなること。 | sampletest | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00012<br>メッセージ：ユーザーIDの形式が異なります。 |  |  |
  | 3 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample,test@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 4 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample'test@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 5 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample"test@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 6 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample\ntest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 7 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample\r\ntest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 8 | ユーザーIDに禁止文字が入っている場合、エラーとなること。 | sample\ttest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：ユーザーIDは「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 9 | 氏名がNullの場合、エラーとなること。 | sampletest@gmail.com | Null | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：氏名は必須です。 |  |  |
  | 10 | 氏名が0文字の場合、エラーとなること。 | sampletest@gmail.com |  | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00006<br>メッセージ：氏名は1以上20以下の文字で入力してください。 |  |  |
  | 11 | 氏名が21文字の場合、エラーとなること。 | sampletest@gmail.com | aaaaaaaaaaaaaaaaaaaaa | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00006<br>メッセージ：氏名は1以上20以下の文字で入力してください。 |  |  |
  | 12 | 氏名が1文字の場合、エラーにならないこと。 | sample2@gmail.com | 橘 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 13 | 氏名が20文字の場合、エラーにならないこと。 | sample3@gmail.com | CrimsonWolfAlpha9925 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 14 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中,太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 15 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中'太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 16 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中"太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 17 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中\n太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 18 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中\r\n太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 19 | 氏名に禁止文字が入っている場合、エラーとなること。 | sampletest@gmail.com | 田中\t太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：氏名は「,」、「'」、「"」、「\n」、「\r\n」、「\t」を使用できません。 |  |  |
  | 20 | 電話番号が存在しない場合、エラーにならないこと。 | sampletest@gmail.com | 田中 太郎 |  | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：電話番号の形式が異なります。 |  |  |
  | 21 | 電話番号が存在し、電話番号のフォーマットになっていない場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090abcd02d9 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00026<br>メッセージ：電話番号の形式が異なります。 |  |  |
  | 22 | グループIDがNullの場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | Null | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：グループIDは必須です。 |  |  |
  | 23 | グループIDのフォーマットが間違っている場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP000001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00012<br>メッセージ：グループIDの形式が異なります。 |  |  |
  | 24 | 権限IDがNullの場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | Null | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：権限IDは必須です。 |  |  |
  | 25 | 権限IDのフォーマットが間違っている場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU000001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00012<br>メッセージ：権限IDの形式が異なります。 |  |  |
  | 26 | 適用開始日がNull場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | Null | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：適用開始日は必須です。 |  |  |
  | 27 | 適用開始日のフォーマットが間違っている場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025/01/01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E00012<br>メッセージ：適用開始日の形式が異なります。 |  |  |
  | 28 | 適用終了日がNull場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | Null | 以下の内容が返却される<br>メッセージコード：E00001<br>メッセージ：適用終了日は必須です。 |  |  |
  | 29 | 適用終了日のフォーマットが間違っている場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026/01/01 | 以下の内容が返却される<br>メッセージコード：E00012<br>メッセージ：適用終了日の形式が異なります。 |  |  |

#### No.2
- バリエーション名：相関項目チェック
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | 「適⽤開始⽇ ≦ 適⽤終了⽇」を満たさない場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2024-01-01 | 以下の内容が返却される<br>メッセージコード：E10002<br>メッセージ：適用開始日が適用終了日より後の日付になっています。 |  |  |

#### No.3
- バリエーション名：ユーザー重複チェック
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | 登録ユーザーのユーザーIDが既にDBに存在する場合、エラーとなること。 | sample@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E10012<br>メッセージ：⼊⼒されたメールアドレスは既に登録されています。 |  |  |

#### No.4
- バリエーション名：グループ存在チェック
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | 登録ユーザーのグループIDがDBに存在しない場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00002 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E10013<br>メッセージ：入力されたグループIDが存在しません。 |  |  |

#### No.5
- バリエーション名：権限存在チェック
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | 登録ユーザーのグループIDがDBに存在しない場合、エラーとなること。 | sampletest@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00004 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：E10013<br>メッセージ：入力された権限IDが存在しません。 |  |  |

#### No.6
- バリエーション名：正常処理
  | # | 観点 | ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | 適用開始日 | 適用終了日 | 想定結果 | テスト結果 | 備考 |
  | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
  | 1 | 正常に処理が完了すること。 | sample4@gmail.com | 田中 太郎 | 090-1234-5678 | DP00001 | AU00001 | 2025-01-01 | 2026-01-01 | 以下の内容が返却される<br>メッセージコード：I00000<br>メッセージ：処理が完了しました。 |  |  |
  

## 4. 事前データ

#### ユーザーマスタ
| ユーザーID | 氏名 | 電話番号 | グループID | 権限ID | パスワード | 適用開始日 | 適用終了日 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| sample@gmail.com | 鈴木 一郎 | 090-0000-0000 | DP00001 | AU00001 | P@ssw0rd1234 | 2024-01-01 | 2028-01-01 |

#### グループマスタ
| グループID | グループ名 |
| :--- | :--- |
| DP00000 | 所属無し |
| DP00001 | 人事部 |

#### 権限マスタ
| 権限ID | 権限名 |
| :--- | :--- |
| AU00000 | 一般ユーザー |
| AU00001 | ブロンズユーザー |
| AU00002 | シルバーユーザー |
| AU00003 | ゴールドユーザー |

## 5. 変更履歴
| 日付 | 変更内容 | 変更者 |
|:---|:---|:---|
| 2024-03-20 | 初版作成 | dev_user01 | 
```

### 3. レビュー基準
- テストケースの網羅性
- テストデータの適切性
- 期待結果の明確性
- テスト実施手順の具体性

## 命名規則
- ファイル名はケバブケース（例：`user-registration-test-spec.md`）
- バリエーション名は「No.{番号}：{テスト種別}」の形式
- テストケース番号は「{バリエーションNo.}-{連番}」の形式

## 更新ルール
1. テストケースの追加・変更時は必ず一覧を更新
2. 変更履歴を記録
3. 関連するテストケースの参照も更新

## レビュー基準
- テストケースの網羅性
- テストデータの適切性
- 期待結果の明確性
- テスト実施手順の具体性

